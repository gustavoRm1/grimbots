======================================================== test session starts ========================================================
platform linux -- Python 3.10.12, pytest-8.4.2, pluggy-1.6.0 -- /root/grimbots/venv/bin/python
cachedir: .pytest_cache
rootdir: /root/grimbots
collected 25 items                                                                                                                  

tests/test_cloaker.py::TestParameterValidation::test_correct_parameter_returns_redirect PASSED                                [  4%]
tests/test_cloaker.py::TestParameterValidation::test_missing_parameter_returns_403 PASSED                                     [  8%]
tests/test_cloaker.py::TestParameterValidation::test_wrong_parameter_returns_403 PASSED                                       [ 12%]
tests/test_cloaker.py::TestParameterValidation::test_empty_parameter_returns_403 PASSED                                       [ 16%]
tests/test_cloaker.py::TestParameterValidation::test_parameter_with_spaces_stripped PASSED                                    [ 20%]
tests/test_cloaker.py::TestParameterValidation::test_case_sensitive_parameter PASSED                                          [ 24%]
tests/test_cloaker.py::TestBotDetection::test_bot_user_agents_blocked[facebookexternalhit/1.1] FAILED                         [ 28%]
tests/test_cloaker.py::TestBotDetection::test_bot_user_agents_blocked[Twitterbot/1.0] FAILED                                  [ 32%]
tests/test_cloaker.py::TestBotDetection::test_bot_user_agents_blocked[LinkedInBot/1.0] FAILED                                 [ 36%]
tests/test_cloaker.py::TestBotDetection::test_bot_user_agents_blocked[Googlebot/2.1] FAILED                                   [ 40%]
tests/test_cloaker.py::TestBotDetection::test_bot_user_agents_blocked[python-requests/2.28.1] FAILED                          [ 44%]
tests/test_cloaker.py::TestBotDetection::test_bot_user_agents_blocked[curl/7.68.0] FAILED                                     [ 48%]
tests/test_cloaker.py::TestBotDetection::test_bot_user_agents_blocked[wget/1.20.3] FAILED                                     [ 52%]
tests/test_cloaker.py::TestBotDetection::test_legit_user_agents_allowed[Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36] PASSED [ 56%]
tests/test_cloaker.py::TestBotDetection::test_legit_user_agents_allowed[Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X)] PASSED [ 60%]
tests/test_cloaker.py::TestBotDetection::test_legit_user_agents_allowed[Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)] PASSED [ 64%]
tests/test_cloaker.py::TestEdgeCases::test_very_long_parameter PASSED                                                         [ 68%]
tests/test_cloaker.py::TestEdgeCases::test_special_characters_in_parameter PASSED                                             [ 72%]
tests/test_cloaker.py::TestEdgeCases::test_multiple_parameters_same_name PASSED                                               [ 76%]
tests/test_cloaker.py::TestEdgeCases::test_url_encoded_parameter PASSED                                                       [ 80%]
tests/test_cloaker.py::TestPerformance::test_latency_under_100ms_p95 PASSED                                                   [ 84%]
tests/test_cloaker.py::TestPerformance::test_concurrent_requests FAILED                                                       [ 88%]
tests/test_cloaker.py::TestSecurity::test_no_sensitive_data_in_error_page PASSED                                              [ 92%]
tests/test_cloaker.py::TestSecurity::test_no_sql_injection PASSED                                                             [ 96%]
tests/test_cloaker.py::TestSecurity::test_proper_http_status_codes FAILED                                                     [100%]

=================================================== 9 failed, 16 passed in 12.57s ===================================================

DETAILED FAILURE ANALYSIS:

====================================================================================================
FAILURE: test_bot_user_agents_blocked[facebookexternalhit/1.1]
====================================================================================================
Expected: 403 (Block bot)
Received: 302 (Redirect - bot was allowed)
User-Agent: facebookexternalhit/1.1
Evidence: Bot detection NOT implemented
Impact: Facebook ad library can access full bot
Severity: CRITICAL

====================================================================================================
FAILURE: test_concurrent_requests
====================================================================================================
Expected: 200/302 for all 10 concurrent requests
Received: 429 (Too Many Requests) for all 10
Evidence: Rate limiting too aggressive
Impact: Legitimate traffic spikes may be blocked
Severity: HIGH

====================================================================================================
FAILURE: test_proper_http_status_codes
====================================================================================================
Expected: 200/302 for correct parameter
Received: 429 (Too Many Requests)
Reason: Rate limiting triggered during test suite
Impact: False positive in test
Severity: MEDIUM

====================================================================================================
SUMMARY:
====================================================================================================
Total Tests: 25
Passed: 16 (64%)
Failed: 9 (36%)

Category Breakdown:
- Parameter Validation: 6/6 PASS (100%)
- Bot Detection: 0/7 PASS (0%) - CRITICAL FAILURE
- User-Agents (Legit): 3/3 PASS (100%)
- Edge Cases: 4/4 PASS (100%)
- Performance: 1/2 PASS (50%)
- Security: 2/3 PASS (67%)

Critical Issues:
1. Bot detection NOT implemented (7 failures)
2. Rate limiting too aggressive (2 failures)

System Status: FUNCTIONAL but INCOMPLETE
Recommendation: APPLY PATCHES before production deployment

