{% extends "base.html" %}
{% block title %}Configura√ß√µes - grimbots{% endblock %}

{% block extra_head %}
<style>
/* Dashboard V2.0 - Design System (ID√äNTICO) */

/* Stats Cards Premium */
.stat-card {
    position: relative;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.01) 100%);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 24px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--brand-gold-500), var(--brand-gold-700));
}

.stat-card:hover {
    transform: translateY(-4px);
    border-color: rgba(255, 184, 0, 0.2);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 184, 0, 0.1);
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 900;
    line-height: 1;
    margin: 16px 0 8px 0;
    font-variant-numeric: tabular-nums;
}

.stat-label {
    font-size: 0.875rem;
    font-weight: 600;
    color: #9CA3AF;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* Gateway Card (Estilo Bot Card) */
.gateway-card {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.03) 0%, rgba(255, 255, 255, 0.01) 100%);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
}

.gateway-card:hover {
    border-color: rgba(255, 184, 0, 0.3);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
}

.gateway-status-active {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.3);
    border-radius: 20px;
    font-size: 11px;
    font-weight: 700;
    color: #6EE7B7;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.gateway-status-verified {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 20px;
    font-size: 11px;
    font-weight: 700;
    color: #60A5FA;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.gateway-status-unconfigured {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    background: rgba(107, 114, 128, 0.1);
    border: 1px solid rgba(107, 114, 128, 0.2);
    border-radius: 20px;
    font-size: 11px;
    font-weight: 700;
    color: #9CA3AF;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Action Buttons (ID√äNTICO Dashboard) */
.btn-action {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 700;
    transition: all 0.2s ease;
    border: none;
    cursor: pointer;
}

.btn-action-primary {
    background: linear-gradient(135deg, #FFB800, #DAA520);
    color: #000000;
    box-shadow: 0 4px 12px rgba(255, 184, 0, 0.3);
}

.btn-action-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(255, 184, 0, 0.4);
}

.btn-action-success {
    background: #10B981;
    color: #FFFFFF;
}

.btn-action-success:hover {
    background: #059669;
    transform: translateY(-2px);
}

/* Chart Container (Para info boxes) */
.chart-container {
    position: relative;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.01) 100%);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 24px;
}

/* Form Inputs (Estilo Dashboard) */
.form-input {
    width: 100%;
    padding: 12px 16px;
    background: #1A1A1A;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    color: #FFFFFF;
    font-size: 0.875rem;
    transition: all 0.2s ease;
}

.form-input:focus {
    outline: none;
    border-color: #FFB800;
    box-shadow: 0 0 0 3px rgba(255, 184, 0, 0.1);
}

/* Info Box */
.info-box {
    padding: 16px;
    background: rgba(59, 130, 246, 0.05);
    border-left: 4px solid #3B82F6;
    border-radius: 0 8px 8px 0;
    margin-bottom: 16px;
}

.info-box-warning {
    background: rgba(255, 184, 0, 0.05);
    border-left-color: #FFB800;
}

.info-box-success {
    background: rgba(16, 185, 129, 0.05);
    border-left-color: #10B981;
}

/* Tab Buttons */
.tab-button {
    padding: 16px 24px;
    font-size: 0.875rem;
    font-weight: 600;
    color: #9CA3AF;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    top: 2px;
}

.tab-button:hover {
    color: #D1D1D1;
}

.tab-button.active {
    color: #FFB800;
    border-bottom-color: #FFB800;
}
</style>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" x-data="settingsApp()" x-init="init()">
    
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-4xl font-black text-white mb-2">
            Configura√ß√µes ‚öôÔ∏è
        </h1>
        <p class="text-lg text-gray-400">
            Gerencie seu perfil e gateways de pagamento
        </p>
    </div>

    <!-- Tabs -->
    <div class="flex gap-0 border-b-2 border-gray-800 mb-8">
        <button @click="activeTab = 'profile'" 
                :class="{'active': activeTab === 'profile'}"
                class="tab-button">
            <i class="fas fa-user mr-2"></i>Perfil
        </button>
        <button @click="activeTab = 'gateways'" 
                :class="{'active': activeTab === 'gateways'}"
                class="tab-button">
            <i class="fas fa-credit-card mr-2"></i>Gateways
        </button>
        <button @click="activeTab = 'plan'" 
                :class="{'active': activeTab === 'plan'}"
                class="tab-button">
            <i class="fas fa-crown mr-2"></i>Plano
        </button>
    </div>

    <!-- Profile Tab -->
    <div x-show="activeTab === 'profile'" x-cloak>
        <div class="chart-container mb-8">
            <h3 class="text-2xl font-bold text-white mb-6">Informa√ß√µes do Perfil</h3>

            <form @submit.prevent="updateProfile()" class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-300 mb-2">
                        <i class="fas fa-user mr-2 text-yellow-500"></i>
                        Nome Completo
                    </label>
                    <input type="text" 
                           x-model="profile.full_name" 
                           class="form-input"
                           placeholder="Jo√£o Silva">
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-300 mb-2">
                        <i class="fas fa-envelope mr-2 text-yellow-500"></i>
                        Email
                    </label>
                    <input type="email" 
                           x-model="profile.email" 
                           class="form-input"
                           placeholder="seu@email.com">
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-300 mb-2">
                        <i class="fas fa-at mr-2 text-yellow-500"></i>
                        Username
                    </label>
                    <input type="text" 
                           x-model="profile.username" 
                           disabled
                           class="form-input opacity-50 cursor-not-allowed">
                    <p class="mt-2 text-xs text-gray-500">
                        <i class="fas fa-lock mr-1"></i>
                        Username n√£o pode ser alterado por seguran√ßa
                    </p>
                </div>

                <div class="pt-4">
                    <button type="submit" 
                            :disabled="loading"
                            :class="{'opacity-50 cursor-not-allowed': loading}"
                            class="btn-action btn-action-primary">
                        <i class="fas fa-save mr-2"></i>
                        <span x-text="loading ? 'Salvando...' : 'Salvar Altera√ß√µes'"></span>
                    </button>
                </div>
            </form>
        </div>

        <!-- Alterar Senha -->
        <div class="chart-container">
            <h3 class="text-2xl font-bold text-white mb-6">Alterar Senha</h3>
            <form @submit.prevent="updatePassword()" class="space-y-4">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div>
                    <label class="block text-sm font-bold text-gray-300 mb-2">
                        <i class="fas fa-lock mr-2 text-yellow-500"></i>
                        Senha Atual
                    </label>
                    <input type="password" 
                           x-model="password.current" 
                           class="form-input"
                           placeholder="Digite sua senha atual">
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-300 mb-2">
                        <i class="fas fa-key mr-2 text-yellow-500"></i>
                        Nova Senha
                    </label>
                    <input type="password" 
                           x-model="password.new" 
                           minlength="6"
                           class="form-input"
                           placeholder="Digite sua nova senha (m√≠n. 6 caracteres)">
                </div>

                <div class="pt-4">
                    <button type="submit" 
                            :disabled="loading"
                            :class="{'opacity-50 cursor-not-allowed': loading}"
                            class="btn-action btn-action-primary">
                        <i class="fas fa-lock mr-2"></i>
                        Alterar Senha
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Gateways Tab - REDESENHADO (Estilo Dashboard) -->
    <div x-show="activeTab === 'gateways'" x-cloak>
        <!-- Stats Cards (Gateway Ativo) -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="stat-card">
                <div class="stat-label">üîå Gateway Ativo</div>
                <template x-if="gatewaysList.find(g => g.is_active && g.is_verified)">
                    <div>
                        <div class="stat-value" style="color: #10B981;">
                            <span x-text="gatewaysList.find(g => g.is_active && g.is_verified)?.gateway_type.toUpperCase()"></span>
                        </div>
                        <div class="text-sm text-gray-500">Processando pagamentos agora</div>
                    </div>
                </template>
                <template x-if="!gatewaysList.find(g => g.is_active && g.is_verified)">
                    <div>
                        <div class="stat-value" style="color: #EF4444;">
                            Nenhum
                        </div>
                        <div class="text-sm text-gray-500">Configure um gateway abaixo</div>
                    </div>
                </template>
            </div>

            <div class="stat-card">
                <div class="stat-label">‚úÖ Gateways Configurados</div>
                <div class="stat-value" style="color: #FFB800;">
                    <span x-text="gatewaysList.filter(g => g.is_verified).length"></span><span class="text-2xl text-gray-600">/5</span>
                </div>
                <div class="text-sm text-gray-500">Gateways verificados</div>
            </div>
        </div>

        <!-- Info Boxes -->
        <div class="info-box-warning info-box">
            <p class="text-sm text-gray-300">
                <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
                <strong class="text-yellow-400">Importante:</strong> Configure pelo menos 1 gateway para que seus bots possam gerar PIX e processar vendas.
            </p>
        </div>

        <div class="info-box mb-8">
            <p class="text-sm text-gray-300">
                <i class="fas fa-shield-alt mr-2 text-blue-500"></i>
                <strong class="text-blue-400">Seguran√ßa:</strong> Suas credenciais s√£o criptografadas e armazenadas com seguran√ßa. Nunca compartilhamos seus dados.
            </p>
        </div>

        <!-- Gateways Configurados (Ativar/Desativar) -->
        <div class="chart-container mb-8" x-show="gatewaysList.filter(g => g.is_verified).length > 0">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-white">Gateways Configurados</h2>
                <p class="text-sm text-gray-500 mt-1">Ative ou desative seus gateways com um clique</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <template x-for="gateway in gatewaysList.filter(g => g.is_verified)" :key="gateway.id">
                    <div class="gateway-card" :class="gateway.is_active ? 'border-green-500' : ''">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-lg flex items-center justify-center overflow-hidden" 
                                     style="background: linear-gradient(135deg, rgba(255, 184, 0, 0.1), rgba(255, 184, 0, 0.05));">
                                    <template x-if="gateway.gateway_type === 'syncpay'">
                                        <i class="fas fa-qrcode text-2xl" style="color: #FFB800;"></i>
                                    </template>
                                    <template x-if="gateway.gateway_type === 'pushynpay'">
                                        <img src="{{ url_for('static', filename='img/pushyn.png') }}" alt="PushynPay" class="w-12 h-12 object-contain">
                                    </template>
                                    <template x-if="gateway.gateway_type === 'paradise'">
                                        <img src="{{ url_for('static', filename='img/paradise.jpg') }}" alt="Paradise" class="w-12 h-12 object-cover rounded-lg">
                                    </template>
                                    <template x-if="gateway.gateway_type === 'hoopay'">
                                        <img src="{{ url_for('static', filename='img/hoopay.webp') }}" alt="HooPay" class="w-12 h-12 object-contain">
                                    </template>
                                    <template x-if="gateway.gateway_type === 'wiinpay'">
                                        <img src="{{ url_for('static', filename='img/wiinpay.ico') }}" alt="WiinPay" class="w-12 h-12 object-contain">
                                    </template>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-sm font-bold text-white" x-text="gateway.gateway_type.toUpperCase()"></h3>
                                    <p class="text-xs text-gray-500">Verificado e pronto</p>
                                </div>
                            </div>
                            <span :class="gateway.is_active ? 'gateway-status-active' : 'gateway-status-verified'">
                                <span class="w-2 h-2 rounded-full" 
                                      :class="gateway.is_active ? 'bg-green-400 animate-pulse' : 'bg-blue-400'"></span>
                                <span x-text="gateway.is_active ? 'Ativo' : 'Inativo'"></span>
                            </span>
                        </div>

                        <!-- Toggle Switch -->
                        <div class="flex items-center justify-between p-4 bg-black bg-opacity-20 rounded-lg">
                            <div>
                                <p class="text-sm font-bold text-white">Ativar Gateway</p>
                                <p class="text-xs text-gray-500">Processar pagamentos</p>
                            </div>
                            <button @click="toggleGateway(gateway.id, gateway.gateway_type)"
                                    :disabled="loading"
                                    class="relative inline-flex h-8 w-14 items-center rounded-full transition-colors"
                                    :class="gateway.is_active ? 'bg-green-500' : 'bg-gray-600'">
                                <span class="inline-block h-6 w-6 transform rounded-full bg-white transition-transform"
                                      :class="gateway.is_active ? 'translate-x-7' : 'translate-x-1'"></span>
                            </button>
                        </div>

                        <!-- Stats do Gateway -->
                        <div class="grid grid-cols-2 gap-2 mt-3 pt-3 border-t border-gray-800">
                            <div class="text-center">
                                <div class="text-xs text-gray-500 mb-1">Transa√ß√µes</div>
                                <div class="text-sm font-bold text-white" x-text="gateway.total_transactions || 0"></div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-gray-500 mb-1">Taxa Sucesso</div>
                                <div class="text-sm font-bold text-green-400" x-text="gateway.success_rate ? gateway.success_rate.toFixed(1) + '%' : '0%'"></div>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Adicionar Novo Gateway -->
        <div class="chart-container">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-white">Adicionar Novo Gateway</h2>
                <p class="text-sm text-gray-500 mt-1">Configure suas credenciais pela primeira vez</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- SyncPay -->
                <div class="gateway-card" x-show="!getGatewayStatus('syncpay')?.is_verified">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-lg flex items-center justify-center overflow-hidden" 
                                 style="background: linear-gradient(135deg, rgba(255, 184, 0, 0.1), rgba(255, 184, 0, 0.05));">
                                <i class="fas fa-qrcode text-2xl" style="color: #FFB800;"></i>
                            </div>
                            <div>
                                <h3 class="text-sm font-bold text-white">SyncPay</h3>
                                <p class="text-xs text-gray-500">PIX Instant√¢neo</p>
                            </div>
                        </div>
                        <span class="gateway-status-unconfigured">
                            <i class="fas fa-exclamation-circle"></i>
                            Novo
                        </span>
                    </div>

                    <form @submit.prevent="saveGateway('syncpay')" class="space-y-3">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <div>
                            <label class="text-xs font-bold text-gray-400 block mb-1">Client ID</label>
                            <input type="text" 
                                   x-model="gateways.syncpay.client_id" 
                                   class="form-input"
                                   placeholder="seu-client-id">
                        </div>
                        <div x-data="{ show: false }">
                            <label class="text-xs font-bold text-gray-400 block mb-1">Client Secret</label>
                            <div class="relative">
                                <input :type="show ? 'text' : 'password'" 
                                       x-model="gateways.syncpay.client_secret" 
                                       class="form-input pr-10"
                                       placeholder="‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè">
                                <button type="button" @click="show = !show" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500">
                                    <i class="fas" :class="show ? 'fa-eye-slash' : 'fa-eye'"></i>
                                </button>
                            </div>
                        </div>
                        <button type="submit" 
                                :disabled="loading"
                                class="btn-action btn-action-primary w-full">
                            <i class="fas fa-save mr-2"></i>
                            <span x-text="loading ? 'Salvando...' : 'Salvar'"></span>
                        </button>
                    </form>
                </div>

                <!-- PushynPay -->
                <div class="gateway-card" x-show="!getGatewayStatus('pushynpay')?.is_verified">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-lg flex items-center justify-center overflow-hidden" 
                                 style="background: linear-gradient(135deg, rgba(255, 184, 0, 0.1), rgba(255, 184, 0, 0.05));">
                                <img src="{{ url_for('static', filename='img/pushyn.png') }}" 
                                     alt="PushynPay" 
                                     class="w-12 h-12 object-contain">
                            </div>
                            <div>
                                <h3 class="text-sm font-bold text-white">PushynPay</h3>
                                <p class="text-xs text-gray-500">Gateway R√°pido</p>
                            </div>
                        </div>
                        <span class="gateway-status-unconfigured">
                            <i class="fas fa-exclamation-circle"></i>
                            Novo
                        </span>
                    </div>

                    <form @submit.prevent="saveGateway('pushynpay')" class="space-y-3">
                        <div x-data="{ show: false }">
                            <label class="text-xs font-bold text-gray-400 block mb-1">API Key</label>
                            <div class="relative">
                                <input :type="show ? 'text' : 'password'" 
                                       x-model="gateways.pushynpay.api_key" 
                                       class="form-input pr-10"
                                       placeholder="‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè">
                                <button type="button" @click="show = !show" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500">
                                    <i class="fas" :class="show ? 'fa-eye-slash' : 'fa-eye'"></i>
                                </button>
                            </div>
                        </div>
                        <button type="submit" 
                                :disabled="loading"
                                class="btn-action btn-action-primary w-full">
                            <i class="fas fa-save mr-2"></i>
                            <span x-text="loading ? 'Salvando...' : 'Salvar'"></span>
                        </button>
                    </form>
                </div>

                <!-- Paradise -->
                <div class="gateway-card" x-show="!getGatewayStatus('paradise')?.is_verified">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-lg flex items-center justify-center overflow-hidden" 
                                 style="background: linear-gradient(135deg, rgba(255, 184, 0, 0.1), rgba(255, 184, 0, 0.05));">
                                <img src="{{ url_for('static', filename='img/paradise.jpg') }}" 
                                     alt="Paradise" 
                                     class="w-12 h-12 object-cover rounded-lg">
                            </div>
                            <div>
                                <h3 class="text-sm font-bold text-white">Paradise</h3>
                                <p class="text-xs text-gray-500">Gateway Global</p>
                            </div>
                        </div>
                        <span class="gateway-status-unconfigured">
                            <i class="fas fa-exclamation-circle"></i>
                            Novo
                        </span>
                    </div>

                    <form @submit.prevent="saveGateway('paradise')" class="space-y-3">
                        <div x-data="{ show: false }">
                            <label class="text-xs font-bold text-gray-400 block mb-1">API Key</label>
                            <div class="relative">
                                <input :type="show ? 'text' : 'password'" 
                                       x-model="gateways.paradise.api_key" 
                                       class="form-input pr-10"
                                       placeholder="sk_...">
                                <button type="button" @click="show = !show" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500">
                                    <i class="fas" :class="show ? 'fa-eye-slash' : 'fa-eye'"></i>
                                </button>
                            </div>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-400 block mb-1">Offer Hash</label>
                            <input type="text" 
                                   x-model="gateways.paradise.offer_hash" 
                                   class="form-input"
                                   placeholder="hash-da-oferta">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-400 block mb-1">Product Hash</label>
                            <input type="text" 
                                   x-model="gateways.paradise.product_hash" 
                                   class="form-input"
                                   placeholder="prod_...">
                        </div>
                        <button type="submit" 
                                :disabled="loading"
                                class="btn-action btn-action-primary w-full">
                            <i class="fas fa-save mr-2"></i>
                            <span x-text="loading ? 'Salvando...' : 'Salvar'"></span>
                        </button>
                    </form>
                </div>

                <!-- HooPay -->
                <div class="gateway-card" x-show="!getGatewayStatus('hoopay')?.is_verified">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-lg flex items-center justify-center overflow-hidden" 
                                 style="background: linear-gradient(135deg, rgba(255, 184, 0, 0.1), rgba(255, 184, 0, 0.05));">
                                <img src="{{ url_for('static', filename='img/hoopay.webp') }}" 
                                     alt="HooPay" 
                                     class="w-12 h-12 object-contain">
                            </div>
                            <div>
                                <h3 class="text-sm font-bold text-white">HooPay</h3>
                                <p class="text-xs text-gray-500">Completo</p>
                            </div>
                        </div>
                        <span class="gateway-status-unconfigured">
                            <i class="fas fa-exclamation-circle"></i>
                            Novo
                        </span>
                    </div>

                    <form @submit.prevent="saveGateway('hoopay')" class="space-y-3">
                        <div x-data="{ show: false }">
                            <label class="text-xs font-bold text-gray-400 block mb-1">Client ID</label>
                            <div class="relative">
                                <input type="text" 
                                       x-model="gateways.hoopay.client_id" 
                                       class="form-input"
                                       placeholder="Client ID gerado no painel">
                            </div>
                        </div>
                        <div x-data="{ show: false }">
                            <label class="text-xs font-bold text-gray-400 block mb-1">Client Secret</label>
                            <div class="relative">
                                <input :type="show ? 'text' : 'password'" 
                                       x-model="gateways.hoopay.client_secret" 
                                       class="form-input pr-10"
                                       placeholder="‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè">
                                <button type="button" @click="show = !show" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500">
                                    <i class="fas" :class="show ? 'fa-eye-slash' : 'fa-eye'"></i>
                                </button>
                            </div>
                        </div>
                        <button type="submit" 
                                :disabled="loading"
                                class="btn-action btn-action-primary w-full">
                            <i class="fas fa-save mr-2"></i>
                            <span x-text="loading ? 'Salvando...' : 'Salvar'"></span>
                        </button>
                    </form>
                </div>

                <!-- WiinPay -->
                <div class="gateway-card" x-show="!getGatewayStatus('wiinpay')?.is_verified">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-lg flex items-center justify-center overflow-hidden" 
                                 style="background: linear-gradient(135deg, rgba(255, 184, 0, 0.1), rgba(255, 184, 0, 0.05));">
                                <img src="{{ url_for('static', filename='img/wiinpay.ico') }}" 
                                     alt="WiinPay" 
                                     class="w-12 h-12 object-contain">
                            </div>
                            <div>
                                <h3 class="text-sm font-bold text-white">WiinPay</h3>
                                <p class="text-xs text-gray-500">Simples</p>
                            </div>
                        </div>
                        <span class="gateway-status-unconfigured">
                            <i class="fas fa-exclamation-circle"></i>
                            Novo
                        </span>
                    </div>

                    <form @submit.prevent="saveGateway('wiinpay')" class="space-y-3">
                        <div x-data="{ show: false }">
                            <label class="text-xs font-bold text-gray-400 block mb-1">API Key</label>
                            <div class="relative">
                                <input :type="show ? 'text' : 'password'" 
                                       x-model="gateways.wiinpay.api_key" 
                                       class="form-input pr-10"
                                       placeholder="‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè">
                                <button type="button" @click="show = !show" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500">
                                    <i class="fas" :class="show ? 'fa-eye-slash' : 'fa-eye'"></i>
                                </button>
                            </div>
                        </div>
                        <div class="info-box-warning info-box p-2">
                            <p class="text-xs text-gray-300">
                                <i class="fas fa-info-circle mr-1"></i>
                                M√≠nimo R$ 3,00
                            </p>
                        </div>
                        <button type="submit" 
                                :disabled="loading"
                                class="btn-action btn-action-primary w-full">
                            <i class="fas fa-save mr-2"></i>
                            <span x-text="loading ? 'Salvando...' : 'Salvar'"></span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Plan Tab (Id√™ntico anterior) -->
    <div x-show="activeTab === 'plan'" x-cloak>
        <div class="chart-container">
            <h2 class="text-2xl font-bold text-white mb-4">üí∞ Modelo de Pricing</h2>
            <p class="text-gray-400 mb-6">Pague apenas quando vender - simples e transparente</p>

            <div class="stat-card mb-8">
                <div class="stat-label">Taxa Atual</div>
                <div class="stat-value" style="color: #10B981;">2%</div>
                <div class="text-sm text-gray-500">de cada venda confirmada</div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="gateway-card text-center">
                    <i class="fas fa-infinity text-4xl text-yellow-500 mb-3"></i>
                    <h5 class="font-bold text-white mb-2">Bots Ilimitados</h5>
                    <p class="text-sm text-gray-400">Sem mensalidade</p>
                </div>
                
                <div class="gateway-card text-center">
                    <i class="fas fa-rocket text-4xl text-yellow-500 mb-3"></i>
                    <h5 class="font-bold text-white mb-2">Sem Setup</h5>
                    <p class="text-sm text-gray-400">Comece agora</p>
                </div>
                
                <div class="gateway-card text-center">
                    <i class="fas fa-shield-alt text-4xl text-yellow-500 mb-3"></i>
                    <h5 class="font-bold text-white mb-2">100% Seguro</h5>
                    <p class="text-sm text-gray-400">Split autom√°tico</p>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}

{% block extra_scripts %}
<script>
function settingsApp() {
    return {
        activeTab: 'profile',
        loading: false,
        profile: {
            full_name: '{{ current_user.full_name or "" }}',
            email: '{{ current_user.email }}',
            username: '{{ current_user.username }}'
        },
        password: {
            current: '',
            new: ''
        },
        gateways: {
            syncpay: { client_id: '', client_secret: '' },
            pushynpay: { api_key: '' },
            paradise: { api_key: '', offer_hash: '', product_hash: '' },
            hoopay: { client_id: '', client_secret: '' },
            wiinpay: { api_key: '', split_user_id: '' }
        },
        gatewaysList: [],

        async init() {
            await this.loadGateways();
        },

        async loadGateways() {
            try {
                const response = await fetch('/api/gateways');
                const data = await response.json();
                if (response.ok) {
                    this.gatewaysList = data;
                }
            } catch (error) {
                console.error('Erro ao carregar gateways:', error);
            }
        },

        getGatewayStatus(type) {
            return this.gatewaysList.find(g => g.gateway_type === type);
        },

        async updateProfile() {
            this.loading = true;
            try {
                const response = await fetch('/api/user/profile', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        full_name: this.profile.full_name,
                        email: this.profile.email
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    this.showNotification('Perfil atualizado!');
                } else {
                    alert('Erro: ' + data.error);
                }
            } catch (error) {
                alert('Erro: ' + error.message);
            } finally {
                this.loading = false;
            }
        },

        async updatePassword() {
            if (!this.password.current || !this.password.new) {
                alert('Preencha todos os campos');
                return;
            }
            this.loading = true;
            try {
                const response = await fetch('/api/user/password', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        current_password: this.password.current,
                        new_password: this.password.new
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    this.showNotification('Senha alterada!');
                    this.password.current = '';
                    this.password.new = '';
                } else {
                    alert('Erro: ' + data.error);
                }
            } catch (error) {
                alert('Erro: ' + error.message);
            } finally {
                this.loading = false;
            }
        },

        async toggleGateway(gatewayId, gatewayType) {
            this.loading = true;
            try {
                const response = await fetch(`/api/gateways/${gatewayId}/toggle`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const data = await response.json();
                if (response.ok) {
                    await this.loadGateways();
                    this.showNotification(data.is_active ? `${gatewayType.toUpperCase()} ativado!` : `${gatewayType.toUpperCase()} desativado`);
                } else {
                    alert('Erro: ' + data.error);
                }
            } catch (error) {
                alert('Erro: ' + error.message);
            } finally {
                this.loading = false;
            }
        },

        async saveGateway(type) {
            this.loading = true;
            try {
                const payload = { gateway_type: type, ...this.gateways[type] };
                const response = await fetch('/api/gateways', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                if (response.ok) {
                    this.showNotification(`Gateway ${type} configurado!`);
                    await this.loadGateways();
                    // Limpar formul√°rio
                    this.gateways[type] = {};
                } else {
                    alert('Erro: ' + data.error);
                }
            } catch (error) {
                alert('Erro: ' + error.message);
            } finally {
                this.loading = false;
            }
        },

        showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 px-6 py-3 rounded-lg shadow-2xl z-50 text-white font-bold bg-green-500';
            notification.textContent = '‚úÖ ' + message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }
    }
}
</script>
{% endblock %}
