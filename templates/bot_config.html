{% extends "base.html" %}
{% block title %}Configurar Bot - {{ bot.name }}{% endblock %}

{% block extra_head %}
<style>
/* Bot Config V2.0 - Design System */

.config-section {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.01) 100%);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
}

.config-section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

.config-section-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #FFFFFF;
}

.config-section-description {
    font-size: 0.875rem;
    color: #9CA3AF;
    margin-top: 4px;
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: #D1D1D1;
    margin-bottom: 8px;
}

.form-input {
    width: 100%;
    padding: 12px 16px;
    background: #1A1A1A;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    color: #FFFFFF;
    font-size: 0.875rem;
    transition: all 0.2s ease;
}

.form-input:focus {
    outline: none;
    border-color: #FFB800;
    box-shadow: 0 0 0 3px rgba(255, 184, 0, 0.1);
}

.form-textarea {
    width: 100%;
    padding: 12px 16px;
    background: #1A1A1A;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    color: #FFFFFF;
    font-size: 0.875rem;
    resize: vertical;
    min-height: 100px;
    transition: all 0.2s ease;
}

.form-textarea:focus {
    outline: none;
    border-color: #FFB800;
    box-shadow: 0 0 0 3px rgba(255, 184, 0, 0.1);
}

.tab-nav {
    display: flex;
    gap: 0;
    border-bottom: 2px solid rgba(255, 255, 255, 0.08);
    margin-bottom: 32px;
}

.tab-button {
    padding: 16px 24px;
    font-size: 0.875rem;
    font-weight: 600;
    color: #9CA3AF;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    top: 2px;
}

.tab-button:hover {
    color: #D1D1D1;
}

.tab-button.active {
    color: #FFB800;
    border-bottom-color: #FFB800;
}

.button-card {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.03) 0%, rgba(255, 255, 255, 0.01) 100%);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
}

.order-bump-card {
    background: linear-gradient(135deg, rgba(255, 184, 0, 0.05) 0%, rgba(255, 184, 0, 0.02) 100%);
    border: 1px solid rgba(255, 184, 0, 0.2);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
}

.order-bump-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid rgba(255, 184, 0, 0.1);
}

.order-bump-index {
    width: 32px;
    height: 32px;
    background: rgba(255, 184, 0, 0.1);
    border: 2px solid rgba(255, 184, 0, 0.4);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: bold;
    color: #FFB800;
}

.button-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

.button-index {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 8px;
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.3);
    font-weight: 700;
    color: #6EE7B7;
}

.info-box {
    padding: 16px;
    background: rgba(59, 130, 246, 0.05);
    border-left: 4px solid #3B82F6;
    border-radius: 0 8px 8px 0;
    margin-top: 12px;
}

.info-box-success {
    background: rgba(16, 185, 129, 0.05);
    border-left-color: #10B981;
}

.info-box-warning {
    background: rgba(255, 184, 0, 0.05);
    border-left-color: #FFB800;
}

.order-bump-section {
    background: rgba(255, 184, 0, 0.03);
    border: 1px solid rgba(255, 184, 0, 0.15);
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
}

/* Bot√µes de A√ß√£o - ID√äNTICO ao Dashboard */
.btn-action {
    display: inline-flex;
    align-items: center;
    padding: 0.5rem 1rem;
    border: 1px solid transparent;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: #111827;
    background-image: linear-gradient(to right, var(--brand-gold-500), var(--brand-gold-700));
    cursor: pointer;
    transition: all 0.15s ease;
}

.btn-action:hover {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

.btn-action i {
    margin-right: 0.5rem;
}

/* Todas as variantes usam o mesmo estilo dourado */
.btn-action-primary,
.btn-action-success,
.btn-action-info {
    display: inline-flex;
    align-items: center;
    padding: 0.5rem 1rem;
    border: 1px solid transparent;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: #111827;
    background-image: linear-gradient(to right, var(--brand-gold-500), var(--brand-gold-700));
    cursor: pointer;
    transition: all 0.15s ease;
}

.btn-action-primary:hover,
.btn-action-success:hover,
.btn-action-info:hover {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

/* Bot√µes de Precifica√ß√£o (Downsells) */
.pricing-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    font-weight: 700;
    transition: all 0.15s ease;
    cursor: pointer;
}

.pricing-btn-active {
    color: #111827;
    background-image: linear-gradient(to right, var(--brand-gold-500), var(--brand-gold-700));
    border: 2px solid var(--brand-gold-500);
    box-shadow: 0 4px 12px rgba(255, 184, 0, 0.3);
}

.pricing-btn-inactive {
    color: #9CA3AF;
    background: #1F2937;
    border: 2px solid #374151;
}

.pricing-btn-inactive:hover {
    color: #D1D5DB;
    border-color: #4B5563;
    background: #374151;
}
</style>
{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8" x-data="botConfigApp()" x-init="init()">
    
    <!-- Header -->
    <div class="mb-8 flex items-center justify-between">
        <div class="flex items-center gap-4">
            <a href="{{ url_for('dashboard') }}" 
               class="w-10 h-10 flex items-center justify-center rounded-lg border border-gray-700 text-gray-400 hover:text-white hover:border-yellow-500 transition-all">
                <i class="fas fa-arrow-left"></i>
            </a>
            <div>
                <h1 class="text-3xl font-bold text-white">{{ bot.name }}</h1>
                <p class="text-sm text-gray-500 mt-1">@{{ bot.username }}</p>
            </div>
        </div>
        <div class="flex items-center space-x-3">
            <!-- ‚ùå REMOVIDO: Meta Pixel agora √© configurado POR POOL (n√£o por bot) -->
            <!-- Acesse: Redirecionadores ‚Üí Editar Pool ‚Üí Meta Pixel -->
            <button @click="saveConfig()" 
                    :disabled="loading"
                    :class="{'opacity-50 cursor-not-allowed': loading}"
                    class="btn-action btn-action-primary">
                <span x-show="!loading">
                    <i class="fas fa-save mr-2"></i>
                    Salvar Configura√ß√µes
                </span>
                <span x-show="loading">
                    <i class="fas fa-spinner fa-spin mr-2"></i>
                    Salvando...
                </span>
            </button>
        </div>
    </div>

    <!-- Tabs -->
    <div class="tab-nav">
        <button @click="activeTab = 'welcome'" 
                :class="{'active': activeTab === 'welcome'}"
                class="tab-button">
            <i class="fas fa-home mr-2"></i>Boas-vindas
        </button>
        <button @click="activeTab = 'buttons'" 
                :class="{'active': activeTab === 'buttons'}"
                class="tab-button">
            <i class="fas fa-shopping-cart mr-2"></i>Bot√µes
        </button>
        <button @click="activeTab = 'downsells'" 
                :class="{'active': activeTab === 'downsells'}"
                class="tab-button">
            <i class="fas fa-arrow-down mr-2"></i>Downsells
        </button>
        <button @click="activeTab = 'upsells'" 
                :class="{'active': activeTab === 'upsells'}"
                class="tab-button">
            <i class="fas fa-arrow-up mr-2"></i>Upsells
        </button>
        <button @click="activeTab = 'access'" 
                :class="{'active': activeTab === 'access'}"
                class="tab-button">
            <i class="fas fa-key mr-2"></i>Acesso
        </button>
        <button @click="activeTab = 'remarketing'" 
                :class="{'active': activeTab === 'remarketing'}"
                class="tab-button">
            <i class="fas fa-bullhorn mr-2"></i>Remarketing
        </button>
        <button @click="activeTab = 'settings'" 
                :class="{'active': activeTab === 'settings'}"
                class="tab-button">
            <i class="fas fa-cog mr-2"></i>Configura√ß√µes
        </button>
    </div>

    <!-- Tab Content: Welcome -->
    <div x-show="activeTab === 'welcome'" x-cloak>
        <div class="config-section">
            <div class="config-section-header">
                <i class="fas fa-home text-2xl" style="color: var(--brand-gold-500);"></i>
                <div>
                    <div class="config-section-title">Mensagem de Boas-vindas</div>
                    <div class="config-section-description">Primeira impress√£o quando o usu√°rio inicia o bot</div>
                </div>
            </div>

            <!-- Mensagem -->
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-comment-dots mr-2 text-yellow-500"></i>
                    Mensagem de Texto
                </label>
                <textarea x-model="config.welcome_message" 
                          class="form-textarea"
                          placeholder="Ol√°! Bem-vindo ao nosso bot de vendas...&#10;&#10;Escolha uma das op√ß√µes abaixo:"></textarea>
                <div class="info-box-warning info-box mt-3">
                    <p class="text-sm text-gray-300">
                        <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
                        <strong>Dica:</strong> Use HTML para formata√ß√£o: <code class="px-2 py-0.5 bg-gray-900 rounded text-yellow-400 text-xs">&lt;b&gt;negrito&lt;/b&gt;</code>
                    </p>
                </div>
            </div>

            <!-- M√≠dia -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-link mr-2 text-blue-500"></i>
                        URL da M√≠dia
                    </label>
                    <input type="url" 
                           x-model="config.welcome_media_url" 
                           class="form-input"
                           placeholder="https://t.me/canal/123">
                    <p class="text-xs text-gray-500 mt-2">Link do Telegram (v√≠deo, foto ou √°udio)</p>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-image mr-2 text-blue-500"></i>
                        Tipo de M√≠dia Principal
                    </label>
                    <div class="flex gap-3 mt-2">
                        <label class="flex items-center gap-2 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg cursor-pointer hover:border-blue-500 transition-colors flex-1"
                               :class="{'border-blue-500 bg-blue-500 bg-opacity-10': config.welcome_media_type === 'video'}">
                            <input type="radio" x-model="config.welcome_media_type" value="video" class="text-blue-500">
                            <i class="fas fa-video text-blue-500"></i>
                            <span class="text-sm text-white">V√≠deo</span>
                        </label>
                        <label class="flex items-center gap-2 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg cursor-pointer hover:border-blue-500 transition-colors flex-1"
                               :class="{'border-blue-500 bg-blue-500 bg-opacity-10': config.welcome_media_type === 'photo'}">
                            <input type="radio" x-model="config.welcome_media_type" value="photo" class="text-blue-500">
                            <i class="fas fa-camera text-blue-500"></i>
                            <span class="text-sm text-white">Foto</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label flex items-center gap-2">
                        <input type="checkbox" 
                               x-model="config.welcome_audio_enabled"
                               class="w-4 h-4 bg-gray-700 border-gray-600 rounded focus:ring-blue-500"
                               style="accent-color: #3B82F6;">
                        <i class="fas fa-microphone mr-1 text-purple-500"></i>
                        <span>Adicionar √Åudio Complementar (opcional)</span>
                    </label>
                    <div x-show="config.welcome_audio_enabled" x-cloak class="mt-2">
                        <input type="url" 
                               x-model="config.welcome_audio_url" 
                               class="form-input"
                               placeholder="https://t.me/canal/789">
                        <p class="text-xs text-gray-500 mt-2">Link do √°udio no Telegram (ser√° enviado ap√≥s a m√≠dia principal)</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab Content: Buttons -->
    <div x-show="activeTab === 'buttons'" x-cloak>
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-2xl font-bold text-white">Bot√µes de Venda</h2>
                <p class="text-sm text-gray-500 mt-1">Bot√µes que geram PIX automaticamente</p>
            </div>
            <button @click="addButton()" class="btn-action btn-action-success">
                <i class="fas fa-plus mr-2"></i>
                Adicionar Bot√£o
            </button>
        </div>

        <!-- Lista de Bot√µes -->
        <template x-if="config.main_buttons.length > 0">
            <div class="space-y-4">
                <template x-for="(button, index) in config.main_buttons" :key="index">
                    <div class="button-card">
                        <!-- Header -->
                        <div class="button-card-header">
                            <div class="flex items-center gap-3">
                                <div class="button-index" x-text="index + 1"></div>
                                <div>
                                    <h3 class="text-sm font-bold text-white">Bot√£o <span x-text="index + 1"></span></h3>
                                    <p class="text-xs text-gray-500">Configure pre√ßo e order bump</p>
                                </div>
                            </div>
                            <button @click="removeButton(index)" 
                                    class="w-10 h-10 flex items-center justify-center rounded-lg border border-red-500 text-red-400 hover:bg-red-500 hover:bg-opacity-10 transition-all">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>

                        <!-- Campos Principais -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-tag mr-2 text-yellow-500"></i>
                                    Texto do Bot√£o
                                </label>
                                <input type="text" 
                                       x-model="button.text" 
                                       class="form-input"
                                       placeholder="Comprar por R$ 19,97">
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-dollar-sign mr-2 text-green-500"></i>
                                    Pre√ßo (R$)
                                </label>
                                <input type="number" 
                                       x-model="button.price" 
                                       step="0.01"
                                       class="form-input text-center font-mono"
                                       placeholder="19.97">
                            </div>

                            <div class="form-group md:col-span-2">
                                <label class="form-label">
                                    <i class="fas fa-box mr-2 text-blue-500"></i>
                                    Descri√ß√£o
                                </label>
                                <input type="text" 
                                       x-model="button.description" 
                                       class="form-input"
                                       placeholder="Curso Completo de...">
                            </div>
                        </div>

                        <!-- M√∫ltiplos Order Bumps -->
                        <div class="order-bumps-section">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-gift text-yellow-500"></i>
                                    <span class="text-sm font-bold text-white">Order Bumps (Ofertas Sequenciais)</span>
                                </div>
                                <button @click="addOrderBump(index)" 
                                        class="px-3 py-1.5 bg-yellow-500 bg-opacity-25 border border-yellow-400 rounded-lg text-xs font-bold text-yellow-300 hover:bg-yellow-500 hover:bg-opacity-50 transition-all">
                                    <i class="fas fa-plus mr-1"></i>
                                    Adicionar Order Bump
                                </button>
                            </div>

                            <!-- Lista de Order Bumps -->
                            <template x-if="button.order_bumps && button.order_bumps.length > 0">
                                <div class="space-y-4">
                                    <template x-for="(orderBump, bumpIndex) in button.order_bumps" :key="bumpIndex">
                                        <div class="order-bump-card">
                                            <div class="order-bump-header">
                                                <div class="flex items-center gap-3">
                                                    <div class="order-bump-index" x-text="bumpIndex + 1"></div>
                                                    <div>
                                                        <h4 class="text-sm font-bold text-white">Order Bump <span x-text="bumpIndex + 1"></span></h4>
                                                        <p class="text-xs text-gray-500">Oferta sequencial</p>
                                                    </div>
                                                </div>
                                                <div class="flex items-center gap-2">
                                                    <label class="flex items-center gap-2 cursor-pointer">
                                                        <input type="checkbox" 
                                                               x-model="orderBump.enabled"
                                                               class="w-4 h-4 rounded border-gray-600 bg-gray-800 text-yellow-500">
                                                        <span class="text-xs text-white">Ativo</span>
                                                    </label>
                                                    <button @click="removeOrderBump(index, bumpIndex)" 
                                                            class="w-8 h-8 flex items-center justify-center rounded-lg border border-red-500 text-red-400 hover:bg-red-500 hover:bg-opacity-10 transition-all">
                                                        <i class="fas fa-trash text-xs"></i>
                                                    </button>
                                                </div>
                                            </div>

                                            <div x-show="orderBump.enabled" class="space-y-4">
                                                <div class="form-group">
                                                    <label class="form-label">Mensagem da Oferta</label>
                                                    <textarea x-model="orderBump.message" 
                                                              class="form-textarea"
                                                              placeholder="üéÅ Oferta Especial!&#10;&#10;Adicione este b√¥nus por apenas +R$ 5!"></textarea>
                                                </div>

                                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div class="form-group">
                                                        <label class="form-label">Pre√ßo Adicional (R$)</label>
                                                        <input type="number" 
                                                               x-model="orderBump.price" 
                                                               step="0.01"
                                                               class="form-input text-center font-mono"
                                                               placeholder="5.00">
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="form-label">Descri√ß√£o do B√¥nus</label>
                                                        <input type="text" 
                                                               x-model="orderBump.description" 
                                                               class="form-input"
                                                               placeholder="Acesso Vital√≠cio">
                                                    </div>
                                                </div>

                                                <!-- M√≠dia do Order Bump -->
                                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div class="form-group">
                                                        <label class="form-label">
                                                            <i class="fas fa-link mr-2 text-blue-500"></i>
                                                            URL da M√≠dia (opcional)
                                                        </label>
                                                        <input type="url" 
                                                               x-model="orderBump.media_url" 
                                                               class="form-input"
                                                               placeholder="https://t.me/canal/789">
                                                        <p class="text-xs text-gray-500 mt-2">Link do Telegram</p>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="form-label">
                                                            <i class="fas fa-image mr-2 text-blue-500"></i>
                                                            Tipo de M√≠dia
                                                        </label>
                                                        <div class="flex gap-3 mt-2">
                                                            <label class="flex items-center gap-2 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg cursor-pointer hover:border-blue-500 transition-colors flex-1"
                                                                   :class="{'border-blue-500 bg-blue-500 bg-opacity-10': orderBump.media_type === 'video'}">
                                                                <input type="radio" x-model="orderBump.media_type" value="video" class="text-blue-500">
                                                                <i class="fas fa-video text-blue-500"></i>
                                                                <span class="text-sm text-white">V√≠deo</span>
                                                            </label>
                                                            <label class="flex items-center gap-2 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg cursor-pointer hover:border-blue-500 transition-colors flex-1"
                                                                   :class="{'border-blue-500 bg-blue-500 bg-opacity-10': orderBump.media_type === 'photo'}">
                                                                <input type="radio" x-model="orderBump.media_type" value="photo" class="text-blue-500">
                                                                <i class="fas fa-camera text-blue-500"></i>
                                                                <span class="text-sm text-white">Foto</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Bot√µes Personalizados -->
                                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div class="form-group">
                                                        <label class="form-label">
                                                            <i class="fas fa-check-circle mr-2 text-green-400"></i>
                                                            Bot√£o Aceitar (opcional)
                                                        </label>
                                                        <input type="text" 
                                                               x-model="orderBump.accept_text" 
                                                               class="form-input"
                                                               placeholder="SIM! Quero esse b√¥nus!">
                                                        <p class="text-xs text-gray-500 mt-1">Deixe vazio para texto padr√£o</p>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="form-label">
                                                            <i class="fas fa-times-circle mr-2 text-red-400"></i>
                                                            Bot√£o Recusar (opcional)
                                                        </label>
                                                        <input type="text" 
                                                               x-model="orderBump.decline_text" 
                                                               class="form-input"
                                                               placeholder="N√£o, obrigado">
                                                        <p class="text-xs text-gray-500 mt-1">Deixe vazio para texto padr√£o</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </template>

                            <!-- Empty State -->
                            <template x-if="!button.order_bumps || button.order_bumps.length === 0">
                                <div class="text-center py-8 border-2 border-dashed border-gray-700 rounded-lg">
                                    <div class="text-4xl mb-3">üéÅ</div>
                                    <h4 class="text-lg font-bold text-white mb-2">Nenhum Order Bump</h4>
                                    <p class="text-gray-500 mb-4">Adicione ofertas sequenciais para aumentar o ticket m√©dio</p>
                                    <button @click="addOrderBump(index)" 
                                            class="px-4 py-2 bg-yellow-500 bg-opacity-25 border border-yellow-400 rounded-lg text-sm font-bold text-yellow-300 hover:bg-yellow-500 hover:bg-opacity-50 transition-all">
                                        <i class="fas fa-plus mr-2"></i>
                                        Adicionar Primeiro Order Bump
                                    </button>
                                </div>
                            </template>

                            <div class="info-box-warning info-box">
                                <p class="text-sm text-gray-300">
                                    <i class="fas fa-chart-line mr-2 text-yellow-500"></i>
                                    <strong>Convers√£o:</strong> M√∫ltiplos order bumps convertem at√© 80% mais! Se o usu√°rio recusar um, receber√° o pr√≥ximo automaticamente.
                                </p>
                            </div>
                        </div>
                        </div>
                    </div>
                </template>
            </div>
        </template>

        <!-- Empty State -->
        <template x-if="config.main_buttons.length === 0">
            <div class="text-center py-16">
                <div class="text-6xl mb-4">üõçÔ∏è</div>
                <h3 class="text-xl font-bold text-white mb-2">Nenhum bot√£o criado</h3>
                <p class="text-gray-500 mb-6">Adicione seus primeiros bot√µes de venda</p>
                <button @click="addButton()" class="btn-action btn-action-success">
                    <i class="fas fa-plus mr-2"></i>
                    Adicionar Primeiro Bot√£o
                </button>
            </div>
        </template>
    </div>

    <!-- Bot√µes de Redirecionamento (dentro da tab Bot√µes) -->
    <div x-show="activeTab === 'buttons'" x-cloak class="mt-8">
        <div class="border-t border-gray-800 pt-8">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">
                        <i class="fas fa-external-link-alt text-blue-500"></i>
                        Bot√µes de Link
                    </h2>
                    <p class="text-sm text-gray-500 mt-1">Bot√µes que levam para links externos (sem pagamento)</p>
                </div>
                <button @click="addRedirectButton()" class="btn-action btn-action-info">
                    <i class="fas fa-plus"></i>
                    Adicionar Link
                </button>
            </div>

            <template x-if="config.redirect_buttons.length > 0">
                <div class="space-y-3">
                    <template x-for="(button, index) in config.redirect_buttons" :key="index">
                        <div class="flex items-center gap-3 p-4 bg-gray-900 border border-gray-800 rounded-lg">
                            <i class="fas fa-link text-blue-500"></i>
                            <input type="text" 
                                   x-model="button.text" 
                                   class="flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white text-sm"
                                   placeholder="Texto do bot√£o">
                            <input type="url" 
                                   x-model="button.url" 
                                   class="flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white text-sm font-mono"
                                   placeholder="https://...">
                            <button @click="removeRedirectButton(index)" 
                                    class="w-10 h-10 flex items-center justify-center rounded border border-red-500 text-red-400 hover:bg-red-500 hover:bg-opacity-10">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </template>
                </div>
            </template>

            <template x-if="config.redirect_buttons.length === 0">
                <div class="text-center py-8 border-2 border-dashed border-gray-800 rounded-lg">
                    <i class="fas fa-external-link-alt text-4xl text-gray-700 mb-2"></i>
                    <p class="text-sm text-gray-500">Nenhum bot√£o de link configurado</p>
                    <p class="text-xs text-gray-600 mt-1">Use para grupos, canais, sites externos, etc.</p>
                </div>
            </template>
        </div>
    </div>

    <!-- Tab Content: Downsells -->
    <div x-show="activeTab === 'downsells'" x-cloak>
        <div class="config-section">
            <div class="config-section-header">
                <i class="fas fa-arrow-down text-2xl text-red-400"></i>
                <div>
                    <div class="config-section-title">Downsells</div>
                    <div class="config-section-description">Ofertas enviadas quando o pagamento n√£o √© confirmado</div>
                </div>
                <label class="ml-auto flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" 
                           x-model="config.downsells_enabled"
                           class="w-5 h-5 rounded border-gray-600 bg-gray-800 text-yellow-500">
                    <span class="text-sm font-bold text-white">Habilitar</span>
                </label>
            </div>

            <div x-show="config.downsells_enabled" class="space-y-4">
                <template x-for="(downsell, index) in config.downsells" :key="index">
                    <div class="button-card">
                        <div class="button-card-header">
                            <h4 class="text-sm font-bold text-white">Downsell <span x-text="index + 1"></span></h4>
                            <button @click="removeDownsell(index)" class="text-red-400 hover:text-red-300">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>

                        <div class="space-y-4">
                            <div class="form-group">
                                <label class="form-label">Delay (minutos)</label>
                                <input type="number" x-model="downsell.delay_minutes" class="form-input" placeholder="5">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Mensagem</label>
                                <textarea x-model="downsell.message" class="form-textarea" placeholder="Oferta especial!"></textarea>
                            </div>

                            <!-- ‚úÖ MODO DE PRECIFICA√á√ÉO (Pre√ßo Fixo vs Desconto %) -->
                            <div class="p-4 bg-gray-900 border border-gray-800 rounded-xl">
                                <label class="form-label mb-3">
                                    <i class="fas fa-calculator mr-2" style="color: var(--brand-gold-500);"></i>
                                    <span class="text-white font-bold">Modo de Precifica√ß√£o</span>
                                </label>
                                
                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <button type="button"
                                            @click="downsell.pricing_mode = 'fixed'"
                                            :class="(downsell.pricing_mode || 'fixed') === 'fixed' ? 'pricing-btn-active' : 'pricing-btn-inactive'"
                                            class="pricing-btn">
                                        <i class="fas fa-dollar-sign"></i>
                                        Pre√ßo Fixo
                                    </button>
                                    <button type="button"
                                            @click="downsell.pricing_mode = 'percentage'"
                                            :class="downsell.pricing_mode === 'percentage' ? 'pricing-btn-active' : 'pricing-btn-inactive'"
                                            class="pricing-btn">
                                        <i class="fas fa-percent"></i>
                                        Desconto %
                                    </button>
                                </div>

                                <!-- Modo: Pre√ßo Fixo -->
                                <div x-show="(downsell.pricing_mode || 'fixed') === 'fixed'" class="form-group">
                                    <label class="form-label">Pre√ßo Fixo (R$)</label>
                                    <input type="number" 
                                           x-model="downsell.price" 
                                           step="0.01" 
                                           class="form-input text-center font-mono font-bold"
                                           placeholder="14.97">
                                    <div class="info-box mt-2">
                                        <p class="text-xs text-gray-400">
                                            <i class="fas fa-info-circle mr-1 text-blue-400"></i>
                                            Valor fixo do downsell
                                        </p>
                                    </div>
                                </div>

                                <!-- Modo: Desconto Percentual -->
                                <div x-show="downsell.pricing_mode === 'percentage'" class="form-group">
                                    <label class="form-label">Desconto Percentual (%)</label>
                                    <input type="number" 
                                           x-model="downsell.discount_percentage" 
                                           min="1" 
                                           max="95" 
                                           step="1" 
                                           class="form-input text-center font-mono font-bold"
                                           placeholder="50">
                                    <div class="info-box-warning info-box mt-2">
                                        <p class="text-xs text-gray-300">
                                            <i class="fas fa-magic mr-1" style="color: var(--brand-gold-500);"></i>
                                            <strong style="color: var(--brand-gold-500);">Exemplo:</strong> 
                                            50% de R$ 19,97 = R$ 9,99
                                        </p>
                                        <p class="text-xs text-gray-400 mt-1">
                                            O desconto √© calculado sobre o pre√ßo do bot√£o que o cliente clicou
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- M√≠dia (URL + Tipo) -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-link mr-2 text-blue-500"></i>
                                        URL da M√≠dia (opcional)
                                    </label>
                                    <input type="url" 
                                           x-model="downsell.media_url" 
                                           class="form-input"
                                           placeholder="https://t.me/canal/123">
                                    <p class="text-xs text-gray-500 mt-2">Link do Telegram</p>
                                </div>

                                    <div class="form-group">
                                        <label class="form-label">
                                            <i class="fas fa-image mr-2 text-blue-500"></i>
                                            Tipo de M√≠dia Principal
                                        </label>
                                        <div class="flex gap-3 mt-2">
                                            <label class="flex items-center gap-2 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg cursor-pointer hover:border-yellow-500 transition-colors flex-1"
                                                   :class="{'border-yellow-500 bg-yellow-500 bg-opacity-10': downsell.media_type === 'video'}">
                                                <input type="radio" x-model="downsell.media_type" value="video" class="text-yellow-500">
                                                <i class="fas fa-video text-yellow-500"></i>
                                                <span class="text-sm text-white">V√≠deo</span>
                                            </label>
                                            <label class="flex items-center gap-2 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg cursor-pointer hover:border-yellow-500 transition-colors flex-1"
                                                   :class="{'border-yellow-500 bg-yellow-500 bg-opacity-10': downsell.media_type === 'photo'}">
                                                <input type="radio" x-model="downsell.media_type" value="photo" class="text-yellow-500">
                                                <i class="fas fa-camera text-yellow-500"></i>
                                                <span class="text-sm text-white">Foto</span>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label flex items-center gap-2">
                                            <input type="checkbox" 
                                                   x-model="downsell.audio_enabled"
                                                   class="w-4 h-4 bg-gray-700 border-gray-600 rounded focus:ring-purple-500"
                                                   style="accent-color: #A855F7;">
                                            <i class="fas fa-microphone mr-1 text-purple-500"></i>
                                            <span>Adicionar √Åudio Complementar</span>
                                        </label>
                                        <div x-show="downsell.audio_enabled" x-cloak class="mt-2">
                                            <input type="url" 
                                                   x-model="downsell.audio_url" 
                                                   class="form-input"
                                                   placeholder="https://t.me/canal/audio2">
                                            <p class="text-xs text-gray-500 mt-2">√Åudio enviado ap√≥s a m√≠dia principal</p>
                                        </div>
                                    </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-mouse-pointer mr-2 text-green-400"></i>
                                    Texto do Bot√£o (opcional)
                                </label>
                                <input type="text" 
                                       x-model="downsell.button_text" 
                                       class="form-input" 
                                       placeholder="üõí Comprar Agora!">
                                <div class="info-box mt-2">
                                    <p class="text-xs text-gray-400">
                                        <i class="fas fa-lightbulb mr-1" style="color: var(--brand-gold-500);"></i>
                                        Deixe vazio para usar: "üõí Comprar por R$ XX,XX"
                                    </p>
                                </div>
                            </div>

                            <!-- Order Bump para Downsell V2.0 -->
                            <div class="order-bump-section">
                                <div class="flex items-center justify-between mb-4">
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" 
                                               x-model="downsell.order_bump.enabled"
                                               class="w-5 h-5 rounded border-gray-600 bg-gray-800 text-yellow-500">
                                        <span class="text-sm font-bold text-white">
                                            <i class="fas fa-gift mr-2 text-yellow-500"></i>
                                            Order Bump (Oferta Extra no Downsell)
                                        </span>
                                    </label>
                                    <span x-show="downsell.order_bump.enabled" 
                                          class="px-3 py-1.5 bg-green-500 bg-opacity-25 border-2 border-green-400 rounded-full text-xs font-bold text-white shadow-lg"
                                          style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.3) 0%, rgba(5, 150, 105, 0.3) 100%);">
                                        <i class="fas fa-check-circle mr-1 text-green-300"></i>
                                        ATIVO
                                    </span>
                                </div>

                                <div x-show="downsell.order_bump.enabled" class="space-y-4">
                                    <!-- ‚úÖ V2.0: Order Bumps dos Bot√µes Principais (Bot√µes Clic√°veis) -->
                                    <div class="form-group" x-show="getAvailableOrderBumps().length > 0">
                                        <label class="form-label mb-3">
                                            <i class="fas fa-gift mr-2 text-yellow-500"></i>
                                            Order Bumps Configurados nos Bot√µes
                                        </label>
                                        <p class="text-xs text-gray-500 mb-3">
                                            Clique em um order bump abaixo para us√°-lo neste downsell. Estes s√£o os order bumps que voc√™ j√° configurou na aba "Bot√µes".
                                        </p>
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                            <template x-for="(orderBumpRef, idx) in getAvailableOrderBumps()" :key="idx">
                                                <button 
                                                    type="button"
                                                    @click="useOrderBumpFromButtons(downsell, orderBumpRef.buttonIndex, orderBumpRef.bumpIndex)"
                                                    class="p-4 bg-gray-800 border-2 rounded-lg transition-all text-left hover:border-yellow-500 hover:bg-gray-750"
                                                    :class="{'border-yellow-500 bg-yellow-500 bg-opacity-10': downsell.order_bump.button_index === orderBumpRef.buttonIndex && downsell.order_bump.bump_index === orderBumpRef.bumpIndex, 'border-gray-700': downsell.order_bump.button_index !== orderBumpRef.buttonIndex || downsell.order_bump.bump_index !== orderBumpRef.bumpIndex}"
                                                >
                                                    <div class="flex items-start justify-between mb-2">
                                                        <div class="flex items-center gap-2">
                                                            <i class="fas fa-gift text-yellow-500"></i>
                                                            <span class="text-sm font-bold text-white">
                                                                Bot√£o <span x-text="orderBumpRef.buttonIndex + 1"></span> - OB <span x-text="orderBumpRef.bumpIndex + 1"></span>
                                                            </span>
                                                        </div>
                                                        <span x-show="downsell.order_bump.button_index === orderBumpRef.buttonIndex && downsell.order_bump.bump_index === orderBumpRef.bumpIndex" 
                                                              class="px-2 py-1 bg-green-500 bg-opacity-25 border border-green-400 rounded text-xs text-green-300">
                                                            <i class="fas fa-check-circle"></i>
                                                        </span>
                                                    </div>
                                                    <p class="text-xs text-gray-400 mb-1 line-clamp-2" x-text="(orderBumpRef.orderBump.message || 'Sem mensagem').substring(0, 60) + '...'"></p>
                                                    <div class="flex items-center justify-between mt-2 pt-2 border-t border-gray-700">
                                                        <div>
                                                            <span class="text-xs font-bold text-yellow-500" x-show="orderBumpRef.orderBump.price > 0">
                                                                R$ <span x-text="orderBumpRef.orderBump.price.toFixed(2)"></span>
                                                            </span>
                                                            <span class="text-xs text-gray-500" x-show="orderBumpRef.orderBump.price === 0">
                                                                Sem pre√ßo
                                                            </span>
                                                        </div>
                                                        <span class="text-xs text-gray-400 truncate max-w-[60%]" x-text="orderBumpRef.orderBump.description || 'Sem descri√ß√£o'"></span>
                                                    </div>
                                                </button>
                                            </template>
                                        </div>
                                    </div>

                                    <!-- Empty State: Nenhum Order Bump Configurado -->
                                    <div x-show="getAvailableOrderBumps().length === 0" class="info-box-warning info-box">
                                        <p class="text-sm text-gray-300">
                                            <i class="fas fa-info-circle mr-2 text-yellow-500"></i>
                                            <strong>Nenhum order bump configurado:</strong> V√° na aba "Bot√µes", configure seus bot√µes principais e adicione order bumps l√°. 
                                            Eles aparecer√£o aqui como bot√µes clic√°veis para reutilizar nos downsells.
                                        </p>
                                    </div>

                                    <!-- Divider: Configura√ß√£o Manual -->
                                    <div class="flex items-center gap-3 my-4">
                                        <div class="flex-1 border-t border-gray-700"></div>
                                        <span class="text-xs text-gray-500 font-semibold">OU CONFIGURE MANUALMENTE</span>
                                        <div class="flex-1 border-t border-gray-700"></div>
                                    </div>

                                    <!-- Configura√ß√£o Manual -->
                                    <div>
                                    <div class="form-group">
                                        <label class="form-label">Mensagem do Order Bump</label>
                                        <textarea x-model="downsell.order_bump.message" 
                                                  class="form-textarea"
                                                  placeholder="üéÅ Oferta Especial!&#10;&#10;Adicione este b√¥nus por apenas +R$ 5!"></textarea>
                                    </div>

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="form-group">
                                            <label class="form-label">Pre√ßo Adicional (R$)</label>
                                            <input type="number" 
                                                   x-model="downsell.order_bump.price" 
                                                   step="0.01"
                                                   class="form-input text-center font-mono"
                                                   placeholder="5.00">
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Descri√ß√£o do B√¥nus</label>
                                            <input type="text" 
                                                   x-model="downsell.order_bump.description" 
                                                   class="form-input"
                                                   placeholder="Acesso Vital√≠cio">
                                        </div>
                                    </div>

                                    <!-- M√≠dia do Order Bump -->
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="form-group">
                                            <label class="form-label">
                                                <i class="fas fa-link mr-2 text-blue-500"></i>
                                                URL da M√≠dia (opcional)
                                            </label>
                                            <input type="url" 
                                                   x-model="downsell.order_bump.media_url" 
                                                   class="form-input"
                                                   placeholder="https://t.me/canal/789">
                                            <p class="text-xs text-gray-500 mt-2">Link do Telegram</p>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">
                                                <i class="fas fa-image mr-2 text-blue-500"></i>
                                                Tipo de M√≠dia
                                            </label>
                                            <div class="flex gap-3 mt-2">
                                                <label class="flex items-center gap-2 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg cursor-pointer hover:border-blue-500 transition-colors flex-1"
                                                       :class="{'border-blue-500 bg-blue-500 bg-opacity-10': downsell.order_bump.media_type === 'video'}">
                                                    <input type="radio" x-model="downsell.order_bump.media_type" value="video" class="text-blue-500">
                                                    <i class="fas fa-video text-blue-500"></i>
                                                    <span class="text-sm text-white">V√≠deo</span>
                                                </label>
                                                <label class="flex items-center gap-2 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg cursor-pointer hover:border-blue-500 transition-colors flex-1"
                                                       :class="{'border-blue-500 bg-blue-500 bg-opacity-10': downsell.order_bump.media_type === 'photo'}">
                                                    <input type="radio" x-model="downsell.order_bump.media_type" value="photo" class="text-blue-500">
                                                    <i class="fas fa-camera text-blue-500"></i>
                                                    <span class="text-sm text-white">Foto</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Bot√µes Personalizados -->
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="form-group">
                                            <label class="form-label">
                                                <i class="fas fa-check-circle mr-2 text-green-400"></i>
                                                Bot√£o Aceitar (opcional)
                                            </label>
                                            <input type="text" 
                                                   x-model="downsell.order_bump.accept_text" 
                                                   class="form-input"
                                                   placeholder="SIM! Quero esse b√¥nus!">
                                            <p class="text-xs text-gray-500 mt-1">Deixe vazio para texto padr√£o</p>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">
                                                <i class="fas fa-times-circle mr-2 text-red-400"></i>
                                                Bot√£o Recusar (opcional)
                                            </label>
                                            <input type="text" 
                                                   x-model="downsell.order_bump.decline_text" 
                                                   class="form-input"
                                                   placeholder="N√£o, obrigado">
                                            <p class="text-xs text-gray-500 mt-1">Deixe vazio para texto padr√£o</p>
                                        </div>
                                    </div>

                                    </div>

                                    <!-- Preview do Order Bump Selecionado dos Bot√µes -->
                                    <div x-show="downsell.order_bump.button_index !== null && downsell.order_bump.button_index !== undefined && downsell.order_bump.bump_index !== null && downsell.order_bump.bump_index !== undefined" 
                                         class="info-box-success info-box" 
                                         style="background: rgba(16, 185, 129, 0.1); border-left: 4px solid #10B981;">
                                        <div class="flex items-start gap-3">
                                            <i class="fas fa-check-circle text-green-400 text-xl mt-1"></i>
                                            <div class="flex-1">
                                                <p class="text-sm font-bold text-white mb-2">
                                                    ‚úÖ Order Bump dos Bot√µes Selecionado
                                                </p>
                                                <div class="space-y-1 text-sm text-gray-300">
                                                    <p><strong>Origem:</strong> Bot√£o <span x-text="(downsell.order_bump.button_index || 0) + 1"></span> - Order Bump <span x-text="(downsell.order_bump.bump_index || 0) + 1"></span></p>
                                                    <p><strong>Pre√ßo:</strong> R$ <span x-text="(parseFloat(downsell.order_bump.price) || 0).toFixed(2)"></span></p>
                                                    <p><strong>Descri√ß√£o:</strong> <span x-text="downsell.order_bump.description || 'Sem descri√ß√£o'"></span></p>
                                                    <p x-show="downsell.order_bump.message" class="mt-2 text-xs text-gray-400 line-clamp-2"><strong>Mensagem:</strong> <span x-text="downsell.order_bump.message"></span></p>
                                                </div>
                                                <p class="text-xs text-gray-500 mt-2">
                                                    <i class="fas fa-info-circle mr-1"></i>
                                                    Este order bump est√° sendo reutilizado dos bot√µes principais. Para alterar, edite na aba "Bot√µes" ou configure manualmente acima.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <button @click="addDownsell()" class="w-full py-3 border-2 border-dashed border-gray-700 rounded-lg text-gray-400 hover:border-yellow-500 hover:text-yellow-500 transition-all">
                    <i class="fas fa-plus mr-2"></i>
                    Adicionar Downsell
                </button>
            </div>
        </div>
    </div>

    <!-- Tab Content: Upsells -->
    <div x-show="activeTab === 'upsells'" x-cloak>
        <div class="config-section">
            <div class="config-section-header">
                <i class="fas fa-arrow-up text-2xl text-green-400"></i>
                <div>
                    <div class="config-section-title">Upsells</div>
                    <div class="config-section-description">Ofertas enviadas AP√ìS compra aprovada</div>
                </div>
                <label class="ml-auto flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" 
                           x-model="config.upsells_enabled"
                           class="w-5 h-5 rounded border-gray-600 bg-gray-800 text-green-500">
                    <span class="text-sm font-bold text-white">Habilitar</span>
                </label>
            </div>

            <div x-show="config.upsells_enabled" class="space-y-4">
                <template x-for="(upsell, index) in config.upsells" :key="index">
                    <div class="button-card">
                        <div class="button-card-header">
                            <h4 class="text-sm font-bold text-white">Upsell <span x-text="index + 1"></span></h4>
                            <button @click="removeUpsell(index)" class="text-red-400 hover:text-red-300">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>

                        <div class="space-y-4">
                            <div class="form-group">
                                <label class="form-label">Produto Trigger (opcional)</label>
                                <input type="text" x-model="upsell.trigger_product" class="form-input" placeholder="Ex: INSS B√°sico (vazio = todos)">
                                <p class="text-xs text-gray-500 mt-1">Deixe vazio para disparar em todas as compras</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Delay (minutos)</label>
                                <input type="number" x-model="upsell.delay_minutes" class="form-input" placeholder="0">
                                <p class="text-xs text-gray-500 mt-1">0 = envio imediato ap√≥s pagamento</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Mensagem</label>
                                <textarea x-model="upsell.message" class="form-textarea" placeholder="üî• Upgrade para Premium!"></textarea>
                            </div>

                            <!-- M√≠dia (URL + Tipo) -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-link mr-2 text-blue-500"></i>
                                        URL da M√≠dia (opcional)
                                    </label>
                                    <input type="url" 
                                           x-model="upsell.media_url" 
                                           class="form-input"
                                           placeholder="https://t.me/canal/456">
                                    <p class="text-xs text-gray-500 mt-2">Link do Telegram</p>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-image mr-2 text-blue-500"></i>
                                        Tipo de M√≠dia Principal
                                    </label>
                                    <div class="flex gap-3 mt-2">
                                        <label class="flex items-center gap-2 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg cursor-pointer hover:border-blue-500 transition-colors flex-1"
                                               :class="{'border-blue-500 bg-blue-500 bg-opacity-10': upsell.media_type === 'video'}">
                                            <input type="radio" x-model="upsell.media_type" value="video" class="text-blue-500">
                                            <i class="fas fa-video text-blue-500"></i>
                                            <span class="text-sm text-white">V√≠deo</span>
                                        </label>
                                        <label class="flex items-center gap-2 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg cursor-pointer hover:border-blue-500 transition-colors flex-1"
                                               :class="{'border-blue-500 bg-blue-500 bg-opacity-10': upsell.media_type === 'photo'}">
                                            <input type="radio" x-model="upsell.media_type" value="photo" class="text-blue-500">
                                            <i class="fas fa-camera text-blue-500"></i>
                                            <span class="text-sm text-white">Foto</span>
                                        </label>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label flex items-center gap-2">
                                        <input type="checkbox" 
                                               x-model="upsell.audio_enabled"
                                               class="w-4 h-4 bg-gray-700 border-gray-600 rounded focus:ring-purple-500"
                                               style="accent-color: #A855F7;">
                                        <i class="fas fa-microphone mr-1 text-purple-500"></i>
                                        <span>Adicionar √Åudio Complementar</span>
                                    </label>
                                    <div x-show="upsell.audio_enabled" x-cloak class="mt-2">
                                        <input type="url" 
                                               x-model="upsell.audio_url" 
                                               class="form-input"
                                               placeholder="https://t.me/canal/audio3">
                                        <p class="text-xs text-gray-500 mt-2">√Åudio enviado ap√≥s a m√≠dia principal</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="info-box-warning info-box">
                                <p class="text-sm text-gray-300">
                                    <i class="fas fa-rocket mr-2 text-yellow-500"></i>
                                    <strong>Dica:</strong> <strong>V√≠deos</strong> aumentam convers√£o em upsells (cliente j√° confia).
                                </p>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Nome do Produto</label>
                                    <input type="text" x-model="upsell.product_name" class="form-input" placeholder="INSS Premium">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Pre√ßo (R$)</label>
                                    <input type="number" x-model="upsell.price" step="0.01" class="form-input" placeholder="97.00">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-mouse-pointer mr-2 text-green-400"></i>
                                    Texto do Bot√£o (opcional)
                                </label>
                                <input type="text" 
                                       x-model="upsell.button_text" 
                                       class="form-input" 
                                       placeholder="üöÄ Quero fazer Upgrade!">
                                <div class="info-box mt-2">
                                    <p class="text-xs text-gray-400">
                                        <i class="fas fa-lightbulb mr-1" style="color: var(--brand-gold-500);"></i>
                                        Deixe vazio para usar texto padr√£o
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <button @click="addUpsell()" class="w-full py-3 border-2 border-dashed border-gray-700 rounded-lg text-gray-400 hover:border-green-500 hover:text-green-500 transition-all">
                    <i class="fas fa-plus mr-2"></i>
                    Adicionar Upsell
                </button>
            </div>
        </div>
    </div>

    <!-- Tab Content: Access -->
    <div x-show="activeTab === 'access'" x-cloak>
        <div class="config-section">
            <div class="config-section-header">
                <i class="fas fa-key text-2xl" style="color: var(--brand-gold-500);"></i>
                <div>
                    <div class="config-section-title">Acesso ao Produto</div>
                    <div class="config-section-description">Link de entrega e mensagens</div>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Link -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-link mr-2 text-blue-500"></i>
                        Link de Acesso
                    </label>
                    <input type="url" 
                           x-model="config.access_link" 
                           class="form-input"
                           placeholder="https://t.me/+seugrupo">
                    <div class="info-box mt-2">
                        <p class="text-sm text-gray-300">
                            <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                            Pode ser grupo/canal do Telegram, √°rea de membros, etc.
                        </p>
                    </div>
                </div>

                <!-- Mensagem Sucesso -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-check-circle mr-2 text-green-500"></i>
                        Mensagem de Pagamento Aprovado
                    </label>
                    <textarea x-model="config.success_message" 
                              class="form-textarea"
                              placeholder="‚úÖ Pagamento confirmado!&#10;&#10;Acesse seu produto: {link}"></textarea>
                    <div class="info-box-success info-box mt-2">
                        <p class="text-sm text-gray-300">
                            <strong class="text-green-400">Vari√°veis:</strong>
                            <code class="ml-2 px-2 py-1 bg-gray-900 rounded text-yellow-400 text-xs">{produto}</code>
                            <code class="ml-1 px-2 py-1 bg-gray-900 rounded text-yellow-400 text-xs">{valor}</code>
                            <code class="ml-1 px-2 py-1 bg-gray-900 rounded text-yellow-400 text-xs">{link}</code>
                        </p>
                    </div>
                </div>

                <!-- Mensagem Pendente -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-clock mr-2 text-yellow-500"></i>
                        Mensagem de Pagamento Pendente
                    </label>
                    <textarea x-model="config.pending_message" 
                              class="form-textarea"
                              placeholder="‚è≥ Aguardando confirma√ß√£o do pagamento..."></textarea>
                    <div class="info-box-warning info-box mt-2">
                        <p class="text-sm text-gray-300">
                            <strong class="text-yellow-400">Vari√°vel:</strong>
                            <code class="ml-2 px-2 py-1 bg-gray-900 rounded text-yellow-400 text-xs">{pix_code}</code>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab Content: Remarketing -->
    <div x-show="activeTab === 'remarketing'" x-cloak x-data="remarketingApp()">
        <div class="config-section">
            <div class="config-section-header">
                <i class="fas fa-bullhorn text-2xl text-yellow-500"></i>
                <div>
                    <div class="config-section-title">Campanhas de Remarketing</div>
                    <div class="config-section-description">Recupere clientes que n√£o compraram</div>
                </div>
                <div class="ml-auto">
                    <button @click="showCreateModal = true" class="btn-action btn-action-success">
                        <i class="fas fa-plus"></i>
                        Nova Campanha
                    </button>
                </div>
            </div>

            <div class="info-box-warning info-box mb-6">
                <p class="text-sm text-gray-300">
                    <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
                    <strong class="text-yellow-500">Remarketing:</strong> Envie mensagens autom√°ticas para usu√°rios que iniciaram conversa mas n√£o compraram. Configure p√∫blico-alvo, delay e mensagem personalizada.
                </p>
            </div>

            <!-- Analytics Detalhados -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                <div class="stat-box text-center p-5 bg-gray-900 border border-gray-800 rounded-xl hover:border-yellow-500 transition-all">
                    <div class="text-3xl font-bold text-yellow-500" x-text="campaigns.length || 0"></div>
                    <div class="text-sm text-gray-500 mt-1">Campanhas Criadas</div>
                </div>
                
                <div class="stat-box text-center p-5 bg-gray-900 border border-gray-800 rounded-xl hover:border-blue-400 transition-all">
                    <div class="text-3xl font-bold text-blue-400" x-text="getTotalSent()"></div>
                    <div class="text-sm text-gray-500 mt-1">Mensagens Enviadas</div>
                </div>
                
                <div class="stat-box text-center p-5 bg-gray-900 border border-gray-800 rounded-xl hover:border-green-400 transition-all">
                    <div class="text-3xl font-bold text-green-400" x-text="getDeliveryRate() + '%'"></div>
                    <div class="text-sm text-gray-500 mt-1">Taxa de Entrega</div>
                </div>
                
                <div class="stat-box text-center p-5 bg-gray-900 border border-gray-800 rounded-xl hover:border-green-400 transition-all">
                    <div class="text-3xl font-bold text-green-400" x-text="getClickRate() + '%'"></div>
                    <div class="text-sm text-gray-500 mt-1">Taxa de Cliques</div>
                </div>
            </div>

            <!-- M√©tricas Adicionais -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                <div class="text-center p-4 bg-gray-900 border border-gray-800 rounded-lg">
                    <div class="text-xl font-bold text-green-300" x-text="getTotalClicks()"></div>
                    <div class="text-xs text-gray-500 mt-1">Total de Cliques</div>
                </div>
                
                <div class="text-center p-4 bg-gray-900 border border-gray-800 rounded-lg">
                    <div class="text-xl font-bold text-red-400" x-text="getTotalFailed()"></div>
                    <div class="text-xs text-gray-500 mt-1">Falhas no Envio</div>
                </div>
                
                <div class="text-center p-4 bg-gray-900 border border-gray-800 rounded-lg">
                    <div class="text-xl font-bold text-gray-400" x-text="getTotalBlocked()"></div>
                    <div class="text-xs text-gray-500 mt-1">Usu√°rios Bloqueados</div>
                </div>
                
                <div class="text-center p-4 bg-gray-900 border border-gray-800 rounded-lg">
                    <div class="text-xl font-bold text-yellow-500" x-text="'R$ ' + getTotalRevenue().toFixed(2)"></div>
                    <div class="text-xs text-gray-500 mt-1">Receita Gerada</div>
                </div>
            </div>

            <!-- Info Box: Dica de Performance -->
            <div class="info-box mb-6" style="background: rgba(16, 185, 129, 0.05); border-left: 4px solid #10B981; padding: 12px; border-radius: 0 8px 8px 0;">
                <p class="text-sm text-gray-300">
                    <i class="fas fa-chart-line mr-2 text-green-400"></i>
                    <strong class="text-green-400">An√°lise de Performance:</strong>
                    <span x-show="getClickRate() > 10" class="text-green-300">Excelente! Taxa de cliques acima de 10% √© considerada √≥tima.</span>
                    <span x-show="getClickRate() <= 10 && getClickRate() > 5" class="text-blue-300">Bom! Continue testando mensagens diferentes para melhorar.</span>
                    <span x-show="getClickRate() <= 5 && getClickRate() > 0" class="text-yellow-300">Teste mensagens mais persuasivas e ofertas melhores.</span>
                    <span x-show="getClickRate() === 0 && campaigns.length > 0" class="text-gray-300">Envie suas primeiras campanhas para come√ßar a coletar dados.</span>
                    <span x-show="campaigns.length === 0" class="text-gray-300">Crie sua primeira campanha para ver as m√©tricas aqui.</span>
                </p>
            </div>

            <!-- Lista de Campanhas -->
            <div x-show="campaigns.length > 0" class="space-y-4">
                <template x-for="campaign in campaigns" :key="campaign.id">
                    <div class="p-6 bg-gray-900 border border-gray-800 rounded-xl hover:border-yellow-500 transition-all"
                         :class="{'cursor-pointer': campaign.status === 'completed' || campaign.status === 'sending'}"
                         @click="if(campaign.status === 'completed' || campaign.status === 'sending') { viewCampaignStats(campaign) }">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <h3 class="text-lg font-bold text-white flex items-center gap-2">
                                    <span x-text="campaign.name"></span>
                                    <i x-show="campaign.status === 'completed' || campaign.status === 'sending'" 
                                       class="fas fa-chart-bar text-yellow-500 text-sm"></i>
                                </h3>
                                <p class="text-sm text-gray-500 mt-1">
                                    <i class="fas fa-users mr-1"></i>
                                    P√∫blico: <span x-text="getAudienceLabel(campaign.target_audience)"></span>
                                </p>
                            </div>
                            <div class="flex items-center gap-2">
                                <span :class="{
                                    'bg-yellow-500 bg-opacity-20 text-yellow-400': campaign.status === 'draft',
                                    'bg-blue-500 bg-opacity-20 text-blue-400': campaign.status === 'scheduled',
                                    'bg-green-500 bg-opacity-30 text-green-300 font-semibold': campaign.status === 'sending',
                                    'bg-gray-500 bg-opacity-40 text-gray-300 border border-gray-500': campaign.status === 'completed'
                                }" class="px-3 py-1 rounded-full text-xs font-bold">
                                    <span x-text="getStatusLabel(campaign.status)"></span>
                                </span>
                                <button @click.stop="sendCampaign(campaign.id)" 
                                        x-show="campaign.status === 'draft'"
                                        class="px-3 py-1.5 bg-yellow-500 text-black rounded-lg text-sm font-bold hover:bg-yellow-400 transition-all">
                                    <i class="fas fa-paper-plane mr-1"></i> Enviar
                                </button>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center p-3 bg-gray-800 rounded-lg">
                                <div class="text-2xl font-bold text-white" x-text="campaign.total_targets || 0"></div>
                                <div class="text-xs text-gray-500">Alvos</div>
                            </div>
                            <div class="text-center p-3 bg-gray-800 rounded-lg">
                                <div class="text-2xl font-bold text-green-400" x-text="campaign.total_sent || 0"></div>
                                <div class="text-xs text-gray-500">Enviados</div>
                            </div>
                            <div class="text-center p-3 bg-gray-800 rounded-lg">
                                <div class="text-2xl font-bold text-blue-400" x-text="campaign.total_clicks || 0"></div>
                                <div class="text-xs text-gray-500">Cliques</div>
                            </div>
                            <div class="text-center p-3 bg-gray-800 rounded-lg">
                                <div class="text-2xl font-bold" style="color: var(--brand-gold-500);" x-text="'R$ ' + (campaign.revenue_generated || 0).toFixed(2)"></div>
                                <div class="text-xs text-gray-500">Receita</div>
                            </div>
                        </div>
                        
                        <!-- Dica: Clique para ver detalhes -->
                        <div x-show="campaign.status === 'completed' || campaign.status === 'sending'" 
                             class="mt-4 text-center text-xs text-yellow-500 opacity-60 hover:opacity-100 transition-opacity">
                            <i class="fas fa-mouse-pointer mr-1"></i>
                            Clique para ver estat√≠sticas detalhadas
                        </div>
                    </div>
                </template>
            </div>

            <!-- Empty State -->
            <div x-show="campaigns.length === 0" class="text-center py-12 border-2 border-dashed border-gray-700 rounded-xl">
                <i class="fas fa-bullhorn text-5xl text-yellow-500 mb-4" style="opacity: 0.5;"></i>
                <h3 class="text-xl font-bold text-white mb-2">Nenhuma campanha criada</h3>
                <p class="text-gray-500 mb-6">Crie sua primeira campanha de remarketing</p>
                <button @click="showCreateModal = true" class="btn-action btn-action-success">
                    <i class="fas fa-plus"></i>
                    Criar Primeira Campanha
                </button>
            </div>
        </div>

        <!-- Modal: Criar Campanha -->
        <div x-show="showCreateModal" 
             x-cloak
             class="fixed inset-0 z-50 overflow-y-auto"
             style="background: rgba(0,0,0,0.8);">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div @click.away="showCreateModal = false" 
                     class="bg-gray-900 rounded-xl max-w-2xl w-full p-6 border border-gray-800">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-white">Nova Campanha de Remarketing</h3>
                        <button @click="showCreateModal = false" class="text-gray-500 hover:text-white">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>

                    <div class="space-y-4">
                        <div class="form-group">
                            <label class="form-label">Nome da Campanha</label>
                            <input type="text" x-model="newCampaign.name" class="form-input" placeholder="Ex: Recupera√ß√£o de Carrinho">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Mensagem</label>
                            <textarea x-model="newCampaign.message" class="form-textarea" rows="4" placeholder="Ol√°! Notamos que voc√™ estava interessado..."></textarea>
                        </div>

                        <!-- M√≠dia (Padr√£o 2 colunas) -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-link mr-2 text-blue-500"></i>
                                    URL da M√≠dia (opcional)
                                </label>
                                <input type="url" x-model="newCampaign.media_url" class="form-input" placeholder="https://t.me/canal/123">
                                <p class="text-xs text-gray-500 mt-2">Link do Telegram</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-image mr-2 text-blue-500"></i>
                                    Tipo de M√≠dia Principal
                                </label>
                                <div class="flex gap-3 mt-2">
                                    <label class="flex items-center gap-2 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg cursor-pointer hover:border-blue-500 transition-colors flex-1"
                                           :class="{'border-blue-500 bg-blue-500 bg-opacity-10': newCampaign.media_type === 'video'}">
                                        <input type="radio" x-model="newCampaign.media_type" value="video" class="text-blue-500">
                                        <i class="fas fa-video text-blue-500"></i>
                                        <span class="text-sm text-white">V√≠deo</span>
                                    </label>
                                    <label class="flex items-center gap-2 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg cursor-pointer hover:border-blue-500 transition-colors flex-1"
                                           :class="{'border-blue-500 bg-blue-500 bg-opacity-10': newCampaign.media_type === 'photo'}">
                                        <input type="radio" x-model="newCampaign.media_type" value="photo" class="text-blue-500">
                                        <i class="fas fa-camera text-blue-500"></i>
                                        <span class="text-sm text-white">Foto</span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label flex items-center gap-2">
                                    <input type="checkbox" 
                                           x-model="newCampaign.audio_enabled"
                                           class="w-4 h-4 bg-gray-700 border-gray-600 rounded focus:ring-purple-500"
                                           style="accent-color: #A855F7;">
                                    <i class="fas fa-microphone mr-1 text-purple-500"></i>
                                    <span>Adicionar √Åudio Complementar</span>
                                </label>
                                <div x-show="newCampaign.audio_enabled" x-cloak class="mt-2">
                                    <input type="url" 
                                           x-model="newCampaign.audio_url" 
                                           class="form-input"
                                           placeholder="https://t.me/canal/audioremkt">
                                    <p class="text-xs text-gray-500 mt-2">√Åudio enviado ap√≥s a m√≠dia principal</p>
                                </div>
                            </div>
                        </div>

                        <!-- ‚úÖ BOT√ïES DE PRODUTO (igual ao Remarketing Geral) -->
                        <div class="form-group p-4 rounded-xl" style="background: rgba(16, 185, 129, 0.08); border: 1px solid rgba(16, 185, 129, 0.3);">
                            <div class="flex items-center justify-between mb-3">
                                <label class="form-label mb-0">
                                    <i class="fas fa-tag mr-2 text-emerald-400"></i>
                                    Bot√µes de Produto
                                </label>
                                <button type="button" 
                                        @click="newCampaign.buttons = newCampaign.buttons || []; newCampaign.buttons.push({ text: '', price: 0, description: '' })"
                                        class="px-3 py-1 text-xs font-bold rounded-lg text-black"
                                        style="background: linear-gradient(to right, #10B981, #059669);">
                                    <i class="fas fa-plus mr-1"></i>
                                    Adicionar Bot√£o
                                </button>
                            </div>
                            
                            <!-- Lista de bot√µes -->
                            <template x-if="!newCampaign.buttons || newCampaign.buttons.length === 0">
                                <div class="text-center py-6 text-gray-500 text-sm">
                                    <i class="fas fa-hand-pointer text-2xl mb-2"></i>
                                    <p>Nenhum bot√£o adicionado</p>
                                    <p class="text-xs mt-1">Clique em "Adicionar Bot√£o" para criar op√ß√µes de produtos</p>
                                </div>
                            </template>
                            
                            <div class="space-y-3" x-show="newCampaign.buttons && newCampaign.buttons.length > 0">
                                <template x-for="(button, index) in newCampaign.buttons" :key="index">
                                    <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
                                        <div class="flex items-center justify-between mb-3">
                                            <span class="text-xs font-bold text-emerald-400">
                                                <i class="fas fa-tag mr-1"></i>
                                                Bot√£o <span x-text="index + 1"></span>
                                            </span>
                                            <button type="button" 
                                                    @click="newCampaign.buttons.splice(index, 1)"
                                                    class="text-xs text-red-400 hover:text-red-300">
                                                <i class="fas fa-trash mr-1"></i>
                                                Remover
                                            </button>
                                        </div>
                                        
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                            <div class="md:col-span-2">
                                                <label class="block text-xs text-gray-400 mb-1">Texto do Bot√£o</label>
                                                <input type="text" 
                                                       x-model="button.text"
                                                       class="form-input text-sm"
                                                       placeholder="Ex: Comprar Produto Premium">
                                            </div>
                                            <div>
                                                <label class="block text-xs text-gray-400 mb-1">Pre√ßo (R$)</label>
                                                <input type="number" 
                                                       x-model.number="button.price"
                                                       step="0.01"
                                                       min="0"
                                                       class="form-input text-sm font-mono font-bold"
                                                       placeholder="19.97">
                                            </div>
                                        </div>
                                        
                                        <div class="mt-3">
                                            <label class="block text-xs text-gray-400 mb-1">Descri√ß√£o do Produto</label>
                                            <input type="text" 
                                                   x-model="button.description"
                                                   class="form-input text-sm"
                                                   placeholder="Acesso completo + B√¥nus exclusivos">
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-users mr-2 text-yellow-500"></i>
                                    P√∫blico-Alvo
                                </label>
                                <select x-model="newCampaign.target_audience" class="form-input">
                                    <option value="non_buyers">N√£o compraram</option>
                                    <option value="abandoned_cart">Carrinho abandonado</option>
                                    <option value="inactive">Inativos</option>
                                    <option value="all">Todos</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-clock mr-2 text-yellow-500"></i>
                                    Dias sem contato
                                </label>
                                <input type="number" x-model="newCampaign.days_since_last_contact" class="form-input" placeholder="3">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" 
                                       x-model="newCampaign.exclude_buyers"
                                       class="w-5 h-5 rounded border-gray-600 bg-gray-800 text-yellow-500">
                                <span class="text-sm text-white font-semibold">
                                    <i class="fas fa-user-slash mr-1 text-red-400"></i>
                                    Excluir compradores
                                </span>
                            </label>
                            <p class="text-xs text-gray-500 mt-1">N√£o enviar para quem j√° comprou</p>
                        </div>

                        <div class="flex justify-end gap-3 mt-6">
                            <button @click="showCreateModal = false" 
                                    class="px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600">
                                Cancelar
                            </button>
                            <button @click="createCampaign()" 
                                    :disabled="!newCampaign.name || !newCampaign.message"
                                    :class="{'opacity-50 cursor-not-allowed': !newCampaign.name || !newCampaign.message}"
                                    class="btn-action btn-action-success">
                                <i class="fas fa-plus"></i>
                                Criar Campanha
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal: Estat√≠sticas da Campanha -->
        <div x-show="showStatsModal" 
             x-cloak
             class="fixed inset-0 z-50 overflow-y-auto"
             style="background: rgba(0,0,0,0.9);">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div @click.away="showStatsModal = false" 
                     class="bg-gray-900 rounded-2xl max-w-4xl w-full p-8 border-2 border-yellow-500">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-white flex items-center gap-3">
                                <i class="fas fa-chart-line text-yellow-500"></i>
                                Estat√≠sticas da Campanha
                            </h3>
                            <p class="text-sm text-gray-500 mt-1" x-text="selectedCampaign?.name"></p>
                        </div>
                        <button @click="showStatsModal = false" class="text-gray-500 hover:text-white">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>

                    <!-- M√©tricas Principais -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="text-center p-5 bg-gray-800 border border-gray-700 rounded-xl">
                            <div class="text-3xl font-bold text-blue-400" x-text="selectedCampaign?.total_targets || 0"></div>
                            <div class="text-sm text-gray-500 mt-1">Total de Alvos</div>
                        </div>
                        
                        <div class="text-center p-5 bg-gray-800 border border-gray-700 rounded-xl">
                            <div class="text-3xl font-bold text-green-400" x-text="selectedCampaign?.total_sent || 0"></div>
                            <div class="text-sm text-gray-500 mt-1">Mensagens Enviadas</div>
                        </div>
                        
                        <div class="text-center p-5 bg-gray-800 border border-gray-700 rounded-xl">
                            <div class="text-3xl font-bold text-purple-400" x-text="selectedCampaign?.total_clicks || 0"></div>
                            <div class="text-sm text-gray-500 mt-1">Total de Cliques</div>
                        </div>
                        
                        <div class="text-center p-5 bg-gray-800 border border-gray-700 rounded-xl">
                            <div class="text-3xl font-bold text-yellow-500" x-text="'R$ ' + (selectedCampaign?.revenue_generated || 0).toFixed(2)"></div>
                            <div class="text-sm text-gray-500 mt-1">Receita Gerada</div>
                        </div>
                    </div>

                    <!-- Taxas e Performance -->
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="text-center p-4 bg-gray-800 border border-gray-700 rounded-lg">
                            <div class="text-2xl font-bold text-green-300" x-text="getCampaignDeliveryRate(selectedCampaign) + '%'"></div>
                            <div class="text-xs text-gray-500 mt-1">Taxa de Entrega</div>
                        </div>
                        
                        <div class="text-center p-4 bg-gray-800 border border-gray-700 rounded-lg">
                            <div class="text-2xl font-bold text-blue-300" x-text="getCampaignClickRate(selectedCampaign) + '%'"></div>
                            <div class="text-xs text-gray-500 mt-1">Taxa de Cliques</div>
                        </div>
                        
                        <div class="text-center p-4 bg-gray-800 border border-gray-700 rounded-lg">
                            <div class="text-2xl font-bold text-purple-300" x-text="getCampaignConversionRate(selectedCampaign) + '%'"></div>
                            <div class="text-xs text-gray-500 mt-1">Taxa de Convers√£o</div>
                        </div>
                    </div>

                    <!-- Detalhes Adicionais -->
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="p-4 bg-gray-800 border border-gray-700 rounded-lg">
                            <div class="text-xs text-gray-500 mb-1">Falhas no Envio</div>
                            <div class="text-xl font-bold text-red-400" x-text="selectedCampaign?.total_failed || 0"></div>
                        </div>
                        
                        <div class="p-4 bg-gray-800 border border-gray-700 rounded-lg">
                            <div class="text-xs text-gray-500 mb-1">Usu√°rios Bloqueados</div>
                            <div class="text-xl font-bold text-gray-400" x-text="selectedCampaign?.total_blocked || 0"></div>
                        </div>
                        
                        <div class="p-4 bg-gray-800 border border-gray-700 rounded-lg">
                            <div class="text-xs text-gray-500 mb-1">Status</div>
                            <div class="text-xl font-bold" :class="{
                                'text-yellow-400': selectedCampaign?.status === 'draft',
                                'text-green-400': selectedCampaign?.status === 'sending',
                                'text-gray-400': selectedCampaign?.status === 'completed'
                            }" x-text="getStatusLabel(selectedCampaign?.status)"></div>
                        </div>
                    </div>

                    <!-- Info da Campanha -->
                    <div class="p-4 bg-gray-800 border border-gray-700 rounded-lg mb-6">
                        <h4 class="text-sm font-bold text-white mb-3">Detalhes da Campanha</h4>
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div>
                                <span class="text-gray-500">P√∫blico-Alvo:</span>
                                <span class="text-white ml-2" x-text="getAudienceLabel(selectedCampaign?.target_audience)"></span>
                            </div>
                            <div>
                                <span class="text-gray-500">Delay:</span>
                                <span class="text-white ml-2" x-text="selectedCampaign?.days_since_last_contact + ' dias'"></span>
                            </div>
                        </div>
                        <div class="mt-3">
                            <span class="text-gray-500">Mensagem:</span>
                            <p class="text-white mt-1 text-sm bg-gray-900 p-3 rounded" x-text="selectedCampaign?.message"></p>
                        </div>
                    </div>

                    <!-- An√°lise de Performance -->
                    <div class="p-4 rounded-lg" :class="{
                        'bg-green-500 bg-opacity-10 border border-green-500': getCampaignClickRate(selectedCampaign) > 10,
                        'bg-blue-500 bg-opacity-10 border border-blue-500': getCampaignClickRate(selectedCampaign) <= 10 && getCampaignClickRate(selectedCampaign) > 5,
                        'bg-yellow-500 bg-opacity-10 border border-yellow-500': getCampaignClickRate(selectedCampaign) <= 5
                    }">
                        <p class="text-sm">
                            <i class="fas fa-lightbulb mr-2"></i>
                            <strong>An√°lise:</strong>
                            <span x-show="getCampaignClickRate(selectedCampaign) > 10">üéâ Excelente performance! Continue com esse tipo de mensagem.</span>
                            <span x-show="getCampaignClickRate(selectedCampaign) <= 10 && getCampaignClickRate(selectedCampaign) > 5">üëç Boa performance! Teste varia√ß√µes para melhorar ainda mais.</span>
                            <span x-show="getCampaignClickRate(selectedCampaign) <= 5">üí° Performance pode melhorar. Teste mensagens mais diretas e ofertas melhores.</span>
                        </p>
                    </div>

                    <div class="flex justify-end mt-6">
                        <button @click="showStatsModal = false" 
                                class="px-6 py-2 bg-yellow-500 text-black rounded-lg hover:bg-yellow-400 font-bold">
                            Fechar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab Content: Settings (Trocar Token) -->
    <div x-show="activeTab === 'settings'" x-cloak>
        <div class="config-section">
            <div class="config-section-header">
                <i class="fas fa-cog text-2xl text-gray-400"></i>
                <div>
                    <div class="config-section-title">Configura√ß√µes do Bot</div>
                    <div class="config-section-description">Token do Telegram e configura√ß√µes avan√ßadas</div>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Trocar Token -->
                <div class="p-6 bg-gray-900 border-2 border-red-500 rounded-xl">
                    <div class="flex items-start gap-3 mb-6 p-4 bg-red-500 bg-opacity-15 rounded-lg border-l-4 border-red-500">
                        <i class="fas fa-exclamation-triangle text-red-400 text-2xl"></i>
                        <div>
                            <h3 class="text-xl font-bold text-red-400 mb-2">Trocar Token do Bot</h3>
                            <p class="text-sm text-white font-medium mb-3">
                                Use esta op√ß√£o se voc√™ precisa reconectar o bot ou trocar para um novo token do BotFather.
                            </p>
                            <div class="p-3 bg-red-600 bg-opacity-30 rounded-lg border border-red-400">
                                <p class="text-sm text-white font-bold">
                                    <i class="fas fa-skull-crossbones mr-2 text-red-300"></i>
                                    <strong class="text-red-300">ATEN√á√ÉO CR√çTICA:</strong> Ao trocar o token, voc√™ estar√° criando um novo bot no Telegram. 
                                    <strong class="text-yellow-300">TODOS os usu√°rios que j√° interagiram com o bot anterior ser√£o RESETADOS</strong> e precisar√£o iniciar uma nova conversa com o novo bot!
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-key mr-2" style="color: var(--brand-gold-500);"></i>
                            <span class="text-white font-bold">Novo Token do Telegram</span>
                        </label>
                        <input type="text" 
                               x-model="newBotToken" 
                               class="form-input font-mono text-white"
                               placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz">
                        <p class="text-sm text-gray-300 mt-2 font-medium">
                            <i class="fas fa-info-circle mr-1 text-blue-400"></i>
                            Obtenha um novo token com o <strong class="text-blue-400">@BotFather</strong> no Telegram
                        </p>
                    </div>

                    <button @click="changeBotToken()" 
                            :disabled="!newBotToken || loading"
                            :class="{'opacity-50 cursor-not-allowed': !newBotToken || loading}"
                            class="w-full px-4 py-3 bg-red-500 text-white rounded-lg font-bold hover:bg-red-600 transition-all flex items-center justify-center gap-2 text-base">
                        <i class="fas fa-sync-alt"></i>
                        <span x-show="!loading">Atualizar Token</span>
                        <span x-show="loading">Atualizando...</span>
                    </button>

                    <div class="mt-4 p-4 bg-green-500 bg-opacity-15 rounded-lg border-l-4 border-green-500">
                        <p class="text-sm text-white font-medium">
                            <i class="fas fa-shield-alt mr-2 text-green-400"></i>
                            <strong class="text-green-400">Seguran√ßa:</strong> O token √© criptografado e nunca ser√° exibido ap√≥s salvo.
                        </p>
                    </div>
                </div>

                <!-- Informa√ß√µes do Bot -->
                <div class="p-6 bg-gray-900 border border-gray-800 rounded-xl">
                    <h3 class="text-sm font-bold text-white mb-4 flex items-center gap-2">
                        <i class="fas fa-info-circle text-blue-500"></i>
                        Informa√ß√µes do Bot
                    </h3>
                    
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-500">Nome:</span>
                            <span class="text-white font-semibold">{{ bot.name }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Username:</span>
                            <span class="text-white font-mono">@{{ bot.username }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Status:</span>
                            <span class="text-green-400 font-semibold">
                                <i class="fas fa-circle text-xs mr-1"></i>
                                {% if bot.is_active %}Ativo{% else %}Pausado{% endif %}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">ID:</span>
                            <span class="text-white font-mono">#{{ bot.id }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}

{% block extra_scripts %}
<script>
function botConfigApp() {
    return {
        activeTab: 'welcome',
        loading: false,
        newBotToken: '',  // ‚úÖ NOVO: Para trocar token
        
        config: {
            welcome_message: '',
            welcome_media_url: '',
            welcome_media_type: 'video',
            welcome_audio_enabled: false,
            welcome_audio_url: '',
            main_buttons: [],
            redirect_buttons: [],
            downsells_enabled: false,
            downsells: [],
            upsells_enabled: false,
            upsells: [],
            access_link: '',
            success_message: '',
            pending_message: ''
        },
        
        async init() {
            console.log('üîß Bot Config V2.0 inicializando...');
            await this.loadConfig();
            console.log('‚úÖ Config carregado!');
        },
        
        async loadConfig() {
            try {
                console.log('üì° Buscando config da API...');
                const response = await fetch('/api/bots/{{ bot.id }}/config');
                
                console.log('üìä Response status:', response.status);
                
                if (!response.ok) {
                    console.error('‚ùå Erro na resposta:', response.status, response.statusText);
                    const errorText = await response.text();
                    console.error('‚ùå Erro detalhado:', errorText);
                    return;
                }
                
                const data = await response.json();
                console.log('üì¶ Dados recebidos da API:', data);
                
                if (response.ok) {
                    console.log('‚úÖ Mesclando dados com config atual...');
                    console.log('üîß Config ANTES:', JSON.stringify(this.config, null, 2));
                    
                    this.config = {
                        ...this.config,
                        ...data
                    };
                    
                    // ‚úÖ Garantir que campos de √°udio existem (compatibilidade com configs antigos)
                    if (!this.config.hasOwnProperty('welcome_audio_enabled')) this.config.welcome_audio_enabled = false;
                    if (!this.config.hasOwnProperty('welcome_audio_url')) this.config.welcome_audio_url = '';
                    
                    console.log('üîß Config DEPOIS:', JSON.stringify(this.config, null, 2));
                    
                    // ‚úÖ Migrar order_bump para order_bumps array
                    if (Array.isArray(this.config.main_buttons)) {
                        this.config.main_buttons.forEach(button => {
                            // Migrar order_bump antigo para order_bumps array
                            if (button.hasOwnProperty('order_bump') && !button.hasOwnProperty('order_bumps')) {
                                if (button.order_bump && button.order_bump.enabled) {
                                    button.order_bumps = [button.order_bump];
                                } else {
                                    button.order_bumps = [];
                                }
                                delete button.order_bump; // Remover estrutura antiga
                            }
                            
                            // Garantir que order_bumps existe
                            if (!button.hasOwnProperty('order_bumps')) {
                                button.order_bumps = [];
                            }
                            
                            // Inicializar cada order bump
                            if (Array.isArray(button.order_bumps)) {
                                button.order_bumps.forEach(orderBump => {
                                    if (!orderBump.hasOwnProperty('enabled')) orderBump.enabled = true;
                                    if (!orderBump.hasOwnProperty('message')) orderBump.message = '';
                                    if (!orderBump.hasOwnProperty('price')) orderBump.price = 0;
                                    if (!orderBump.hasOwnProperty('description')) orderBump.description = '';
                                    if (!orderBump.hasOwnProperty('media_url')) orderBump.media_url = '';
                                    if (!orderBump.hasOwnProperty('media_type')) orderBump.media_type = 'photo';
                                    if (!orderBump.hasOwnProperty('accept_text')) orderBump.accept_text = '';
                                    if (!orderBump.hasOwnProperty('decline_text')) orderBump.decline_text = '';
                                });
                            }
                        });
                    }
                    
                    // ‚úÖ Inicializar campos de downsells (compatibilidade com sistema antigo)
                    if (Array.isArray(this.config.downsells)) {
                        this.config.downsells.forEach(downsell => {
                            if (!downsell.hasOwnProperty('pricing_mode')) downsell.pricing_mode = 'fixed';
                            if (!downsell.hasOwnProperty('discount_percentage')) downsell.discount_percentage = 50;
                            if (!downsell.hasOwnProperty('button_text')) downsell.button_text = '';
                            if (!downsell.hasOwnProperty('media_type')) downsell.media_type = 'video';
                            if (!downsell.hasOwnProperty('audio_enabled')) downsell.audio_enabled = false;
                            if (!downsell.hasOwnProperty('audio_url')) downsell.audio_url = '';
                            if (!downsell.hasOwnProperty('order_bump')) {
                                downsell.order_bump = {
                                    enabled: false,
                                    button_index: null,  // ‚úÖ V2.0: √çndice do bot√£o principal
                                    bump_index: null,    // ‚úÖ V2.0: √çndice do order bump no bot√£o
                                    message: '',
                                    price: 0,
                                    description: '',
                                    media_url: '',
                                    media_type: 'video',
                                    accept_text: '',
                                    decline_text: '',
                                    audio_enabled: false,
                                    audio_url: ''
                                };
                            } else {
                                // Garantir que button_index e bump_index existem (compatibilidade)
                                if (!downsell.order_bump.hasOwnProperty('button_index')) {
                                    downsell.order_bump.button_index = null;
                                }
                                if (!downsell.order_bump.hasOwnProperty('bump_index')) {
                                    downsell.order_bump.bump_index = null;
                                }
                            }
                        });
                    }
                    
                    // Garantir arrays existem
                    if (!this.config.downsells) this.config.downsells = [];
                    if (!this.config.upsells) this.config.upsells = [];
                    
                    // ‚úÖ Inicializar campos de upsells (compatibilidade)
                    if (Array.isArray(this.config.upsells)) {
                        this.config.upsells.forEach(upsell => {
                            if (!upsell.hasOwnProperty('media_type')) upsell.media_type = 'video';
                            if (!upsell.hasOwnProperty('audio_enabled')) upsell.audio_enabled = false;
                            if (!upsell.hasOwnProperty('audio_url')) upsell.audio_url = '';
                        });
                    }
                    
                    console.log('‚úÖ Config final carregado com sucesso!');
                    console.log('üìä Config completo:', this.config);
                } else {
                    console.error('‚ùå Erro na resposta da API:', data);
                    alert('‚ùå Erro ao carregar configura√ß√£o. Verifique o console do navegador (F12).');
                }
            } catch (error) {
                console.error('‚ùå ERRO CR√çTICO ao carregar config:', error);
                console.error('Stack:', error.stack);
                alert('‚ùå Erro ao carregar configura√ß√£o: ' + error.message + '\nAbra o console (F12) para mais detalhes.');
            }
        },
        
        async saveConfig() {
            console.log('üîÑ Iniciando salvamento de configura√ß√£o...');
            this.loading = true;
            
            try {
                console.log('üìä Dados a serem enviados:', this.config);
                
                const response = await fetch('/api/bots/{{ bot.id }}/config', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(this.config)
                });
                
                console.log('üì° Resposta recebida:', response.status, response.statusText);
                
                const data = await response.json();
                console.log('üìä Dados da resposta:', data);
                
                if (response.ok) {
                    console.log('‚úÖ Configura√ß√µes salvas com sucesso!');
                    this.showNotification('‚úÖ Configura√ß√µes salvas!', 'success');
                } else {
                    console.error('‚ùå Erro na resposta:', data);
                    alert('Erro: ' + data.error);
                }
            } catch (error) {
                console.error('üí• Erro na requisi√ß√£o:', error);
                alert('Erro: ' + error.message);
            } finally {
                console.log('üèÅ Finalizando salvamento...');
                this.loading = false;
            }
        },
        
        addButton() {
            this.config.main_buttons.push({
                text: '',
                price: 0,
                description: '',
                order_bumps: []  // ‚úÖ ARRAY DE ORDER BUMPS
            });
        },
        
        addOrderBump(buttonIndex) {
            if (!this.config.main_buttons[buttonIndex].order_bumps) {
                this.config.main_buttons[buttonIndex].order_bumps = [];
            }
            
            this.config.main_buttons[buttonIndex].order_bumps.push({
                enabled: true,
                message: '',
                price: 0,
                description: '',
                media_url: '',
                media_type: 'photo',
                accept_text: '',
                decline_text: ''
            });
        },
        
        removeOrderBump(buttonIndex, bumpIndex) {
            if (confirm('Remover este order bump?')) {
                this.config.main_buttons[buttonIndex].order_bumps.splice(bumpIndex, 1);
            }
        },
        
        removeButton(index) {
            if (confirm('Remover este produto?')) {
                this.config.main_buttons.splice(index, 1);
            }
        },
        
        addRedirectButton() {
            this.config.redirect_buttons.push({
                text: '',
                url: ''
            });
        },
        
        removeRedirectButton(index) {
            this.config.redirect_buttons.splice(index, 1);
        },
        
        addDownsell() {
            this.config.downsells.push({
                delay_minutes: 5,
                message: '',
                media_url: '',
                media_type: 'video',
                audio_enabled: false,
                audio_url: '',
                pricing_mode: 'fixed',
                price: 0,
                discount_percentage: 50,
                button_text: '',
                order_bump: {
                    enabled: false,
                    button_index: null,  // ‚úÖ V2.0: √çndice do bot√£o principal
                    bump_index: null,    // ‚úÖ V2.0: √çndice do order bump no bot√£o
                    message: '',
                    price: 0,
                    description: '',
                    media_url: '',
                    media_type: 'video',
                    accept_text: '',
                    decline_text: '',
                    audio_enabled: false,
                    audio_url: ''
                }
            });
        },
        
        // ‚úÖ V2.0: Extrair Order Bumps dos Bot√µes Principais
        getAvailableOrderBumps() {
            const available = [];
            if (!Array.isArray(this.config.main_buttons)) {
                return available;
            }
            
            this.config.main_buttons.forEach((button, buttonIndex) => {
                if (Array.isArray(button.order_bumps)) {
                    button.order_bumps.forEach((orderBump, bumpIndex) => {
                        if (orderBump.enabled !== false) {  // Considerar apenas os ativos
                            available.push({
                                buttonIndex: buttonIndex,
                                bumpIndex: bumpIndex,
                                orderBump: orderBump,
                                buttonText: button.text || `Bot√£o ${buttonIndex + 1}`
                            });
                        }
                    });
                }
            });
            
            return available;
        },
        
        // ‚úÖ V2.0: Usar Order Bump dos Bot√µes Principais no Downsell
        useOrderBumpFromButtons(downsell, buttonIndex, bumpIndex) {
            if (!this.config.main_buttons || !this.config.main_buttons[buttonIndex]) {
                alert('Bot√£o n√£o encontrado');
                return;
            }
            
            const button = this.config.main_buttons[buttonIndex];
            if (!button.order_bumps || !button.order_bumps[bumpIndex]) {
                alert('Order bump n√£o encontrado');
                return;
            }
            
            const orderBump = button.order_bumps[bumpIndex];
            
            // Debug: Log dos dados originais
            console.log('üì¶ Order Bump original:', orderBump);
            console.log('üí∞ Pre√ßo original:', orderBump.price, 'Tipo:', typeof orderBump.price);
            
            // Garantir que order_bump existe no downsell
            if (!downsell.order_bump) {
                downsell.order_bump = {
                    enabled: false,
                    button_index: null,
                    bump_index: null,
                    message: '',
                    price: 0,
                    description: '',
                    media_url: '',
                    media_type: 'video',
                    accept_text: '',
                    decline_text: '',
                    audio_enabled: false,
                    audio_url: ''
                };
            }
            
            // Copiar dados do order bump dos bot√µes para o downsell
            downsell.order_bump.button_index = buttonIndex;
            downsell.order_bump.bump_index = bumpIndex;
            downsell.order_bump.message = orderBump.message || '';
            
            // ‚úÖ Tratamento robusto do pre√ßo
            let priceValue = 0;
            if (orderBump.price !== null && orderBump.price !== undefined && orderBump.price !== '') {
                priceValue = parseFloat(orderBump.price);
                if (isNaN(priceValue)) {
                    priceValue = 0;
                }
            }
            downsell.order_bump.price = priceValue;
            
            downsell.order_bump.description = orderBump.description || '';
            downsell.order_bump.media_url = orderBump.media_url || '';
            downsell.order_bump.media_type = orderBump.media_type || 'photo';
            downsell.order_bump.accept_text = orderBump.accept_text || '';
            downsell.order_bump.decline_text = orderBump.decline_text || '';
            downsell.order_bump.audio_enabled = orderBump.audio_enabled || false;
            downsell.order_bump.audio_url = orderBump.audio_url || '';
            
            // Ativar automaticamente
            downsell.order_bump.enabled = true;
            
            console.log(`‚úÖ Order bump do Bot√£o ${buttonIndex + 1} - OB ${bumpIndex + 1} aplicado ao downsell`);
            console.log('üìä Dados copiados:', downsell.order_bump);
        },
        
        removeDownsell(index) {
            this.config.downsells.splice(index, 1);
        },
        
        addUpsell() {
            this.config.upsells.push({
                trigger_product: '',
                delay_minutes: 0,
                message: '',
                media_url: '',
                media_type: 'video',
                audio_enabled: false,
                audio_url: '',
                product_name: '',
                price: 0,
                button_text: ''
            });
        },
        
        removeUpsell(index) {
            this.config.upsells.splice(index, 1);
        },
        
        // ‚úÖ NOVO: Trocar Token do Bot
        async changeBotToken() {
            if (!this.newBotToken.trim()) {
                this.showNotification('Digite um token v√°lido', 'error');
                return;
            }
            
            if (!confirm('‚ö†Ô∏è ATEN√á√ÉO CR√çTICA!\n\nAo trocar o token, voc√™ criar√° um NOVO BOT no Telegram.\n\nTODOS os usu√°rios que j√° interagiram com o bot anterior ser√£o RESETADOS e precisar√£o iniciar uma nova conversa!\n\nTem CERTEZA que deseja continuar?')) {
                return;
            }
            
            this.loading = true;
            
            try {
                const response = await fetch('/api/bots/{{ bot.id }}/token', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token: this.newBotToken.trim() })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    this.showNotification('‚úÖ Token atualizado! Bot reconectando...', 'success');
                    this.newBotToken = '';
                    setTimeout(() => window.location.reload(), 2000);
                } else {
                    this.showNotification('Erro: ' + (data.error || 'Token inv√°lido'), 'error');
                }
            } catch (error) {
                this.showNotification('Erro ao atualizar token: ' + error.message, 'error');
            } finally {
                this.loading = false;
            }
        },
        
        showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-2xl z-50 text-white font-bold ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }
    };
}

// ‚úÖ Remarketing App (componente separado)
function remarketingApp() {
    return {
        campaigns: [],
        showCreateModal: false,
        showStatsModal: false,
        selectedCampaign: null,
        newCampaign: {
            name: '',
            message: '',
            media_url: '',
            media_type: 'video',
            audio_enabled: false,
            audio_url: '',
            target_audience: 'non_buyers',
            days_since_last_contact: 3,
            exclude_buyers: true,
            cooldown_hours: 6,  // ‚úÖ Fixo: 6 horas (n√£o aparece para usu√°rio)
            buttons: []  // ‚úÖ NOVO: Bot√µes de produto (igual ao Remarketing Geral)
        },
        
        async init() {
            await this.loadCampaigns();
        },
        
        async loadCampaigns() {
            try {
                const response = await fetch('/api/bots/{{ bot.id }}/remarketing/campaigns');
                const data = await response.json();
                if (response.ok) {
                    this.campaigns = data;
                }
            } catch (error) {
                console.error('Erro ao carregar campanhas:', error);
            }
        },
        
        async createCampaign() {
            if (!this.newCampaign.name || !this.newCampaign.message) {
                alert('Preencha nome e mensagem');
                return;
            }
            
            try {
                const response = await fetch('/api/bots/{{ bot.id }}/remarketing/campaigns', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(this.newCampaign)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    this.campaigns.unshift(data);
                    this.showCreateModal = false;
                    this.resetForm();
                    this.showNotification('‚úÖ Campanha criada!', 'success');
                } else {
                    alert('Erro: ' + data.error);
                }
            } catch (error) {
                alert('Erro ao criar campanha: ' + error.message);
            }
        },
        
        async sendCampaign(campaignId) {
            if (!confirm('Enviar esta campanha agora?')) return;
            
            try {
                const response = await fetch(`/api/bots/{{ bot.id }}/remarketing/campaigns/${campaignId}/send`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    await this.loadCampaigns();
                    this.showNotification('‚úÖ Campanha enviada!', 'success');
                } else {
                    alert('Erro: ' + data.error);
                }
            } catch (error) {
                alert('Erro ao enviar campanha: ' + error.message);
            }
        },
        
        resetForm() {
            this.newCampaign = {
                name: '',
                message: '',
                media_url: '',
                media_type: 'video',
                audio_enabled: false,
                audio_url: '',
                target_audience: 'non_buyers',
                days_since_last_contact: 3,
                exclude_buyers: true,
                cooldown_hours: 6,  // ‚úÖ Fixo: 6 horas
                buttons: []  // ‚úÖ NOVO: Bot√µes de produto
            };
        },
        
        getAudienceLabel(audience) {
            const labels = {
                'non_buyers': 'N√£o compraram',
                'abandoned_cart': 'Carrinho abandonado',
                'inactive': 'Inativos',
                'all': 'Todos'
            };
            return labels[audience] || audience;
        },
        
        getStatusLabel(status) {
            const labels = {
                'draft': 'Rascunho',
                'scheduled': 'Agendada',
                'sending': 'Enviando',
                'completed': 'Conclu√≠da',
                'paused': 'Pausada',
                'failed': 'Falhou'
            };
            return labels[status] || status;
        },
        
        // ‚úÖ C√°lculos de Analytics
        getTotalSent() {
            return this.campaigns.reduce((sum, c) => sum + (c.total_sent || 0), 0);
        },
        
        getDeliveryRate() {
            const totalSent = this.getTotalSent();
            const totalFailed = this.campaigns.reduce((sum, c) => sum + (c.total_failed || 0), 0);
            if (totalSent === 0) return 0;
            return ((totalSent - totalFailed) / totalSent * 100).toFixed(1);
        },
        
        getClickRate() {
            const totalSent = this.getTotalSent();
            const totalClicks = this.getTotalClicks();
            if (totalSent === 0) return 0;
            return (totalClicks / totalSent * 100).toFixed(1);
        },
        
        getTotalClicks() {
            return this.campaigns.reduce((sum, c) => sum + (c.total_clicks || 0), 0);
        },
        
        getTotalFailed() {
            return this.campaigns.reduce((sum, c) => sum + (c.total_failed || 0), 0);
        },
        
        getTotalBlocked() {
            return this.campaigns.reduce((sum, c) => sum + (c.total_blocked || 0), 0);
        },
        
        getTotalRevenue() {
            return this.campaigns.reduce((sum, c) => sum + (c.revenue_generated || 0), 0);
        },
        
        // ‚úÖ Fun√ß√µes para Modal de Estat√≠sticas
        viewCampaignStats(campaign) {
            this.selectedCampaign = campaign;
            this.showStatsModal = true;
        },
        
        getCampaignDeliveryRate(campaign) {
            if (!campaign || !campaign.total_sent) return 0;
            const delivered = campaign.total_sent - (campaign.total_failed || 0);
            return (delivered / campaign.total_sent * 100).toFixed(1);
        },
        
        getCampaignClickRate(campaign) {
            if (!campaign || !campaign.total_sent) return 0;
            return ((campaign.total_clicks || 0) / campaign.total_sent * 100).toFixed(1);
        },
        
        getCampaignConversionRate(campaign) {
            if (!campaign || !campaign.total_sent) return 0;
            // Assumindo que convers√£o = cliques que geraram receita
            const conversions = campaign.total_clicks || 0;
            return (conversions / campaign.total_sent * 100).toFixed(1);
        },
        
        showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-2xl z-50 text-white font-bold ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }
    };
}
</script>
{% endblock %}

