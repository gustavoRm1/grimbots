{% extends "base.html" %} {% block title %}Configurar Bot - {{ bot.name }}{% endblock %} {% block content %}
<!-- v2.2 - Order Bump com bot√µes personaliz√°veis - Cache Fix -->
<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8" x-data="botConfigApp()" x-init="init()"> <!-- Header --> <div class="mb-8"> <div class="flex items-center"> <a href="{{ url_for('dashboard') }}" class="text-textSecondary hover:text-accent500 transition-colors"> <i class="fas fa-arrow-left mr-2"></i> </a> <div> <h1 class="text-3xl font-bold text-textPrimary">{{ bot.name }}</h1> <p class="mt-1 text-sm text-textSecondary">@{{ bot.username }}</p> </div> <div class="ml-auto"> <button @click="saveConfig()" :disabled="loading" :class="{'opacity-50 cursor-not-allowed': loading}" class="inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-semibold text-black bg-gradient-to-r from-accent500 to-accent600 hover:shadow-accent-glow focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent500 transition-all transform hover:-translate-y-0.5"> <span x-show="!loading" class="flex items-center"> <i class="fas fa-save mr-2"></i> Salvar Configura√ß√µes </span> <span x-show="loading" class="flex items-center"> <svg class="animate-spin h-4 w-4 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"> <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle> <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path> </svg> Salvando... </span> </button> </div> </div> </div> <!-- Tabs --> <div class="card !p-0 border border-white border-opacity-10"> <div class="border-b border-white border-opacity-5"> <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs"> <button @click="activeTab = 'welcome'" :class="activeTab === 'welcome' ? 'tab-button active' : 'tab-button'" class="whitespace-nowrap py-4 px-1 font-medium text-sm"> <i class="fas fa-home mr-2"></i>Boas-vindas </button> <button @click="activeTab = 'buttons'" :class="activeTab === 'buttons' ? 'tab-button active' : 'tab-button'" class="whitespace-nowrap py-4 px-1 font-medium text-sm"> <i class="fas fa-hand-pointer mr-2"></i>Bot√µes </button> <button @click="activeTab = 'downsells'" :class="activeTab === 'downsells' ? 'tab-button active' : 'tab-button'" class="whitespace-nowrap py-4 px-1 font-medium text-sm"> <i class="fas fa-arrow-down mr-2"></i>Downsells </button> <button @click="activeTab = 'upsells'" :class="activeTab === 'upsells' ? 'tab-button active' : 'tab-button'" class="whitespace-nowrap py-4 px-1 font-medium text-sm"> <i class="fas fa-arrow-up mr-2"></i>Upsells </button> <button @click="activeTab = 'access'" :class="activeTab === 'access' ? 'tab-button active' : 'tab-button'" class="whitespace-nowrap py-4 px-1 font-medium text-sm"> <i class="fas fa-link mr-2"></i>Acesso </button> </nav> </div> <div class="p-6"> <!-- Welcome Tab - Redesenhado --> <div x-show="activeTab === 'welcome'" x-cloak> <div class="mb-6"> <h3 class="text-xl font-bold text-textPrimary flex items-center"> <i class="fas fa-home text-accent500 mr-3"></i> Mensagem de Boas-vindas </h3> <p class="text-sm text-textSecondary mt-2">Configure a primeira impress√£o que seus clientes ter√£o ao iniciar o bot</p> </div> <!-- Info Helper --> <div class="mb-6 p-4 bg-info-500 bg-opacity-8 border-l-4 border-info-500 rounded-r-xl"> <div class="flex items-start gap-3"> <i class="fas fa-lightbulb text-info-500 text-lg"></i> <div class="flex-1"> <h4 class="text-sm font-bold text-info-500 mb-1">Primeira Impress√£o</h4> <p class="text-sm text-textPrimary leading-relaxed"> Esta mensagem ser√° enviada quando o usu√°rio clicar em <code class="px-2 py-1 bg-bg900 rounded text-accent400 font-mono text-xs">/start</code>. Use para dar as boas-vindas e apresentar seus produtos. </p> </div> </div> </div> <div class="space-y-6"> <!-- Mensagem --> <div class="space-y-2"> <label class="block text-sm font-semibold text-textSecondary flex items-center gap-2"> <i class="fas fa-comment-dots text-accent500"></i> Mensagem de Boas-vindas <span class="text-danger-500">*</span> <button type="button" class="text-trust-300 hover:text-trust-300 transition-colors" data-tooltip="Digite a mensagem que o cliente ver√° quando iniciar conversa com seu bot. Use para apresentar seus produtos e criar interesse."> <i class="fas fa-question-circle text-sm"></i> </button> </label> <textarea x-model="config.welcome_message" rows="5" class="w-full px-4 py-3 bg-bg900 border border-white border-opacity-10 rounded-xl text-textPrimary placeholder-muted focus:outline-none focus:border-accent500 focus:ring-2 focus:ring-accent500 focus:ring-opacity-20 hover:border-opacity-15 transition-all resize-none" placeholder="Ol√°! Bem-vindo ao nosso bot de vendas..."></textarea> <div class="flex items-start gap-2 p-3 bg-accent500 bg-opacity-8 rounded-lg border border-accent500 border-opacity-20"> <i class="fas fa-code text-accent500 mt-0.5"></i> <p class="text-xs text-textSecondary"> <strong class="text-accent500">Tags HTML:</strong> <code class="ml-2 px-1.5 py-0.5 bg-bg900 rounded text-accent400 font-mono text-xs">&lt;b&gt;negrito&lt;/b&gt;</code> <code class="ml-1 px-1.5 py-0.5 bg-bg900 rounded text-accent400 font-mono text-xs">&lt;i&gt;it√°lico&lt;/i&gt;</code> </p> </div> </div> <!-- URL da M√≠dia --> <div class="space-y-2"> <label class="block text-sm font-semibold text-textSecondary flex items-center"> <i class="fas fa-link text-trust-500 mr-2"></i> URL da M√≠dia <span class="text-muted ml-2 text-xs font-normal">(Telegram)</span> </label> <div class="relative group"> <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"> <i class="fas fa-external-link-alt text-muted group-hover:text-textSecondary transition-colors"></i> </div> <input type="url" x-model="config.welcome_media_url" class="w-full pl-11 pr-4 py-3 bg-bg900 border border-white border-opacity-10 rounded-xl text-textPrimary placeholder-muted focus:outline-none focus:border-trust-500 focus:ring-2 focus:ring-purple-500 focus:ring-opacity-20 hover:border-opacity-15 transition-all" placeholder="https://t.me/canal/123"> </div> <p class="text-xs text-muted ml-1"> Link de v√≠deo ou foto do seu canal (ex: https://t.me/alemaomidias/602) </p> </div> <!-- Tipo de M√≠dia --> <div class="space-y-2"> <label class="block text-sm font-semibold text-textSecondary flex items-center"> <i class="fas fa-image text-trust-500 mr-2"></i> Tipo de M√≠dia </label> <div class="flex gap-3"> <label class="flex items-center px-5 py-3 bg-bg900 border border-white border-opacity-10 rounded-lg cursor-pointer hover:border-opacity-20 transition-all" :class="{'border-trust-500 border-opacity-40 bg-trust-500 bg-opacity-8': config.welcome_media_type === 'video'}"> <input type="radio" x-model="config.welcome_media_type" value="video" class="form-radio text-trust-500 h-4 w-4"> <i class="fas fa-video text-trust-500 ml-2 mr-1.5"></i> <span class="ml-1 text-sm text-textPrimary font-medium">V√≠deo</span> </label> <label class="flex items-center px-5 py-3 bg-bg900 border border-white border-opacity-10 rounded-lg cursor-pointer hover:border-opacity-20 transition-all" :class="{'border-trust-500 border-opacity-40 bg-trust-500 bg-opacity-8': config.welcome_media_type === 'photo'}"> <input type="radio" x-model="config.welcome_media_type" value="photo" class="form-radio text-trust-500 h-4 w-4"> <i class="fas fa-camera text-trust-500 ml-2 mr-1.5"></i> <span class="ml-1 text-sm text-textPrimary font-medium">Foto</span> </label> </div> </div> </div> </div> <!-- Buttons Tab - Redesenhado --> <div x-show="activeTab === 'buttons'" x-cloak> <div class="flex justify-between items-start mb-6"> <div> <h3 class="text-xl font-bold text-textPrimary flex items-center"> <i class="fas fa-shopping-bag text-success-500 mr-3"></i> Bot√µes de Venda </h3> <p class="text-sm text-textSecondary mt-2">Adicione bot√µes com valores para gerar PIX automaticamente</p> </div> <button @click="addButton()" class="inline-flex items-center px-4 py-2.5 border border-transparent rounded-xl text-sm font-semibold text-black bg-gradient-to-r from-success-500 to-green-700 hover:shadow-lg transition-all transform hover:-translate-y-0.5" style="box-shadow: 0 6px 16px rgba(34, 197, 94, 0.3);" data-tooltip="Adicione um novo bot√£o de venda com valor personalizado"> <i class="fas fa-plus-circle mr-2"></i> Adicionar Bot√£o </button> </div> <div class="space-y-6" x-show="config.main_buttons && config.main_buttons.length > 0"> <template x-for="(button, index) in config.main_buttons" :key="index"> <div class="bg-surface800 border border-white border-opacity-10 rounded-2xl p-6 hover:border-opacity-15 transition-all" x-init="if (!button.order_bump) { button.order_bump = { enabled: false, message: '', media_url: '', media_type: 'video', price: 0, description: '', accept_text: '', decline_text: '' }; }"> <!-- Header do Card --> <div class="flex justify-between items-center mb-5 pb-4 border-b border-white border-opacity-10"> <div class="flex items-center"> <div class="flex items-center justify-center h-10 w-10 rounded-lg bg-success-500 bg-opacity-15 border border-success-500 border-opacity-25"> <span class="text-lg font-bold text-success-500" x-text="index + 1"></span> </div> <h4 class="ml-3 text-base font-bold text-textPrimary"> Bot√£o <span x-text="index + 1"></span> </h4> </div> <button @click="async () => { const confirmed = await confirmAction({ title: 'Remover este bot√£o?', message: 'O bot√£o ser√° removido da lista de op√ß√µes de venda.', warning: 'Esta a√ß√£o n√£o pode ser desfeita!', icon: 'üóëÔ∏è', confirmText: 'Sim, remover', cancelText: 'Cancelar' }); if (confirmed) removeButton(index); }" class="flex items-center justify-center h-10 w-10 border-2 border-danger-500 border-opacity-30 text-danger-500 rounded-lg hover:bg-danger-500 hover:bg-opacity-15 hover:border-opacity-50 transition-all"> <i class="fas fa-trash"></i> </button> </div> <!-- Campos do Bot√£o --> <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 mb-5"> <div class="space-y-2"> <label class="block text-xs font-semibold text-textSecondary flex items-center gap-2"> <i class="fas fa-font text-info-500"></i> Texto do Bot√£o <button type="button" class="text-trust-300 hover:text-trust-300" data-tooltip="O texto que aparecer√° no bot√£o. Ex: 'Comprar por R$ 97'"> <i class="fas fa-question-circle text-xs"></i> </button> </label> <input type="text" x-model="button.text" class="w-full px-3 py-2.5 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:border-info-500 focus:ring-1 focus:ring-info-500 focus:ring-opacity-20 transition-all text-sm" placeholder="Comprar por R$ 19,97"> </div> <div class="space-y-2"> <label class="block text-xs font-semibold text-textSecondary flex items-center gap-2"> <i class="fas fa-dollar-sign text-success-500"></i> Pre√ßo (R$) <button type="button" class="text-trust-300 hover:text-trust-300" data-tooltip="Valor que ser√° cobrado quando o cliente clicar neste bot√£o"> <i class="fas fa-question-circle text-xs"></i> </button> </label> <input type="number" x-model="button.price" step="0.01" class="w-full px-3 py-2.5 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:border-success-500 focus:ring-1 focus:ring-success-500 focus:ring-opacity-20 transition-all text-sm text-center font-mono" placeholder="19.97"> </div> <div class="sm:col-span-2 space-y-2"> <label class="block text-xs font-semibold text-textSecondary flex items-center"> <i class="fas fa-tag text-accent500 mr-1.5"></i> Descri√ß√£o do Produto </label> <input type="text" x-model="button.description" class="w-full px-3 py-2.5 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:border-accent500 focus:ring-1 focus:ring-accent500 focus:ring-opacity-20 transition-all text-sm" placeholder="Curso Completo de..."> </div> </div> <!-- Order Bump ESPEC√çFICO deste bot√£o - Redesenhado --> <div class="mt-5 border-2 border-accent500 border-opacity-25 rounded-2xl p-5 bg-accent500 bg-opacity-8" style="box-shadow: 0 4px 12px rgba(255,186,8,0.1);"> <div class="flex items-center justify-between mb-4"> <div class="flex items-center"> <input type="checkbox" x-model="button.order_bump.enabled" :id="'order_bump_' + index" class="h-5 w-5 rounded border-accent500 border-opacity-30 bg-bg900 text-accent500 focus:ring-accent500 focus:ring-opacity-20"> <label :for="'order_bump_' + index" class="ml-3 flex items-center text-base font-bold text-textPrimary cursor-pointer"> <i class="fas fa-gift text-accent500 mr-2"></i> Order Bump Personalizado </label> </div> <span x-show="button.order_bump.enabled" class="inline-flex items-center px-3 py-1.5 rounded-lg text-xs font-bold bg-success-500 bg-opacity-20 text-success-500 border border-success-500 border-opacity-40"> <i class="fas fa-check-circle mr-1.5"></i> ATIVO </span> <span x-show="!button.order_bump.enabled" class="inline-flex items-center px-3 py-1.5 rounded-lg text-xs font-bold bg-white bg-opacity-5 text-muted border border-white border-opacity-10"> DESATIVADO </span> </div> <div x-show="!button.order_bump.enabled" class="flex items-start gap-2 p-3 bg-danger-500 bg-opacity-10 border-l-4 border-danger-500 rounded-r-lg mb-3"> <i class="fas fa-exclamation-triangle text-danger-500"></i> <p class="text-xs text-textPrimary font-semibold"> Marque o checkbox acima para ativar o Order Bump! </p> </div> <p x-show="button.order_bump.enabled" class="text-xs text-textSecondary mb-4"> Oferta especial exibida quando o cliente clicar neste bot√£o </p> <div class="space-y-4" x-show="button.order_bump.enabled"> <!-- Mensagem do Order Bump --> <div class="space-y-2"> <label class="block text-xs font-semibold text-textSecondary flex items-center"> <i class="fas fa-comment-alt text-accent500 mr-1.5"></i> Mensagem do Order Bump <span class="text-danger-500 ml-1">*</span> </label> <textarea x-model="button.order_bump.message" rows="3" class="w-full px-3 py-2.5 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:border-accent500 focus:ring-1 focus:ring-accent500 focus:ring-opacity-20 transition-all text-sm resize-none" placeholder="Espere! Adicione este b√¥nus especial por apenas +R$ 5!&#10;&#10;Voc√™ ter√° acesso vital√≠cio..."></textarea> </div> <!-- M√≠dia do Order Bump --> <div class="space-y-2"> <label class="block text-xs font-semibold text-textSecondary flex items-center"> <i class="fas fa-image text-trust-500 mr-1.5"></i> M√≠dia <span class="text-muted ml-2 text-xs font-normal">(Opcional)</span> </label> <div class="grid grid-cols-2 gap-3"> <input type="url" x-model="button.order_bump.media_url" class="w-full px-3 py-2.5 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:border-trust-500 focus:ring-1 focus:ring-purple-500 focus:ring-opacity-20 transition-all text-xs" placeholder="https://t.me/canal/123"> <select x-model="button.order_bump.media_type" class="w-full px-3 py-2.5 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary focus:outline-none focus:border-trust-500 focus:ring-1 focus:ring-purple-500 focus:ring-opacity-20 transition-all text-xs"> <option value="video">V√≠deo</option> <option value="photo">Foto</option> </select> </div> </div> <!-- Valores do Order Bump --> <div class="grid grid-cols-2 gap-3"> <div class="space-y-2"> <label class="block text-xs font-semibold text-textSecondary flex items-center"> <i class="fas fa-plus-circle text-success-500 mr-1.5"></i> Pre√ßo Adicional (R$) </label> <input type="number" x-model="button.order_bump.price" step="0.01" class="w-full px-3 py-2.5 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:border-success-500 focus:ring-1 focus:ring-success-500 focus:ring-opacity-20 transition-all text-sm text-center font-mono" placeholder="5.00"> </div> <div class="space-y-2"> <label class="block text-xs font-semibold text-textSecondary flex items-center"> <i class="fas fa-award text-accent500 mr-1.5"></i> Descri√ß√£o do B√¥nus </label> <input type="text" x-model="button.order_bump.description" class="w-full px-3 py-2.5 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:border-accent500 focus:ring-1 focus:ring-accent500 focus:ring-opacity-20 transition-all text-sm" placeholder="Acesso Vital√≠cio"> </div> </div> <!-- Personalizar Bot√µes --> <div class="space-y-3"> <label class="block text-xs font-semibold text-textSecondary flex items-center"> <i class="fas fa-hand-pointer text-info-500 mr-1.5"></i> Personalizar Textos dos Bot√µes <span class="text-muted ml-2 text-xs font-normal">(Opcional)</span> </label> <div class="grid grid-cols-1 gap-3"> <div class="space-y-2"> <div class="flex items-center gap-2"> <i class="fas fa-check-circle text-success-500"></i> <label class="block text-xs font-medium text-textSecondary">Bot√£o de Aceitar (SIM)</label> </div> <input type="text" x-model="button.order_bump && button.order_bump.accept_text ? button.order_bump.accept_text : ''" @input="if (!button.order_bump) button.order_bump = {enabled: false, message: '', media_url: '', media_type: 'video', price: 0, description: '', accept_text: '', decline_text: ''}; button.order_bump.accept_text = $event.target.value" class="w-full px-3 py-2.5 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:border-success-500 focus:ring-1 focus:ring-success-500 focus:ring-opacity-20 transition-all text-sm" placeholder="Ex: SIM! Quero esse b√¥nus!"> <p class="text-xs text-muted ml-1"> Deixe vazio para usar: "SIM! Quero por R$ XX,XX" </p> </div> <div class="space-y-2"> <div class="flex items-center gap-2"> <i class="fas fa-times-circle text-danger-500"></i> <label class="block text-xs font-medium text-textSecondary">Bot√£o de Recusar (N√ÉO)</label> </div> <input type="text" x-model="button.order_bump && button.order_bump.decline_text ? button.order_bump.decline_text : ''" @input="if (!button.order_bump) button.order_bump = {enabled: false, message: '', media_url: '', media_type: 'video', price: 0, description: '', accept_text: '', decline_text: ''}; button.order_bump.decline_text = $event.target.value" class="w-full px-3 py-2.5 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:border-danger-500 focus:ring-1 focus:ring-danger-500 focus:ring-opacity-20 transition-all text-sm" placeholder="Ex: N√£o, obrigado"> <p class="text-xs text-muted ml-1"> Deixe vazio para usar: "N√ÉO, continuar com R$ XX,XX" </p> </div> </div> </div> <!-- Dica Final --> <div class="flex items-start gap-2 p-3 bg-accent500 bg-opacity-8 border-l-4 border-accent500 rounded-r-lg"> <i class="fas fa-lightbulb text-accent500"></i> <p class="text-xs text-textPrimary"> <strong class="text-accent500">Dica de convers√£o:</strong> Order bumps com v√≠deo/foto convertem +40%! Use m√≠dia de canal p√∫blico do Telegram. </p> </div> </div> </div> </div> </template> <div x-show="!config.main_buttons || config.main_buttons.length === 0" class="text-center py-8 text-txt-tertiary"> <i class="fas fa-hand-pointer text-4xl text-txt-muted"></i> <p class="mt-2 text-sm">Nenhum bot√£o configurado. Adicione seu primeiro bot√£o.</p> </div> </div> <!-- Divisor --> <div class="my-8 border-t border-white border-opacity-10"></div> <!-- Bot√µes de Redirecionamento --> <div class="flex justify-between items-start mb-6"> <div> <h3 class="text-xl font-bold text-textPrimary flex items-center"> <i class="fas fa-external-link-alt text-info-500 mr-3"></i> Bot√µes de Redirecionamento </h3> <p class="text-sm text-textSecondary mt-2">Adicione bot√µes para links externos, grupos, canais, etc. (sem pagamento)</p> </div> <button @click="addRedirectButton()" class="inline-flex items-center px-4 py-2.5 border border-transparent rounded-xl text-sm font-semibold text-black bg-gradient-to-r from-info-500 to-blue-600 hover:shadow-lg transition-all transform hover:-translate-y-0.5" style="box-shadow: 0 6px 16px rgba(59, 130, 246, 0.3);"> <i class="fas fa-plus-circle mr-2"></i> Adicionar Bot√£o de Link </button> </div> <div class="space-y-4" x-show="config.redirect_buttons && config.redirect_buttons.length > 0"> <template x-for="(button, index) in config.redirect_buttons" :key="index"> <div class="bg-surface800 border border-info-500 border-opacity-20 rounded-xl p-5 hover:border-opacity-30 transition-all"> <div class="flex items-start gap-4"> <div class="flex items-center justify-center h-10 w-10 rounded-lg bg-info-500 bg-opacity-15 border border-info-500 border-opacity-25 flex-shrink-0"> <i class="fas fa-link text-info-500"></i> </div> <div class="flex-1 grid grid-cols-1 sm:grid-cols-2 gap-4"> <div class="space-y-2"> <label class="block text-xs font-semibold text-textSecondary flex items-center"> <i class="fas fa-font text-info-500 mr-1.5"></i> Texto do Bot√£o </label> <input type="text" x-model="button.text" class="w-full px-3 py-2.5 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:border-info-500 focus:ring-1 focus:ring-info-500 transition-all text-sm" placeholder="Entre no Grupo VIP"> </div> <div class="space-y-2"> <label class="block text-xs font-semibold text-textSecondary flex items-center"> <i class="fas fa-globe text-success-500 mr-1.5"></i> URL de Destino </label> <input type="url" x-model="button.url" class="w-full px-3 py-2.5 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:border-success-500 focus:ring-1 focus:ring-success-500 transition-all text-sm" placeholder="https://t.me/seugrupo"> </div> </div> <button @click="removeRedirectButton(index)" class="flex items-center justify-center h-10 w-10 border-2 border-danger-500 border-opacity-30 text-danger-500 rounded-lg hover:bg-danger-500 hover:bg-opacity-15 transition-all flex-shrink-0"> <i class="fas fa-trash"></i> </button> </div> <!-- Dica --> <div class="mt-3 flex items-start gap-2 p-3 bg-info-500 bg-opacity-8 border-l-4 border-info-500 rounded-r-lg"> <i class="fas fa-lightbulb text-info-500 text-sm"></i> <p class="text-xs text-textPrimary"> <strong class="text-info-500">Exemplos de uso:</strong> Links para grupos do Telegram, canais, sites externos, redes sociais, formul√°rios, etc. </p> </div> </div> </template> </div> <div x-show="!config.redirect_buttons || config.redirect_buttons.length === 0" class="text-center py-8 text-muted"> <i class="fas fa-external-link-alt text-4xl opacity-30"></i> <p class="mt-2 text-sm">Nenhum bot√£o de redirecionamento configurado.</p> <p class="text-xs mt-1">Use para criar bot√µes que levam a links externos sem pagamento</p> </div> </div> <!-- Order Bump Tab --> <div x-show="activeTab === 'order_bump'" x-cloak> <div class="mb-4"> <h3 class="text-lg font-medium text-txt-primary">Order Bumps Personalizados</h3> <p class="text-sm text-txt-tertiary bg-yellow-50 border border-gold-100 p-3 rounded-md"> <strong>‚ö†Ô∏è Aten√ß√£o:</strong> Configure o Order Bump diretamente em cada bot√£o na aba "Bot√µes" acima!<br> Cada oferta pode ter seu pr√≥prio order bump personalizado. </p> </div> <div class="bg-blue-50 border border-trust-100 rounded-md p-4"> <h4 class="text-sm font-medium text-trust-900 mb-2">Como configurar Order Bumps:</h4> <ol class="text-sm text-trust-900 space-y-1 list-decimal list-inside"> <li>V√° na aba <strong>"Bot√µes"</strong></li> <li>Em cada bot√£o, marque <strong>"Order Bump para este bot√£o"</strong></li> <li>Configure mensagem, pre√ßo e descri√ß√£o espec√≠ficos</li> <li>Salve as configura√ß√µes</li> </ol> <p class="mt-3 text-sm text-trust-700"> <strong>Exemplo:</strong><br> ‚Ä¢ Bot√£o "Plano R$ 19,97" ‚Üí Order Bump: "B√¥nus A por +R$ 5"<br> ‚Ä¢ Bot√£o "Plano R$ 29,97" ‚Üí Order Bump: "B√¥nus B por +R$ 10" </p> </div> </div> <!-- Downsells Tab --> <div x-show="activeTab === 'downsells'" x-cloak> <div class="flex justify-between items-center mb-4"> <div> <h3 class="text-lg font-medium text-txt-primary">Downsells</h3> <p class="text-sm text-txt-tertiary">Ofertas enviadas ap√≥s X minutos sem pagamento</p> </div> <button @click="addDownsell()" class="inline-flex items-center px-3 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-trust-500 hover:bg-trust-700"> <i class="fas fa-plus mr-2"></i>Adicionar Downsell </button> </div> <div class="mb-4"> <div class="flex items-center"> <input type="checkbox" x-model="config.downsells_enabled" id="downsells_enabled" class="h-4 w-4 text-trust-500 focus:ring-blue-500 border-white border-opacity-10 rounded"> <label for="downsells_enabled" class="ml-2 block text-sm text-txt-primary"> Habilitar Downsells </label> </div> </div> <div x-show="config.downsells_enabled" class="space-y-4"> <template x-for="(downsell, index) in config.downsells" :key="index"> <div class="border border-white border-opacity-5 rounded-lg p-4"> <div class="flex justify-between items-start mb-3"> <h4 class="text-sm font-medium text-txt-secondary">Downsell <span x-text="index + 1"></span></h4> <button @click="removeDownsell(index)" class="text-alert-500 hover:text-alert-900"> <i class="fas fa-trash"></i> </button> </div> <div class="space-y-3"> <div> <label class="block text-sm font-medium text-txt-secondary">Delay (minutos)</label> <input type="number" x-model="downsell.delay_minutes" class="mt-1 block w-full border border-white border-opacity-10 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-trust-500 sm:text-sm" placeholder="5"> <p class="mt-1 text-xs text-txt-tertiary">Tempo de espera antes de enviar a oferta</p> </div> <div> <label class="block text-sm font-medium text-txt-secondary">Mensagem</label> <textarea x-model="downsell.message" rows="3" class="mt-1 block w-full border border-white border-opacity-10 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-trust-500 sm:text-sm" placeholder="Oferta especial por tempo limitado!"></textarea> </div> <div> <label class="block text-sm font-medium text-txt-secondary">URL da M√≠dia</label> <input type="url" x-model="downsell.media_url" class="mt-1 block w-full border border-white border-opacity-10 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-trust-500 sm:text-sm" placeholder="https://t.me/canal/789"> </div> <!-- ‚úÖ NOVO: Modo de Precifica√ß√£o --> <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg border-2 border-purple-200"> <label class="block text-sm font-bold text-trust-900 mb-3"> <i class="fas fa-calculator mr-2"></i>Modo de Precifica√ß√£o </label> <div class="grid grid-cols-2 gap-3 mb-4"> <button type="button" @click="downsell.pricing_mode = 'fixed'" :class="(downsell.pricing_mode || 'fixed') === 'fixed' ? 'bg-trust-500 text-white border-trust-500' : 'bg-white text-txt-secondary border-white border-opacity-10'" class="flex items-center justify-center gap-2 px-4 py-3 border-2 rounded-lg font-semibold text-sm transition-all"> <i class="fas fa-dollar-sign"></i> Pre√ßo Fixo </button> <button type="button" @click="downsell.pricing_mode = 'percentage'" :class="downsell.pricing_mode === 'percentage' ? 'bg-trust-500 text-white border-trust-500' : 'bg-white text-txt-secondary border-white border-opacity-10'" class="flex items-center justify-center gap-2 px-4 py-3 border-2 rounded-lg font-semibold text-sm transition-all"> <i class="fas fa-percent"></i> Desconto % </button> </div> <!-- Modo: Pre√ßo Fixo --> <div x-show="(downsell.pricing_mode || 'fixed') === 'fixed'"> <label class="block text-sm font-medium text-txt-secondary mb-2">Pre√ßo Fixo (R$)</label> <input type="number" x-model="downsell.price" step="0.01" class="block w-full border-2 border-trust-300 rounded-md shadow-sm py-3 px-4 focus:outline-none focus:ring-blue-500 focus:border-trust-500 text-sm font-bold text-center" placeholder="14.97"> <p class="mt-2 text-xs text-txt-secondary"> <i class="fas fa-info-circle mr-1"></i> Valor fixo do downsell </p> </div> <!-- Modo: Desconto Percentual --> <div x-show="downsell.pricing_mode === 'percentage'"> <label class="block text-sm font-medium text-txt-secondary mb-2">Desconto Percentual (%)</label> <input type="number" x-model="downsell.discount_percentage" min="1" max="95" step="1" class="block w-full border-2 border-trust-300 rounded-md shadow-sm py-3 px-4 focus:outline-none focus:ring-purple-500 focus:border-trust-500 text-sm font-bold text-center" placeholder="50"> <p class="mt-2 text-xs text-trust-700 bg-trust-100 p-2 rounded"> <i class="fas fa-magic mr-1"></i> <strong>Exemplo:</strong> 50% de R$ 19,97 = R$ 9,99 (calculado automaticamente baseado no bot√£o clicado) </p> <p class="mt-1 text-xs text-txt-secondary"> <i class="fas fa-info-circle mr-1"></i> O desconto ser√° aplicado sobre o pre√ßo do bot√£o que o cliente clicou </p> </div> </div> <!-- Personaliza√ß√£o do Bot√£o --> <div class="bg-blue-50 p-4 rounded-lg border border-trust-100"> <label class="block text-sm font-bold text-trust-900 mb-3"> <i class="fas fa-mouse-pointer mr-1"></i>Personalizar Bot√£o de Compra </label> <div> <label class="block text-sm font-medium text-txt-secondary mb-2">Texto do Bot√£o</label> <input type="text" x-model="downsell.button_text" class="mt-1 block w-full border-2 border-trust-300 rounded-md shadow-sm py-3 px-4 text-sm focus:outline-none focus:ring-blue-500 focus:border-trust-500" placeholder="Ex: üõí Comprar Agora!"> <p class="text-xs text-trust-500 mt-2"> <i class="fas fa-info-circle mr-1"></i> <strong>Dica:</strong> Deixe vazio para usar: "üõí Comprar por R$ XX,XX" </p> </div> </div> </div> </div> </template> <div x-show="config.downsells.length === 0" class="text-center py-8 text-txt-tertiary"> <i class="fas fa-arrow-down text-4xl text-txt-muted"></i> <p class="mt-2 text-sm">Nenhum downsell configurado.</p> </div> </div> </div> <!-- ‚úÖ UPSELLS TAB - NOVO --> <div x-show="activeTab === 'upsells'" x-cloak> <div class="flex justify-between items-center mb-6"> <div> <h3 class="text-xl font-bold text-textPrimary flex items-center"> <i class="fas fa-arrow-up text-success-500 mr-3"></i> Upsells Autom√°ticos </h3> <p class="text-sm text-textSecondary mt-2">Ofertas enviadas AP√ìS compra aprovada para aumentar ticket m√©dio</p> </div> <button @click="addUpsell()" class="inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-semibold text-white bg-gradient-to-r from-success-500 to-success-600 hover:shadow-lg transition-all"> <i class="fas fa-plus mr-2"></i>Adicionar Upsell </button> </div> <!-- Info Helper --> <div class="mb-6 p-4 bg-success-500 bg-opacity-10 border-l-4 border-success-500 rounded-r-xl"> <div class="flex items-start gap-3"> <i class="fas fa-rocket text-success-500 text-lg"></i> <div class="flex-1"> <h4 class="text-sm font-bold text-success-500 mb-1">Como Funciona?</h4> <p class="text-sm text-textPrimary leading-relaxed"> Ap√≥s o cliente <strong>PAGAR</strong> um produto, voc√™ pode enviar ofertas de upgrade automaticamente. Configure o produto que dispara (trigger) e o tempo de espera. Deixe o trigger vazio para disparar em todas as compras. </p> </div> </div> </div> <!-- Toggle Habilitar --> <div class="mb-6"> <div class="flex items-center p-4 bg-surface800 rounded-xl border border-white border-opacity-10"> <input type="checkbox" x-model="config.upsells_enabled" id="upsells_enabled" class="h-5 w-5 text-success-600 focus:ring-success-500 border-white border-opacity-20 rounded"> <label for="upsells_enabled" class="ml-3 block text-sm font-semibold text-textPrimary"> <i class="fas fa-toggle-on text-success-500 mr-2"></i>Habilitar Upsells Autom√°ticos </label> </div> </div> <!-- Lista de Upsells --> <div x-show="config.upsells_enabled" class="space-y-4"> <template x-for="(upsell, index) in config.upsells" :key="index"> <div class="border border-success-500 border-opacity-30 rounded-xl p-5 bg-surface800"> <div class="flex justify-between items-start mb-4"> <h4 class="text-base font-bold text-success-500 flex items-center gap-2"> <i class="fas fa-gift"></i> Upsell <span x-text="index + 1"></span> </h4> <button @click="removeUpsell(index)" class="text-danger-500 hover:text-danger-400 transition-colors"> <i class="fas fa-trash"></i> </button> </div> <div class="space-y-4"> <!-- Trigger Product (DIFERENCIAL) --> <div class="bg-info-500 bg-opacity-10 p-4 rounded-lg border border-info-500 border-opacity-30"> <label class="block text-sm font-bold text-info-400 mb-2"> <i class="fas fa-filter mr-1"></i>Produto Trigger (opcional) </label> <input type="text" x-model="upsell.trigger_product" class="w-full px-4 py-3 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:ring-2 focus:ring-info-500" placeholder="Ex: INSS B√°sico (vazio = todas as compras)"> <p class="mt-2 text-xs text-info-300"> <i class="fas fa-info-circle mr-1"></i> Deixe vazio para disparar em TODAS as compras, ou especifique o nome exato do produto </p> </div> <!-- Delay --> <div> <label class="block text-sm font-medium text-textSecondary mb-2"> <i class="fas fa-clock mr-1"></i>Delay (minutos) </label> <input type="number" x-model="upsell.delay_minutes" class="w-full px-4 py-3 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary focus:outline-none focus:ring-2 focus:ring-success-500" placeholder="0"> <p class="mt-1 text-xs text-muted">0 = imediato, 30 = ap√≥s 30 minutos</p> </div> <!-- Mensagem --> <div> <label class="block text-sm font-medium text-textSecondary mb-2"> <i class="fas fa-comment-dots mr-1"></i>Mensagem do Upsell </label> <textarea x-model="upsell.message" rows="4" class="w-full px-4 py-3 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:ring-2 focus:ring-success-500 resize-none" placeholder="üî• Upgrade para o plano Premium por apenas R$ 97!"></textarea> </div> <!-- URL da M√≠dia --> <div> <label class="block text-sm font-medium text-textSecondary mb-2"> <i class="fas fa-photo-video mr-1"></i>URL da M√≠dia (opcional) </label> <input type="url" x-model="upsell.media_url" class="w-full px-4 py-3 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:ring-2 focus:ring-success-500" placeholder="https://t.me/canal/123"> </div> <!-- Produto e Pre√ßo --> <div class="grid grid-cols-2 gap-4"> <div> <label class="block text-sm font-medium text-textSecondary mb-2"> <i class="fas fa-box mr-1"></i>Nome do Produto </label> <input type="text" x-model="upsell.product_name" class="w-full px-4 py-3 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:ring-2 focus:ring-success-500" placeholder="Ex: INSS Premium"> </div> <div> <label class="block text-sm font-medium text-textSecondary mb-2"> <i class="fas fa-dollar-sign mr-1"></i>Pre√ßo (R$) </label> <input type="number" x-model="upsell.price" step="0.01" class="w-full px-4 py-3 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:ring-2 focus:ring-success-500" placeholder="97.00"> </div> </div> <!-- Bot√£o Personalizado --> <div> <label class="block text-sm font-medium text-textSecondary mb-2"> <i class="fas fa-mouse-pointer mr-1"></i>Texto do Bot√£o </label> <input type="text" x-model="upsell.button_text" class="w-full px-4 py-3 bg-bg900 border border-white border-opacity-10 rounded-lg text-textPrimary placeholder-muted focus:outline-none focus:ring-2 focus:ring-success-500" placeholder="üöÄ Quero fazer Upgrade!"> <p class="mt-1 text-xs text-muted">Deixe vazio para usar texto padr√£o</p> </div> </div> </div> </template> <!-- Empty State --> <div x-show="config.upsells.length === 0" class="text-center py-12 px-4 border-2 border-dashed border-white border-opacity-10 rounded-xl"> <i class="fas fa-arrow-up text-5xl text-muted mb-4"></i> <p class="text-textSecondary mb-4">Nenhum upsell configurado</p> <button @click="addUpsell()" class="inline-flex items-center px-4 py-2 bg-success-600 text-white rounded-lg hover:bg-success-700 transition-colors"> <i class="fas fa-plus mr-2"></i>Adicionar Primeiro Upsell </button> </div> </div> </div> <!-- Access Tab - Redesenhado --> <div x-show="activeTab === 'access'" x-cloak> <div class="mb-6"> <h3 class="text-xl font-bold text-textPrimary flex items-center"> <i class="fas fa-key text-accent500 mr-3"></i> Link de Acesso e Mensagens </h3> <p class="text-sm text-textSecondary mt-2">Configure o acesso ao produto e as mensagens de confirma√ß√£o de pagamento</p> </div> <div class="space-y-6"> <!-- Link de Acesso --> <div class="bg-surface800 rounded-2xl p-6 border border-white border-opacity-10"> <label class="block text-sm font-semibold text-textSecondary flex items-center mb-3"> <i class="fas fa-external-link-alt text-info-500 mr-2"></i> Link de Acesso ao Produto </label> <div class="relative group"> <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"> <i class="fas fa-link text-muted group-hover:text-textSecondary transition-colors"></i> </div> <input type="url" x-model="config.access_link" class="w-full pl-11 pr-4 py-3.5 bg-bg900 border border-white border-opacity-10 rounded-xl text-textPrimary placeholder-muted focus:outline-none focus:border-info-500 focus:ring-2 focus:ring-info-500 focus:ring-opacity-20 hover:border-opacity-15 transition-all" placeholder="https://t.me/+seugrupo ou https://area-membros.com"> </div> <div class="flex items-start gap-3 p-4 bg-info-500 bg-opacity-12 border-l-4 border-info-500 rounded-r-xl mt-3" style="box-shadow: 0 2px 8px rgba(59, 130, 246, 0.12);"> <div class="flex-shrink-0"> <i class="fas fa-info-circle text-lg" style="color: var(--trust-400); filter: brightness(1.3);"></i> </div> <p class="text-sm leading-relaxed" style="color: var(--txt-primary); font-weight: 500;"> Pode ser um link de <strong style="color: var(--trust-400); font-weight: 900;">grupo/canal privado</strong> do Telegram, √°rea de membros, Google Drive, etc. </p> </div> </div> <!-- Mensagem de Sucesso --> <div class="bg-surface800 rounded-2xl p-6 border border-success-500 border-opacity-20" style="box-shadow: 0 4px 12px rgba(34, 197, 94, 0.1);"> <label class="block text-sm font-semibold text-textSecondary flex items-center mb-3"> <i class="fas fa-check-circle text-success-500 mr-2" style="filter: brightness(1.2);"></i> Mensagem de Pagamento Confirmado </label> <textarea x-model="config.success_message" rows="5" class="w-full px-4 py-3.5 bg-bg900 border border-white border-opacity-10 rounded-xl text-textPrimary placeholder-muted focus:outline-none focus:border-success-500 focus:ring-2 focus:ring-success-500 focus:ring-opacity-20 hover:border-opacity-15 transition-all resize-none" placeholder="Parab√©ns! Seu pagamento foi aprovado!&#10;&#10;Acesse seu produto agora mesmo!"></textarea> <div class="flex items-start gap-3 p-4 bg-success-500 bg-opacity-15 border-l-4 border-success-500 rounded-r-xl mt-3" style="box-shadow: 0 2px 8px rgba(34, 197, 94, 0.15);"> <div class="flex-shrink-0"> <i class="fas fa-code text-xl" style="color: var(--brand-emerald-500); filter: brightness(1.3);"></i> </div> <div class="flex-1"> <p class="text-sm leading-relaxed" style="color: var(--txt-primary); font-weight: 500;"> <strong style="color: var(--brand-emerald-500); font-weight: 900; filter: brightness(1.15);">Vari√°veis dispon√≠veis:</strong> <code class="ml-2 px-2 py-1 bg-bg900 rounded font-mono text-sm" style="color: var(--brand-gold-400); font-weight: 700; border: 1px solid rgba(255, 186, 8, 0.3);">{produto}</code> <code class="ml-1 px-2 py-1 bg-bg900 rounded font-mono text-sm" style="color: var(--brand-gold-400); font-weight: 700; border: 1px solid rgba(255, 186, 8, 0.3);">{valor}</code> <code class="ml-1 px-2 py-1 bg-bg900 rounded font-mono text-sm" style="color: var(--brand-gold-400); font-weight: 700; border: 1px solid rgba(255, 186, 8, 0.3);">{link}</code> </p> <p class="text-xs mt-2" style="color: var(--txt-secondary); font-weight: 500;"> Deixe vazio para usar mensagem padr√£o do sistema </p> </div> </div> </div> <!-- Mensagem Pendente --> <div class="bg-surface800 rounded-2xl p-6 border border-warning-500 border-opacity-20" style="box-shadow: 0 4px 12px rgba(245, 158, 11, 0.1);"> <label class="block text-sm font-semibold text-textSecondary flex items-center mb-3"> <i class="fas fa-hourglass-half text-warning-500 mr-2" style="filter: brightness(1.2);"></i> Mensagem de Pagamento Pendente </label> <textarea x-model="config.pending_message" rows="5" class="w-full px-4 py-3.5 bg-bg900 border border-white border-opacity-10 rounded-xl text-textPrimary placeholder-muted focus:outline-none focus:border-warning-500 focus:ring-2 focus:ring-warning-500 focus:ring-opacity-20 hover:border-opacity-15 transition-all resize-none" placeholder="Pagamento ainda n√£o confirmado.&#10;&#10;Se j√° pagou, aguarde alguns minutos!"></textarea> <div class="flex items-start gap-3 p-4 bg-warning-500 bg-opacity-15 border-l-4 border-warning-500 rounded-r-xl mt-3" style="box-shadow: 0 2px 8px rgba(245, 158, 11, 0.15);"> <div class="flex-shrink-0"> <i class="fas fa-code text-xl" style="color: var(--brand-gold-400); filter: brightness(1.3);"></i> </div> <div class="flex-1"> <p class="text-sm leading-relaxed" style="color: var(--txt-primary); font-weight: 500;"> <strong style="color: var(--brand-gold-400); font-weight: 900; filter: brightness(1.2);">Vari√°vel dispon√≠vel:</strong> <code class="ml-2 px-2 py-1 bg-bg900 rounded font-mono text-sm" style="color: var(--brand-gold-400); font-weight: 700; border: 1px solid rgba(255, 186, 8, 0.3);">{pix_code}</code> </p> <p class="text-xs mt-2" style="color: var(--txt-secondary); font-weight: 500;"> Deixe vazio para usar mensagem padr√£o do sistema </p> </div> </div> </div> </div> </div> </div> </div> </div>
{% endblock %} {% block extra_scripts %}
<script>
function botConfigApp() { return { activeTab: 'welcome', loading: false, config: { welcome_message: '', welcome_media_url: '', welcome_media_type: 'video', main_buttons: [], redirect_buttons: [], downsells_enabled: false, downsells: [], upsells_enabled: false, upsells: [], access_link: '', success_message: '', pending_message: '' }, async init() { // Carregar configura√ß√£o atual await this.loadConfig(); }, async loadConfig() { try { const response = await fetch('/api/bots/{{ bot.id }}/config'); const data = await response.json(); if (response.ok) { this.config = { ...this.config, ...data }; // Garantir que cada bot√£o tenha order_bump completo if (Array.isArray(this.config.main_buttons)) { this.config.main_buttons.forEach(button => { if (!button.order_bump) { button.order_bump = { enabled: false, message: '', media_url: '', media_type: 'video', price: 0, description: '', accept_text: '', decline_text: '' }; } else { // Garantir campos novos em order bumps existentes if (!button.order_bump.accept_text) button.order_bump.accept_text = ''; if (!button.order_bump.decline_text) button.order_bump.decline_text = ''; } }); } // ‚úÖ Garantir que cada downsell tenha TODOS os campos necess√°rios if (Array.isArray(this.config.downsells)) { this.config.downsells.forEach(downsell => { // Campos b√°sicos if (!downsell.hasOwnProperty('button_text')) downsell.button_text = ''; if (!downsell.hasOwnProperty('media_type')) downsell.media_type = 'video'; if (!downsell.hasOwnProperty('delay_minutes')) downsell.delay_minutes = 5; if (!downsell.hasOwnProperty('message')) downsell.message = ''; if (!downsell.hasOwnProperty('media_url')) downsell.media_url = ''; // ‚úÖ NOVO: Campos de precifica√ß√£o (compatibilidade com downsells antigos) if (!downsell.hasOwnProperty('pricing_mode')) downsell.pricing_mode = 'fixed'; if (!downsell.hasOwnProperty('discount_percentage')) downsell.discount_percentage = 50; if (!downsell.hasOwnProperty('price')) downsell.price = 0; }); } // ‚úÖ Garantir que config.downsells existe (mesmo que vazio) if (!this.config.downsells) { this.config.downsells = []; } // ‚úÖ Garantir que cada upsell tenha TODOS os campos necess√°rios if (Array.isArray(this.config.upsells)) { this.config.upsells.forEach(upsell => { if (!upsell.hasOwnProperty('trigger_product')) upsell.trigger_product = ''; if (!upsell.hasOwnProperty('delay_minutes')) upsell.delay_minutes = 0; if (!upsell.hasOwnProperty('message')) upsell.message = ''; if (!upsell.hasOwnProperty('media_url')) upsell.media_url = ''; if (!upsell.hasOwnProperty('media_type')) upsell.media_type = 'video'; if (!upsell.hasOwnProperty('product_name')) upsell.product_name = ''; if (!upsell.hasOwnProperty('price')) upsell.price = 0; if (!upsell.hasOwnProperty('button_text')) upsell.button_text = ''; }); } // ‚úÖ Garantir que config.upsells existe (mesmo que vazio) if (!this.config.upsells) { this.config.upsells = []; } } } catch (error) { console.error('Erro ao carregar configura√ß√£o:', error); } }, async saveConfig() { this.loading = true; try { const response = await fetch('/api/bots/{{ bot.id }}/config', { method: 'PUT', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify(this.config) }); const data = await response.json(); if (response.ok) { this.showNotification('Configura√ß√µes salvas com sucesso!', 'success'); } else { alert('Erro: ' + data.error); } } catch (error) { alert('Erro ao salvar configura√ß√£o: ' + error.message); } finally { this.loading = false; } }, addButton() { this.config.main_buttons.push({ text: '', price: 0, description: '', order_bump: { enabled: false, message: '', media_url: '', media_type: 'video', price: 0, description: '', accept_text: '', decline_text: '' } }); }, removeButton(index) { this.config.main_buttons.splice(index, 1); }, addRedirectButton() { this.config.redirect_buttons.push({ text: '', url: '' }); }, removeRedirectButton(index) { this.config.redirect_buttons.splice(index, 1); }, addDownsell() { this.config.downsells.push({ delay_minutes: 5, message: '', media_url: '', media_type: 'video', // ‚úÖ Tipo de m√≠dia pricing_mode: 'fixed', // ‚úÖ Modo padr√£o: pre√ßo fixo price: 0, // Para modo fixo discount_percentage: 50, // Para modo percentual (default 50%) button_text: '' }); }, removeDownsell(index) { this.config.downsells.splice(index, 1); }, addUpsell() { this.config.upsells.push({ trigger_product: '', // Vazio = todas compras delay_minutes: 0, // 0 = imediato message: '', media_url: '', media_type: 'video', product_name: '', price: 0, button_text: '' }); }, removeUpsell(index) { this.config.upsells.splice(index, 1); }, showNotification(message, type = 'success') { const notification = document.createElement('div'); notification.className = `fixed top-4 right-4 ${type === 'success' ? 'bg-emerald-500' : 'bg-alert-500'} text-white px-6 py-3 rounded-lg shadow-lg z-50`; notification.textContent = message; document.body.appendChild(notification); setTimeout(() => notification.remove(), 3000); } }
}
</script>
{% endblock %} 