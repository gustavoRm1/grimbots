{% extends "base.html" %}

{% block title %}Hall da Fama - Ranking - grimbots{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Header Instagram-style -->
    <div class="mb-8 text-center">
        <div class="inline-flex items-center gap-4 mb-4">
            <div class="w-16 h-16 rounded-full flex items-center justify-center animate-pulse"
                 style="background: linear-gradient(135deg, var(--brand-gold-500), var(--brand-gold-600)); box-shadow: 0 0 20px rgba(245, 158, 11, 0.5);">
                <i class="fas fa-trophy text-3xl" style="color: var(--brand-gold-900);"></i>
            </div>
            <h1 class="text-4xl font-black" style="color: var(--brand-gold-200); text-shadow: 0 2px 16px rgba(253, 230, 138, 0.6), 0 0 30px rgba(252, 211, 77, 0.4); letter-spacing: 0.05em;">
                HALL DA FAMA
            </h1>
            <div class="w-16 h-16 rounded-full flex items-center justify-center animate-pulse"
                 style="background: linear-gradient(135deg, var(--brand-gold-500), var(--alert-600)); box-shadow: 0 0 20px rgba(249, 115, 22, 0.5);">
                <i class="fas fa-fire text-3xl" style="color: var(--brand-gold-100); filter: drop-shadow(0 0 4px rgba(254, 243, 199, 0.8));"></i>
            </div>
        </div>
        <p class="text-lg font-semibold" style="color: var(--txt-secondary);">Compete, venda e domine o ranking!</p>
    </div>
    
    <!-- Filtros Simplificados -->
    <div class="card !p-6 mb-8">
        <div class="flex flex-wrap justify-center gap-4">
            <div class="flex gap-3">
                <a href="?period=month" 
                   class="px-6 py-3 rounded-xl font-bold text-lg {% if period == 'month' %}bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg{% else %}bg-dark-surface text-txt-primary hover:bg-gray-200{% endif %} transition-all">
                    üìÖ Este M√™s
                </a>
                <a href="?period=all" 
                   class="px-6 py-3 rounded-xl font-bold text-lg {% if period == 'all' %}bg-gradient-to-r from-purple-500 to-purple-600 text-white shadow-lg{% else %}bg-dark-surface text-txt-primary hover:bg-gray-200{% endif %} transition-all">
                    üèÜ Hist√≥rico Completo
                </a>
            </div>
        </div>
        <p class="text-center text-sm text-txt-tertiary mt-3">
            üí° Ranking por <strong>receita total</strong> (quanto cada vendedor faturou)
        </p>
    </div>
    
    <!-- SUA POSI√á√ÉO (Destaque) -->
    {% if my_position %}
    <div class="card !p-0 mb-8 overflow-hidden border-2" style="border-color: var(--brand-gold-500); box-shadow: 0 0 30px rgba(245, 158, 11, 0.4), 0 8px 24px rgba(0, 0, 0, 0.4);">
        <div class="px-6 py-4" style="background: linear-gradient(135deg, var(--brand-gold-500), var(--brand-gold-600));">
            <h3 class="text-lg font-black flex items-center gap-2" style="color: var(--dark-900); text-shadow: 0 1px 2px rgba(255, 255, 255, 0.2);">
                <i class="fas fa-star" style="color: var(--brand-gold-900);"></i> SUA POSI√á√ÉO
            </h3>
        </div>
        <div class="p-6" style="background: var(--dark-800);">
            <div class="flex items-center justify-between flex-wrap gap-6">
                <div class="flex items-center gap-8 flex-wrap">
                    <div class="text-center">
                        <div class="font-black mb-2" style="font-size: 4rem; color: var(--brand-gold-200); text-shadow: 0 2px 16px rgba(253, 230, 138, 0.6), 0 0 30px rgba(252, 211, 77, 0.5); line-height: 1;">
                            #{{ my_position }}
                        </div>
                        <p class="text-xs font-semibold" style="color: var(--txt-secondary);">Posi√ß√£o</p>
                    </div>
                    <div class="h-20 w-px" style="background: rgba(255, 255, 255, 0.15);"></div>
                    <div>
                        <p class="text-sm font-semibold mb-1" style="color: var(--txt-tertiary);">Seus pontos:</p>
                        <p class="text-3xl font-black" style="color: var(--brand-gold-200); text-shadow: 0 0 12px rgba(253, 230, 138, 0.4);">{{ current_user.ranking_points }}</p>
                    </div>
                    {% if current_user.current_streak > 0 %}
                    <div class="h-20 w-px" style="background: rgba(255, 255, 255, 0.15);"></div>
                    <div>
                        <p class="text-sm font-semibold mb-1" style="color: var(--txt-tertiary);">Streak:</p>
                        <div class="flex items-center gap-2">
                            <i class="fas fa-fire text-2xl" style="color: var(--brand-gold-400); filter: drop-shadow(0 0 8px rgba(251, 146, 60, 0.8));"></i>
                            <p class="text-3xl font-black" style="color: var(--brand-gold-300); text-shadow: 0 0 12px rgba(253, 186, 116, 0.4);">{{ current_user.current_streak }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% if next_user %}
                <div class="text-right">
                    <p class="text-sm font-semibold mb-2" style="color: var(--txt-tertiary);">Para subir para #{{ next_user.position }}:</p>
                    <p class="text-xl font-black" style="color: var(--brand-gold-200); text-shadow: 0 0 12px rgba(253, 230, 138, 0.4);">
                        Faltam {{ next_user.points - current_user.ranking_points }} pontos
                    </p>
                    <p class="text-xs font-semibold mt-2" style="color: var(--txt-secondary);">Pr√≥ximo: @{{ next_user.user.username }}</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Top 3 (P√≥dio Visual) -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        {% for item in ranking[:3] %}
        <div class="card !p-6 relative overflow-hidden border-2 {% if loop.index == 1 %}order-2 md:order-1{% elif loop.index == 2 %}order-1 md:order-2 transform md:scale-110 md:-mt-4{% else %}order-3{% endif %}"
             style="background: var(--dark-800); {% if loop.index == 1 %}border-color: var(--brand-gold-500); box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);{% elif loop.index == 2 %}border-color: var(--txt-secondary); box-shadow: 0 0 20px rgba(209, 213, 219, 0.2);{% else %}border-color: var(--brand-gold-500); box-shadow: 0 0 20px rgba(249, 115, 22, 0.3);{% endif %}">
            
            <!-- Medalha -->
            <div class="text-center mb-6">
                <div class="inline-flex w-24 h-24 rounded-full items-center justify-center shadow-xl mb-3"
                     style="{% if loop.index == 1 %}background: linear-gradient(135deg, var(--brand-gold-500), var(--brand-gold-600));{% elif loop.index == 2 %}background: linear-gradient(135deg, var(--txt-secondary), var(--txt-tertiary));{% else %}background: linear-gradient(135deg, var(--brand-gold-500), var(--brand-gold-600));{% endif %} box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);">
                    <i class="{% if loop.index == 1 %}fas fa-crown{% elif loop.index == 2 %}fas fa-award{% else %}fas fa-medal{% endif %} text-5xl"
                       style="{% if loop.index == 1 %}color: var(--brand-gold-900);{% elif loop.index == 2 %}color: var(--dark-700);{% else %}color: var(--brand-gold-800);{% endif %}"></i>
                </div>
                <p class="text-3xl font-black" style="{% if loop.index == 1 %}color: var(--brand-gold-200); text-shadow: 0 0 12px rgba(253, 230, 138, 0.5);{% elif loop.index == 2 %}color: var(--txt-secondary); text-shadow: 0 0 12px rgba(243, 244, 246, 0.3);{% else %}color: var(--brand-gold-300); text-shadow: 0 0 12px rgba(253, 186, 116, 0.5);{% endif %}">
                    #{{ item.position }}
                </p>
            </div>
            
            <!-- Usu√°rio -->
            <div class="text-center mb-6 pb-4" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                <p class="text-lg font-black" style="color: var(--txt-primary);">@{{ item.user.username }}</p>
                <p class="text-sm font-semibold mt-1" style="color: var(--txt-tertiary);">{{ item.user.full_name or '-' }}</p>
            </div>
            
            <!-- Stats -->
            <div class="space-y-3 text-sm">
                <div class="flex justify-between items-center p-3 rounded-lg" style="background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1);">
                    <span class="font-semibold" style="color: var(--txt-secondary);">Pontos:</span>
                    <span class="font-black text-lg" style="color: var(--brand-gold-200);">{{ item.points }}</span>
                </div>
                <div class="flex justify-between items-center p-3 rounded-lg" style="background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1);">
                    <span class="font-semibold" style="color: var(--txt-secondary);">Receita:</span>
                    <span class="font-black text-lg" style="color: var(--brand-emerald-300);">R$ {{ "%.2f"|format(item.revenue) }}</span>
                </div>
                <div class="flex justify-between items-center p-3 rounded-lg" style="background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1);">
                    <span class="font-semibold" style="color: var(--txt-secondary);">Vendas:</span>
                    <span class="font-black text-lg" style="color: var(--txt-primary);">{{ item.sales }}</span>
                </div>
                {% if item.streak > 0 %}
                <div class="flex justify-between items-center p-3 rounded-lg" style="background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1);">
                    <span class="font-semibold" style="color: var(--txt-secondary);">Streak:</span>
                    <div class="flex items-center gap-1.5">
                        <i class="fas fa-fire" style="color: var(--brand-gold-400);"></i>
                        <span class="font-black text-lg" style="color: var(--brand-gold-300);">{{ item.streak }} dias</span>
                    </div>
                </div>
                {% endif %}
            </div>
            
            <!-- Badges -->
            {% if item.badges %}
            <div class="mt-6 pt-4 flex justify-center gap-2 flex-wrap" style="border-top: 1px solid rgba(255, 255, 255, 0.1);">
                {% for badge in item.badges %}
                <span class="text-2xl" title="{{ badge.name }}">{{ badge.icon }}</span>
                {% endfor %}
                {% if item.total_badges > 5 %}
                <span class="text-xs font-semibold" style="color: var(--txt-tertiary);">+{{ item.total_badges - 5 }}</span>
                {% endif %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    
    <!-- Resto do Ranking (4-100) -->
    <div class="card !p-0 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead style="background: var(--dark-800);">
                    <tr>
                        <th class="px-6 py-4 text-left text-xs font-bold uppercase" style="color: var(--txt-tertiary); letter-spacing: 0.05em;">#</th>
                        <th class="px-6 py-4 text-left text-xs font-bold uppercase" style="color: var(--txt-tertiary); letter-spacing: 0.05em;">Usu√°rio</th>
                        <th class="px-6 py-4 text-left text-xs font-bold uppercase" style="color: var(--txt-tertiary); letter-spacing: 0.05em;">Pontos</th>
                        <th class="px-6 py-4 text-left text-xs font-bold uppercase" style="color: var(--txt-tertiary); letter-spacing: 0.05em;">Receita</th>
                        <th class="px-6 py-4 text-left text-xs font-bold uppercase" style="color: var(--txt-tertiary); letter-spacing: 0.05em;">Vendas</th>
                        <th class="px-6 py-4 text-left text-xs font-bold uppercase" style="color: var(--txt-tertiary); letter-spacing: 0.05em;">Streak</th>
                        <th class="px-6 py-4 text-left text-xs font-bold uppercase" style="color: var(--txt-tertiary); letter-spacing: 0.05em;">Conquistas</th>
                    </tr>
                </thead>
                <tbody class="divide-y" style="border-color: rgba(255, 255, 255, 0.08);">
                    {% for item in ranking[3:] %}
                    <tr class="hover:bg-white hover:bg-opacity-5 transition {% if item.user.id == current_user.id %}border-l-4{% endif %}"
                        style="{% if item.user.id == current_user.id %}background: rgba(245, 158, 11, 0.12); border-left-color: var(--brand-gold-500);{% endif %}">
                        <td class="px-6 py-4">
                            <span class="text-lg font-black" style="{% if item.position <= 10 %}color: var(--brand-gold-200);{% else %}color: var(--txt-primary);{% endif %}">
                                #{{ item.position }}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <div>
                                <p class="text-sm font-black" style="color: var(--txt-primary);">
                                    @{{ item.user.username }}
                                    {% if item.user.id == current_user.id %}
                                    <span class="ml-2 px-2 py-1 text-xs font-black rounded" style="background: var(--brand-gold-500); color: var(--dark-900);">VOC√ä</span>
                                    {% endif %}
                                </p>
                                <p class="text-xs font-semibold mt-0.5" style="color: var(--txt-tertiary);">{{ item.bots_count }} bot(s)</p>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-sm font-black" style="color: var(--brand-gold-200);">{{ item.points }}</td>
                        <td class="px-6 py-4 text-sm font-black" style="color: var(--brand-emerald-300);">R$ {{ "%.2f"|format(item.revenue) }}</td>
                        <td class="px-6 py-4 text-sm font-black" style="color: var(--txt-primary);">{{ item.sales }}</td>
                        <td class="px-6 py-4">
                            {% if item.streak > 0 %}
                            <span class="inline-flex items-center gap-1.5 px-2.5 py-1 text-xs font-bold rounded" style="background: rgba(251, 146, 60, 0.2); border: 1px solid rgba(251, 146, 60, 0.3);">
                                <i class="fas fa-fire" style="color: var(--brand-gold-400);"></i>
                                <span style="color: var(--brand-gold-300);">{{ item.streak }}</span>
                            </span>
                            {% else %}
                            <span class="text-xs font-semibold" style="color: var(--txt-muted);">-</span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center gap-1">
                                {% for badge in item.badges %}
                                <span class="text-lg" title="{{ badge.name }}">{{ badge.icon }}</span>
                                {% endfor %}
                                {% if item.total_badges > 5 %}
                                <span class="text-xs font-semibold ml-1" style="color: var(--txt-tertiary);">+{{ item.total_badges - 5 }}</span>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Minhas Conquistas -->
    <div class="card !p-6 mt-8">
        <h3 class="text-lg font-black mb-6 flex items-center gap-2" style="color: var(--txt-primary);">
            <i class="fas fa-medal" style="color: var(--brand-gold-200); filter: drop-shadow(0 0 4px rgba(253, 230, 138, 0.5));"></i>
            Minhas Conquistas
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {% set my_achievements = current_user.achievements %}
            {% set all_achievements = [] %}
            
            {# Buscar todas as conquistas dispon√≠veis #}
            {% for item in ranking %}
                {% for badge in item.badges %}
                    {% if badge not in all_achievements %}
                        {% set _ = all_achievements.append(badge) %}
                    {% endif %}
                {% endfor %}
            {% endfor %}
            
            {# Aqui seria ideal buscar do banco, mas para MVP mostra as dos top users #}
            {% for ua in my_achievements %}
            <div class="p-4 border-2 rounded-lg text-center" style="background: rgba(245, 158, 11, 0.15); border-color: var(--brand-gold-500);">
                <div class="text-4xl mb-2">{{ ua.achievement.icon }}</div>
                <p class="font-black text-sm" style="color: var(--txt-primary);">{{ ua.achievement.name }}</p>
                <p class="text-xs font-semibold mt-1" style="color: var(--txt-secondary);">{{ ua.achievement.description }}</p>
                <p class="text-xs font-bold mt-2 px-2 py-1 rounded inline-block" style="color: var(--brand-gold-200); background: rgba(253, 230, 138, 0.15);">+{{ ua.achievement.points }} pts</p>
            </div>
            {% else %}
            <div class="col-span-full text-center py-12">
                <i class="fas fa-lock text-5xl mb-3" style="color: var(--txt-muted);"></i>
                <p class="font-bold text-lg" style="color: var(--txt-secondary);">Nenhuma conquista desbloqueada ainda</p>
                <p class="text-sm mt-2 font-semibold" style="color: var(--txt-tertiary);">Fa√ßa sua primeira venda para come√ßar!</p>
            </div>
            {% endfor %}
        </div>
    </div>
    
</div>
{% endblock %}

