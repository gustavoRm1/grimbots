{% extends "base.html" %}
{% block title %}Dashboard - grimbots{% endblock %}
{% block extra_head %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
{% endblock %}
{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" x-data="dashboardApp()" x-init="init()">
<!-- MODO SIMPLES -->
<div x-show="!showAdvanced" x-cloak>
<div class="mb-8">
<h1 class="text-4xl font-black" style="color: var(--text-primary);">Olá, {{ current_user.username }}! 👋</h1>
<p class="mt-2 text-lg font-medium" style="color: var(--text-secondary);">Aqui está um resumo rápido do seu negócio</p>
</div> {% if stats.total_bots == 0 %} <div class="mb-8 rounded-2xl p-8 shadow-2xl border" style="background: linear-gradient(135deg, var(--brand-gold-500) 0%, var(--brand-gold-700) 100%); border-color: var(--brand-gold-300);">
<div class="flex items-center justify-between flex-wrap gap-4">
<div>
<div class="text-5xl mb-4">🤖</div>
<h2 class="text-3xl font-black mb-2" style="color: #000000;">Crie seu primeiro bot de vendas!</h2>
<p class="text-lg font-semibold" style="color: rgba(0, 0, 0, 0.7);">Em menos de 5 minutos você estará vendendo</p>
</div>
<a href="/bot/create" class="btn-primary px-8 py-4 text-lg shadow-lg">
<i class="fas fa-plus mr-2"></i>Criar Meu Bot Agora </a>
</div>
</div> {% endif %} <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
<!-- Card Ganhos (DOURADO - Dinheiro) -->
<div class="stat-card-earnings rounded-2xl p-6 shadow-lg">
<div class="flex items-center justify-between mb-4">
<div class="text-5xl">💰</div>
<div class="badge-earnings">GANHOS</div>
</div>
<div class="currency-large mb-2">R$ {{ "%.2f"|format(stats.total_revenue) }}</div>
<div class="text-sm font-medium" style="color: var(--text-tertiary);">Você ganhou no total</div>
</div>
<!-- Card Vendas (VERDE - Sucesso) -->
<div class="stat-card-sales rounded-2xl p-6 shadow-lg">
<div class="flex items-center justify-between mb-4">
<div class="text-5xl">✅</div>
<div class="badge-online">VENDAS</div>
</div>
<div class="text-4xl font-black mb-2" style="color: var(--brand-green-300);">{{ stats.total_sales }}</div>
<div class="text-sm font-medium" style="color: var(--text-tertiary);">Vendas confirmadas</div>
</div>
<!-- Card Bots (AZUL - Info) -->
<div class="stat-card-info rounded-2xl p-6 shadow-lg">
<div class="flex items-center justify-between mb-4">
<div class="text-5xl">🤖</div>
<span class="px-3 py-1 rounded-full text-xs font-bold" style="background: rgba(59, 130, 246, 0.15); color: var(--brand-blue-300); border: 1px solid var(--brand-blue-500);">BOTS</span>
</div>
<div class="text-4xl font-black mb-2" style="color: var(--brand-blue-300);">{{ stats.running_bots }}</div>
<div class="text-sm font-medium" style="color: var(--text-tertiary);">Bots ativos <span style="color: var(--text-gray-400);">(de {{ stats.total_bots }})</span></div>
</div>
</div>
<div class="text-center mt-8">
<button @click="toggleDashboard()" class="btn-ghost inline-flex items-center gap-3">
<i class="fas fa-chart-line"></i>
<span>Ver Estatísticas Detalhadas</span>
<i class="fas fa-arrow-right"></i>
</button>
</div>
</div>
<!-- MODO AVANÇADO -->
<div x-show="showAdvanced" x-cloak>
<div class="mb-6">
<button @click="toggleDashboard()" class="btn-ghost inline-flex items-center gap-2 px-4 py-2">
<i class="fas fa-arrow-left"></i>
<span>Voltar para visão simples</span>
</button>
</div>
    <!-- Header com Filtros -->
    <div class="mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <div>
<h1 class="text-3xl font-black flex items-center gap-3" style="color: var(--text-primary);"> Estatísticas Completas <!-- Indicador de Atualização -->
<span x-show="isUpdating" class="inline-flex items-center gap-2 text-sm font-semibold" style="color: var(--brand-gold-500);">
                    <svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
</svg> Atualizando... </span>
                <!-- Status Online -->
<span x-show="!isUpdating" class="badge-online inline-flex items-center gap-2 text-sm animate-pulse-gold">
<span class="w-2 h-2 rounded-full" style="background: var(--status-online);"></span> Em tempo real </span>
            </h1>
<p class="mt-1 text-sm font-medium" style="color: var(--text-secondary);">Gerencie seus bots do Telegram</p>
    </div>
        <!-- Filtros -->
        <div class="flex gap-2">
<select x-model="filters.period" @change="loadChartData()" class="px-4 py-2 bg-gray-900 border border-white border-opacity-10 rounded-lg text-sm focus:outline-none" style="color: var(--text-primary);">
                <option value="7">Últimos 7 dias</option>
                <option value="30">Últimos 30 dias</option>
                <option value="90">Últimos 90 dias</option>
            </select>
<button @click="refreshStats()" :disabled="isUpdating" :class="{'opacity-50 cursor-not-allowed': isUpdating} inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-semibold text-gray-900 bg-gradient-to-r from-yellow-600 to-yellow-700 hover:shadow-xl transition-all">
<i class="fas fa-sync-alt mr-2" :class="{'fa-spin': isUpdating}"></i> Atualizar </button>
        </div>
    </div>
    <!-- Card de Ranking (Destaque) -->
<div class="card !p-0 mb-8 overflow-hidden border-2" style="border-color: var(--brand-gold-500); box-shadow: 0 0 30px rgba(245, 158, 11, 0.3), 0 8px 24px rgba(0, 0, 0, 0.4);">
<div class="px-6 py-5 flex justify-between items-center" style="background: linear-gradient(135deg, var(--brand-gold-500) 0%, var(--brand-gold-700) 100%);">
            <div class="flex items-center gap-4">
<i class="fas fa-trophy text-3xl" style="color: var(--brand-gold-900); filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));"></i>
                <div>
<h3 class="text-lg font-black" style="color: #000000; text-shadow: 0 1px 2px rgba(255, 255, 255, 0.2);">Sua Posição no Ranking</h3>
<p class="text-sm font-semibold" style="color: rgba(0, 0, 0, 0.8);">Compete com outros vendedores!</p>
                </div>
            </div>
<a href="/ranking" class="px-5 py-2.5 font-bold rounded-lg transition-all hover:scale-105" style="background: rgba(0, 0, 0, 0.25); color: var(--txt-primary); border: 1px solid rgba(0, 0, 0, 0.2); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);"> Ver Ranking Completo → </a>
        </div>
<div class="p-8" style="background: var(--surface-low);">
            <div class="grid grid-cols-3 gap-8">
                <div class="text-center">
<div class="mb-3" style="font-size: 3.5rem; font-weight: 900; color: var(--brand-gold-100); text-shadow: 0 2px 16px rgba(253, 230, 138, 0.5), 0 0 30px rgba(252, 211, 77, 0.4); line-height: 1;"> #{{ current_user.ranking_points }} </div>
<p class="text-sm font-semibold" style="color: var(--txt-secondary);">Pontos</p>
                </div>
                <div class="text-center">
<div class="mb-3 flex items-center justify-center gap-2" style="font-size: 3.5rem; font-weight: 900; line-height: 1;"> {% if current_user.current_streak > 0 %} <i class="fas fa-fire" style="color: var(--brand-gold-300); filter: drop-shadow(0 0 12px rgba(251, 146, 60, 0.8));"></i>
<span style="color: var(--brand-gold-300); text-shadow: 0 2px 16px rgba(253, 186, 116, 0.5);">{{ current_user.current_streak }}</span> {% else %} <i class="fas fa-moon" style="color: var(--txt-tertiary);"></i>
<span style="color: var(--txt-tertiary);">{{ current_user.current_streak }}</span> {% endif %} </div>
<p class="text-sm font-semibold" style="color: var(--txt-secondary);">Streak (dias)</p>
                </div>
                <div class="text-center">
<div class="mb-3" style="font-size: 3.5rem; font-weight: 900; color: var(--brand-blue-100); text-shadow: 0 2px 16px rgba(196, 181, 253, 0.5), 0 0 30px rgba(167, 139, 250, 0.4); line-height: 1;"> {{ current_user.achievements|length }} </div>
<p class="text-sm font-semibold" style="color: var(--txt-secondary);">Conquistas</p>
                    </div>
                </div>
            </div>
        </div>
    <!-- Stats Cards -->
    <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8">
        <div class="stat-card group">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-users text-3xl stat-icon group-hover:scale-110 transition-transform"></i>
                    </div>
                    <div class="ml-5">
                        <dl>
                            <dt class="stat-label">Total de Usuários</dt>
                            <dd class="stat-value" x-text="formatNumber(stats.total_users)">{{ stats.total_users }}</dd>
                            <dd class="text-xs text-gray-400 mt-1">Usuários únicos</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
        <div class="stat-card group">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
<i class="fas fa-shopping-cart text-3xl currency-value group-hover:scale-110 transition-transform"></i>
                    </div>
                    <div class="ml-5">
                        <dl>
                            <dt class="stat-label">Vendas Confirmadas</dt>
                            <dd class="stat-value" x-text="formatNumber(stats.total_sales)">{{ stats.total_sales }}</dd>
<dd class="text-xs text-gold-500 mt-1">
<span x-text="stats.pending_sales"></span> pendentes </dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
        <div class="stat-card group">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-dollar-sign text-3xl stat-icon group-hover:scale-110 transition-transform"></i>
                    </div>
                    <div class="ml-5">
                        <dl>
                            <dt class="stat-label">Receita Total</dt>
                            <dd class="stat-value" x-text="'R$ ' + formatMoney(stats.total_revenue)">R$ {{ "%.2f"|format(stats.total_revenue) }}</dd>
                            <dd class="text-xs text-gray-400 mt-1">Pagamentos confirmados</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
        <div class="stat-card group">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
<i class="fas fa-robot text-3xl group-hover:scale-110 transition-transform" style="color: var(--brand-gold-500);"></i>
                    </div>
                    <div class="ml-5">
                        <dl>
                            <dt class="stat-label">Bots Ativos</dt>
                            <dd class="stat-value" x-text="stats.running_bots">{{ stats.running_bots }}</dd>
<dd class="text-xs text-gray-400 mt-1"> de <span x-text="stats.total_bots"></span> total </dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Analytics e Métricas -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <!-- Gráfico de Vendas -->
        <div class="lg:col-span-2 card !p-6">
            <div class="flex justify-between items-center mb-6">
                <div>
<h3 class="text-lg font-semibold" style="color: var(--text-primary);">Vendas e Receita</h3>
<p class="text-sm" style="color: var(--text-secondary);">Últimos 7 dias</p>
                </div>
                <div class="flex gap-4 text-sm">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded" style="background: var(--brand-blue-500);"></div>
<span style="color: var(--text-secondary);">Vendas</span>
                    </div>
                    <div class="flex items-center gap-2">
<div class="w-3 h-3 rounded" style="background: var(--brand-gold-500);"></div>
<span style="color: var(--text-secondary);">Receita</span>
                    </div>
                </div>
            </div>
            <div class="relative" style="height: 300px;">
                <canvas id="salesChart"></canvas>
            </div>
        </div>
        <!-- Métricas Chave -->
        <div class="card !p-6">
<h3 class="text-lg font-semibold mb-6" style="color: var(--text-primary);">Métricas Chave</h3>
            <!-- Taxa de Conversão -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
<span class="text-sm" style="color: var(--text-secondary);">Taxa de Conversão</span>
<span class="text-lg font-bold" style="color: var(--brand-gold-500);" x-text="analytics.conversion_rate + '%'">0%</span>
                </div>
                <div class="w-full bg-gray-900 rounded-full h-2">
                    <div class="bg-yellow-600 h-2 rounded-full transition-all" :style="`width: ${analytics.conversion_rate}%`"></div>
                </div>
                <p class="text-xs text-gray-400 mt-1">Usuários que compraram</p>
            </div>
            <!-- Ticket Médio -->
            <div class="mb-6 pb-6 border-b border-white border-opacity-10">
                <div class="flex justify-between items-center mb-2">
<span class="text-sm" style="color: var(--text-secondary);">Ticket Médio</span>
<span class="text-lg font-bold" style="color: var(--brand-green-300);">R$ <span x-text="formatMoney(analytics.avg_ticket)">0</span></span>
                </div>
                <p class="text-xs text-gray-400">Valor médio por venda</p>
            </div>
            <!-- Total Vendas Hoje -->
            <div>
                <div class="flex justify-between items-center mb-2">
<span class="text-sm" style="color: var(--text-secondary);">Vendas Hoje</span>
<span class="text-lg font-bold" style="color: var(--brand-gold-500);" x-text="analytics.today_sales || 0">0</span>
                </div>
                <p class="text-xs text-gray-400">Total de vendas de hoje</p>
            </div>
        </div>
    </div>
    <!-- Performance de Upsells -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Order Bumps -->
        <div class="card !p-6">
<h3 class="text-lg font-semibold mb-6" style="color: var(--text-primary);">Performance de Order Bumps</h3>
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="text-center p-4 bg-gray-900 rounded-lg">
<p class="text-2xl font-bold" style="color: var(--brand-gold-500);" x-text="analytics.order_bump_stats.shown || 0">0</p>
<p class="text-xs mt-1" style="color: var(--text-secondary);">Exibidos</p>
                </div>
                <div class="text-center p-4 bg-gray-900 rounded-lg">
<p class="text-2xl font-bold currency-value" x-text="analytics.order_bump_stats.accepted || 0">0</p>
<p class="text-xs mt-1" style="color: var(--text-secondary);">Aceitos</p>
                </div>
            </div>
            <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
<span class="text-sm" style="color: var(--text-secondary);">Taxa de Aceitação</span>
<span class="text-xl font-bold" style="color: var(--brand-gold-500);" x-text="(analytics.order_bump_stats.acceptance_rate || 0) + '%'">0%</span>
                </div>
                <div class="w-full bg-gray-900 rounded-full h-3">
<div class="bg-gradient-to-r from-yellow-600 to-yellow-700 h-3 rounded-full transition-all" :style="`width: ${analytics.order_bump_stats.acceptance_rate || 0}%`"></div>
                </div>
            </div>
            <div class="border-t border-white border-opacity-10 pt-4">
                <div class="flex justify-between items-center">
<span class="text-sm" style="color: var(--text-secondary);">Receita de Order Bumps</span>
<span class="text-lg font-bold" style="color: var(--brand-green-300);">R$ <span x-text="formatMoney(analytics.order_bump_stats.total_revenue || 0)">0</span></span>
                </div>
            </div>
        </div>
        <!-- Downsells -->
        <div class="card !p-6">
<h3 class="text-lg font-semibold mb-6" style="color: var(--text-primary);">Performance de Downsells</h3>
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="text-center p-4 bg-gray-900 rounded-lg">
<p class="text-2xl font-bold text-trust-300" x-text="analytics.downsell_stats.sent || 0">0</p>
<p class="text-xs mt-1" style="color: var(--text-secondary);">Enviados</p>
                </div>
                <div class="text-center p-4 bg-gray-900 rounded-lg">
<p class="text-2xl font-bold currency-value" x-text="analytics.downsell_stats.converted || 0">0</p>
<p class="text-xs mt-1" style="color: var(--text-secondary);">Convertidos</p>
                </div>
            </div>
            <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
<span class="text-sm" style="color: var(--text-secondary);">Taxa de Conversão</span>
<span class="text-xl font-bold text-trust-300" x-text="(analytics.downsell_stats.conversion_rate || 0) + '%'">0%</span>
                </div>
                <div class="w-full bg-gray-900 rounded-full h-3">
<div class="bg-gradient-to-r from-blue-400 to-blue-600 h-3 rounded-full transition-all" :style="`width: ${analytics.downsell_stats.conversion_rate || 0}%`"></div>
                </div>
            </div>
            <div class="border-t border-white border-opacity-10 pt-4">
                <div class="flex justify-between items-center">
<span class="text-sm" style="color: var(--text-secondary);">Receita de Downsells</span>
<span class="text-lg font-bold" style="color: var(--brand-green-300);">R$ <span x-text="formatMoney(analytics.downsell_stats.total_revenue || 0)">0</span></span>
                </div>
            </div>
        </div>
    </div>
    <!-- Horários de Pico -->
    <div class="card !p-6 mb-8">
        <div class="flex justify-between items-center mb-6">
            <div>
<h3 class="text-lg font-semibold" style="color: var(--text-primary);">Horários de Pico de Vendas</h3>
<p class="text-sm" style="color: var(--text-secondary);">Top 5 horários com mais conversões</p>
            </div>
        </div>
        <template x-if="analytics.peak_hours.length > 0">
            <div class="grid grid-cols-5 gap-4">
                <template x-for="(peak, index) in analytics.peak_hours" :key="index">
                    <div class="relative text-center p-4 bg-gray-900 rounded-lg hover:bg-opacity-80 transition-all group">
                        <!-- Badge de posição -->
                        <div class="absolute -top-2 -right-2 w-6 h-6 rounded-full bg-yellow-600 text-white text-xs font-bold flex items-center justify-center">
                            <span x-text="index + 1"></span>
                        </div>
<p class="text-2xl font-bold" style="color: var(--brand-gold-500);" x-text="peak.hour">00:00</p>
<p class="text-sm mt-2" style="color: var(--text-secondary);" x-text="peak.sales">0</p>
                        <p class="text-xs text-gray-400">vendas</p>
                    </div>
                </template>
            </div>
        </template>
        <template x-if="analytics.peak_hours.length === 0">
<div class="text-center py-8" style="color: var(--text-secondary);">
                <i class="fas fa-clock text-4xl opacity-30 mb-3"></i>
                <p class="text-sm">Nenhuma venda confirmada ainda</p>
            </div>
        </template>
    </div>
    <!-- Filtros de Bots e Vendas -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
        <div>
<label class="block text-sm font-medium mb-2" style="color: var(--text-secondary);">Buscar Bot</label>
<input type="text" x-model="filters.botSearch" @input="filterBots()" placeholder="Nome do bot..." class="w-full px-4 py-2 bg-gray-900 border border-white border-opacity-10 rounded-lg placeholder-gray-500 focus:outline-none" style="color: var(--text-primary);">
        </div>
        <div>
<label class="block text-sm font-medium mb-2" style="color: var(--text-secondary);">Status do Bot</label>
<select x-model="filters.botStatus" @change="filterBots()" class="w-full px-4 py-2 bg-gray-900 border border-white border-opacity-10 rounded-lg focus:outline-none" style="color: var(--text-primary);">
                <option value="all">Todos</option>
                <option value="online">Online</option>
                <option value="offline">Offline</option>
            </select>
        </div>
        <div>
<label class="block text-sm font-medium mb-2" style="color: var(--text-secondary);">Status de Vendas</label>
<select x-model="filters.saleStatus" @change="filterSales()" class="w-full px-4 py-2 bg-gray-900 border border-white border-opacity-10 rounded-lg focus:outline-none" style="color: var(--text-primary);">
                <option value="all">Todas</option>
                <option value="paid">Pagas</option>
                <option value="pending">Pendentes</option>
            </select>
        </div>
    </div>
    <!-- Bots Section -->
    <div class="card !p-0 border border-white border-opacity-10 mb-8">
        <div class="px-6 py-5 border-b border-white border-opacity-5 flex justify-between items-center">
            <div>
<h3 class="text-lg leading-6 font-semibold" style="color: var(--text-primary);">Meus Bots</h3>
<p class="mt-1 text-sm" style="color: var(--text-secondary);">
<span x-text="filteredBots.length"></span> bot(s) encontrado(s)</p>
            </div>
<button @click="showAddBotModal = true" :disabled="!{{ 'true' if stats.can_add_bot else 'false' }}" class="inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-semibold text-gray-900 bg-gradient-to-r from-yellow-600 to-yellow-700 hover:shadow-xl transition-all">
<i class="fas fa-plus mr-2"></i> Adicionar Bot </button>
        </div>
        <div class="px-4 py-5 sm:p-6">
            <template x-if="filteredBots.length > 0">
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
                    <template x-for="bot in filteredBots" :key="bot.id">
                        <div class="border border-white border-opacity-10 rounded-lg p-4 hover:border-opacity-20 hover:shadow-xl transition-all bg-gray-800 bg-opacity-50">
                    <div class="flex items-start justify-between">
                        <div class="flex items-center">
<i class="fas fa-robot text-2xl" style="color: var(--brand-gold-500);"></i>
                            <div class="ml-3">
<h4 class="text-sm font-medium" style="color: var(--text-primary);" x-text="bot.name"></h4>
<p class="text-xs" style="color: var(--text-secondary);">@<span x-text="bot.username"></span></p>
                            </div>
                        </div>
<span class="badge" :class="bot.is_running ? 'badge-online' : 'bg-gray-800 bg-opacity-50 text-gray-400 border-white border-opacity-10'">
<span class="w-2 h-2 mr-1 rounded-full animate-pulse" :style="bot.is_running ? 'background: var(--brand-green-300);' : 'background: var(--surface-mid);'"></span>
                                    <span x-text="bot.is_running ? 'Online' : 'Offline'"></span>
                        </span>
                    </div>
                    <div class="mt-4 grid grid-cols-3 gap-2 text-center">
                        <div>
<p class="text-xs" style="color: var(--text-secondary);">Usuários</p>
<p class="text-sm font-semibold" style="color: var(--text-primary)" x-text="bot.total_users"></p>
                        </div>
                        <div>
<p class="text-xs" style="color: var(--text-secondary);">Vendas</p>
<p class="text-sm font-semibold" style="color: var(--text-primary)" x-text="bot.total_sales"></p>
                        </div>
                        <div>
<p class="text-xs" style="color: var(--text-secondary);">Receita</p>
<p class="text-sm font-semibold" style="color: var(--brand-gold-500)">R$ <span x-text="formatMoney(bot.total_revenue)"></span></p>
                        </div>
                    </div>
                            <div class="mt-4 space-y-2">
                                <!-- Linha 1: Estatísticas (destaque) -->
                                <div>
<a :href="`/bots/${bot.id}/stats`" class="w-full inline-flex justify-center items-center px-4 py-2.5 border-2 text-sm font-bold rounded-lg text-gray-900 bg-gradient-to-r from-yellow-600 to-yellow-700 hover:shadow-xl transition-all transform hover:-translate-y-0.5" style="border-color: var(--brand-gold-500);">
<i class="fas fa-chart-line mr-2"></i> Ver Estatísticas Detalhadas </a>
                                </div>
                                <!-- Linha 2: Configurar, Trocar Token e Remarketing -->
                                <div class="flex space-x-2">
<a :href="`/bots/${bot.id}/config`" class="flex-1 inline-flex justify-center items-center px-3 py-2 border border-white border-opacity-20 text-xs font-medium rounded-lg bg-transparent hover:bg-white hover:bg-opacity-5 hover:text-txt-primary transition-all" style="color: var(--text-secondary);">
<i class="fas fa-cog mr-1"></i> Configurar </a>
<button @click="openChangeTokenModal(bot)" class="inline-flex items-center px-3 py-2 border border-brand-gold border-opacity-30 text-xs font-medium rounded-lg text-gold-500 bg-transparent hover:btn-primary hover:bg-opacity-10 transition-all" title="Trocar Token (bot banido/problema)">
                                        <i class="fas fa-key"></i>
                                    </button>
<a :href="`/bots/${bot.id}/remarketing`" class="flex-1 inline-flex justify-center items-center px-3 py-2 border border-transparent text-xs font-semibold rounded-lg text-white bg-gradient-to-r from-info-500 to-blue-600 hover:shadow-lg transition-all transform hover:-translate-y-0.5" style="box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);">
<i class="fas fa-bullhorn mr-1"></i> Remarketing </a>
                                </div>
                                <!-- Linha 3: Iniciar/Parar, Duplicar e Deletar -->
                                <div class="flex space-x-2">
                                    <template x-if="bot.is_running">
<button @click="stopBot(bot.id)" class="flex-1 inline-flex justify-center items-center px-3 py-2 border border-transparent text-xs font-medium rounded-lg text-white transition-all" style="background: var(--brand-red-700);" onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
<i class="fas fa-stop mr-1"></i> Parar </button>
                                    </template>
                                    <template x-if="!bot.is_running">
<button @click="startBot(bot.id)" class="flex-1 inline-flex justify-center items-center px-3 py-2 border border-transparent text-xs font-medium rounded-lg text-white transition-all" style="background: var(--brand-green-700);" onmouseover="this.style.background='var(--brand-green-900)'" onmouseout="this.style.background='var(--brand-green-700)'">
<i class="fas fa-play mr-1"></i> Iniciar </button>
                                    </template>
<button @click="openDuplicateBotModal(bot)" class="flex-1 inline-flex justify-center items-center px-3 py-2 border text-xs font-semibold rounded-lg transition-all hover:bg-yellow-500 hover:bg-opacity-10" style="border-color: var(--brand-gold-500); color: var(--brand-gold-500);">
                                        <i class="fas fa-clone mr-1"></i>
                                        Duplicar
                                    </button>
<button @click="deleteBot(bot.id, bot.name)" class="inline-flex items-center px-3 py-2 border text-xs font-medium rounded-lg hover:bg-opacity-10 transition-all" style="border-color: var(--brand-red-500); color: var(--brand-red-500);">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
                    </template>
            </div>
            </template>
            <template x-if="filteredBots.length === 0">
            <div class="text-center py-12">
                    <i class="fas fa-robot text-6xl text-gray-400 opacity-30"></i>
<h3 class="mt-2 text-sm font-medium" style="color: var(--text-primary);">Nenhum bot encontrado</h3>
<p class="mt-1 text-sm" style="color: var(--text-secondary);">Tente ajustar os filtros ou adicione um novo bot.</p>
                </div>
            </template>
        </div>
    </div>
    <!-- Recent Payments -->
    <div class="card !p-0 border border-white border-opacity-10">
        <div class="px-6 py-5 border-b border-white border-opacity-5 flex justify-between items-center">
            <div>
<h3 class="text-lg leading-6 font-semibold" style="color: var(--text-primary);">Últimas Vendas</h3>
<p class="text-sm" style="color: var(--text-secondary);">
<span x-text="filteredPayments.length"></span> venda(s) encontrada(s) </p>
            </div>
<button @click="exportSales()" class="inline-flex items-center px-3 py-2 border border-white border-opacity-20 text-sm font-medium rounded-lg hover:bg-white hover:bg-opacity-5 transition-all" style="color: var(--text-secondary);">
<i class="fas fa-download mr-2"></i> Exportar CSV </button>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full !bg-transparent">
                <thead>
<tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
<th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider" style="color: var(--brand-gold-500);">ID</th>
<th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider" style="color: var(--brand-gold-500);">Cliente</th>
<th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider" style="color: var(--brand-gold-500);">Produto</th>
<th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider" style="color: var(--brand-gold-500);">Valor</th>
<th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider" style="color: var(--brand-gold-500);">Status</th>
<th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider" style="color: var(--brand-gold-500);">Data</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="payment in filteredPayments" :key="payment.id">
<tr class="border-b border-white border-opacity-5 hover:bg-white hover:bg-opacity-5 transition-colors">
<td class="px-6 py-4 whitespace-nowrap text-sm font-bold" style="color: var(--text-primary);"> #<span x-text="payment.id"></span>
                        </td>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium" style="color: var(--text-secondary);" x-text="payment.customer_name || 'N/A'"></td>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium" style="color: var(--text-secondary);" x-text="payment.product_name || 'Produto'"></td>
<td class="px-6 py-4 whitespace-nowrap text-sm font-bold" style="color: var(--brand-gold-300);"> R$ <span x-text="formatMoney(payment.amount)"></span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
<span class="px-3 py-1 rounded-full text-xs font-bold border" :style="payment.status === 'paid' ? 'background: rgba(16, 185, 129, 0.15); border-color: var(--brand-green-500); color: var(--brand-green-100);' : (payment.status === 'pending' ? 'background: rgba(245, 158, 11, 0.15); border-color: var(--brand-gold-500); color: var(--brand-gold-300);' : 'background: rgba(239, 68, 68, 0.15); border-color: var(--brand-red-500); color: var(--brand-red-100);')">
                                    <span x-text="payment.status === 'paid' ? 'Pago' : (payment.status === 'pending' ? 'Pendente' : 'Cancelado')"></span>
                            </span>
                        </td>
<td class="px-6 py-4 whitespace-nowrap text-sm font-medium" style="color: var(--text-secondary);" x-text="formatDate(payment.created_at)"></td>
                    </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </div>
    <!-- Add Bot Modal - Redesign Profissional -->
<div x-show="showAddBotModal" x-cloak class="fixed z-50 inset-0 overflow-y-auto" @keydown.escape.window="showAddBotModal = false">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:p-0">
            <!-- Backdrop -->
<div x-show="showAddBotModal" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" class="fixed inset-0 bg-black bg-opacity-90 backdrop-blur-sm transition-opacity" @click="showAddBotModal = false"></div>
            <!-- Modal Content -->
<div x-show="showAddBotModal" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100" x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" class="relative inline-block align-middle bg-gray-700 rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:max-w-lg sm:w-full" style="box-shadow: 0 20px 60px rgba(0,0,0,0.8), 0 0 0 1px rgba(255,186,8,0.15);">
                <!-- Header com Ícone -->
                <div class="bg-gradient-to-b from-surface700 to-surface600 px-8 pt-8 pb-6 border-b border-white border-opacity-8">
                    <div class="flex items-start">
                        <!-- Ícone com Glow -->
                        <div class="flex-shrink-0">
                            <div class="relative">
                                <div class="absolute -inset-2 bg-yellow-600 rounded-full opacity-20 blur-xl"></div>
<div class="relative flex items-center justify-center h-14 w-14 rounded-2xl bg-gray-800 border border-opacity-25" style="border-color: var(--brand-gold-500);">
<i class="fas fa-plus-circle text-3xl" style="color: var(--brand-gold-500); filter: drop-shadow(0 2px 8px rgba(255,186,8,0.4));" ></i>
                    </div>
                            </div>
                    </div>
                        <!-- Título e Descrição -->
                        <div class="ml-5 flex-1">
<h3 class="text-2xl font-bold" style="color: var(--text-primary);"> Adicionar Bot </h3>
<p class="mt-2 text-sm leading-relaxed" style="color: var(--text-secondary);"> Configure um novo bot do Telegram para começar a vender </p>
                        </div>
                        <!-- Botão Fechar -->
<button @click="showAddBotModal = false" class="ml-3 text-gray-400 hover:text-txt-primary transition-colors focus:outline-none">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                <!-- Info Helper -->
                <div class="px-8 pt-6 pb-4">
<div class="bg-yellow-600 bg-opacity-8 border border-opacity-20 rounded-xl p-4" style="border-color: var(--brand-gold-500);">
                        <div class="flex">
                            <div class="flex-shrink-0">
<i class="fas fa-lightbulb text-lg" style="color: var(--brand-gold-500);"></i>
                            </div>
                            <div class="ml-3">
<h4 class="text-sm font-semibold" style="color: var(--brand-gold-500)">Como obter o token?</h4>
<p class="mt-1 text-xs leading-relaxed" style="color: var(--text-secondary);"> 1. Abra o <strong class="text-yellow-400">@BotFather</strong> no Telegram<br> 2. Envie <code class="px-1.5 py-0.5 bg-gray-900 rounded text-yellow-400">/newbot</code> ou use um bot existente<br> 3. Copie o token fornecido </p>
                        </div>
                    </div>
                </div>
                </div>
                <!-- Form -->
                <form @submit.prevent="addBot()" class="px-8 pb-8 space-y-5">
                    <!-- Token Field -->
                    <div class="space-y-2">
<label for="bot_token" class="block text-sm font-semibold" style="color: var(--text-secondary);"> Token do Bot <span style="color: var(--brand-red-500);">*</span>
                        </label>
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
<i class="fas fa-key text-gray-400 group-hover:text-txt-secondary transition-colors"></i>
                            </div>
<input id="bot_token" type="text" x-model="newBotToken" required class="appearance-none block w-full pl-11 pr-4 py-3.5 bg-gray-900 border border-white border-opacity-10 rounded-xl placeholder-gray-500 focus:outline-none" style="color: var(--text-primary); border-color: var(--brand-gold-500);" focus:ring-2 focus:ring-yellow-600 focus:ring-opacity-20 hover:border-opacity-15 sm:text-sm transition-all font-mono" placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz">
                    </div>
<p class="text-xs text-gray-400 ml-1"> Formato: número:letras_e_numeros </p>
                    </div>
                    <!-- Nome Field -->
                    <div class="space-y-2">
<label for="bot_name" class="block text-sm font-semibold" style="color: var(--text-secondary);"> Nome do Bot <span class="text-gray-400 font-normal ml-1">(opcional)</span>
                        </label>
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
<i class="fas fa-robot text-gray-400 group-hover:text-txt-secondary transition-colors"></i>
                            </div>
<input id="bot_name" type="text" x-model="newBotName" class="appearance-none block w-full pl-11 pr-4 py-3.5 bg-gray-900 border border-white border-opacity-10 rounded-xl placeholder-gray-500 focus:outline-none" style="color: var(--text-primary); border-color: var(--brand-gold-500);" focus:ring-2 focus:ring-yellow-600 focus:ring-opacity-20 hover:border-opacity-15 sm:text-sm transition-all" placeholder="Ex: Bot de Vendas FGTS">
                    </div>
<p class="text-xs text-gray-400 ml-1"> Se deixar vazio, usaremos o nome configurado no @BotFather </p>
                    </div>
                    <!-- Action Buttons -->
                    <div class="pt-4 grid grid-cols-2 gap-3">
                        <!-- Cancelar (col 1) -->
<button type="button" @click="showAddBotModal = false" class="w-full inline-flex justify-center items-center py-3.5 px-4 border-2 border-white border-opacity-10 rounded-xl text-sm font-semibold bg-transparent hover:bg-white hover:bg-opacity-8 hover:style=" style="color: var(--text-secondary);"color: var(--text-primary);" hover:border-opacity-20 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-surface600 focus:ring-yellow-600 transition-all">
<i class="fas fa-times mr-2"></i> Cancelar </button>
                        <!-- Adicionar (col 2) -->
<button type="submit" :disabled="loading" :class="{ 'opacity-60 cursor-not-allowed': loading } group relative w-full inline-flex justify-center items-center py-3.5 px-4 border border-transparent rounded-xl text-sm font-bold text-gray-900 bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-500 hover:to-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-surface600 focus:ring-yellow-600 transition-all transform hover:-translate-y-0.5 active:translate-y-0 disabled:transform-none" style="box-shadow: 0 8px 24px rgba(255,186,8,0.25);">
                            <span x-show="!loading" class="flex items-center">
<i class="fas fa-plus mr-2"></i> Adicionar Bot </span>
                            <span x-show="loading" class="flex items-center">
<i class="fas fa-spinner fa-spin mr-2"></i> Validando... </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Modal: Duplicar Bot -->
<div x-show="showDuplicateBotModal" x-cloak class="fixed z-50 inset-0 overflow-y-auto" @keydown.escape.window="showDuplicateBotModal = false">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:p-0">
            <!-- Backdrop -->
<div x-show="showDuplicateBotModal" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" class="fixed inset-0 bg-black bg-opacity-90 backdrop-blur-sm transition-opacity" @click="showDuplicateBotModal = false"></div>
            <!-- Modal Content -->
<div x-show="showDuplicateBotModal" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100" x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" class="relative inline-block align-middle bg-gray-700 rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:max-w-2xl sm:w-full" style="box-shadow: 0 20px 60px rgba(0,0,0,0.8), 0 0 0 1px rgba(255,186,8,0.15);">
                <!-- Header -->
                <div class="bg-gradient-to-b from-surface700 to-surface600 px-8 pt-8 pb-6 border-b border-white border-opacity-5">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <div class="relative">
                                <div class="absolute -inset-2 bg-yellow-600 rounded-full opacity-20 blur-xl"></div>
<div class="relative flex items-center justify-center h-14 w-14 rounded-2xl bg-gray-800 border border-opacity-25" style="border-color: var(--brand-gold-500);">
<i class="fas fa-clone text-3xl" style="color: var(--brand-gold-500); filter: drop-shadow(0 2px 8px rgba(255,186,8,0.4));" ></i>
                                </div>
                            </div>
                        </div>
                        <div class="ml-5 flex-1">
<h3 class="text-2xl font-bold" style="color: var(--text-primary);"> Duplicar Bot (Contingência) </h3>
<p class="mt-2 text-sm leading-relaxed" style="color: var(--text-secondary);"> Crie uma cópia de <strong class="style="color: var(--brand-gold-500)" x-text="botToDuplicate?.name"></strong> com todas as configurações </p>
                        </div>
<button @click="showDuplicateBotModal = false" class="ml-3 text-gray-400 hover:text-txt-primary transition-colors focus:outline-none">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                <!-- Info Warning -->
                <div class="px-8 pt-6 pb-4">
<div class="btn-primary bg-opacity-10 border border-brand-gold border-opacity-30 rounded-xl p-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
<i class="fas fa-exclamation-triangle text-gold-500 text-lg"></i>
                            </div>
                            <div class="ml-3">
<h4 class="text-sm font-semibold text-gold-500">Token diferente obrigatório!</h4>
<p class="mt-1 text-xs leading-relaxed" style="color: var(--text-secondary);"> Você <strong>DEVE</strong> usar um token diferente do bot original para evitar conflitos.<br> Crie um novo bot no <strong class="text-yellow-400">@BotFather</strong> e cole o token abaixo. </p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Preview do que será copiado -->
                <div class="px-8 pb-4">
                    <div class="bg-gray-800 bg-opacity-50 border border-white border-opacity-10 rounded-xl p-5">
<h4 class="text-sm font-semibold mb-3 flex items-center" style="color: var(--text-primary);">
<i class="fas fa-list-check mr-2" style="color: var(--brand-gold-500);"></i> O que será duplicado: </h4>
                        <div class="grid grid-cols-2 gap-3 text-xs">
<div class="flex items-center" style="color: var(--text-secondary);">
<i class="fas fa-check-circle currency-value mr-2"></i>
                                <span>Mensagem de boas-vindas</span>
                            </div>
<div class="flex items-center" style="color: var(--text-secondary);">
<i class="fas fa-check-circle currency-value mr-2"></i>
                                <span>Mídia (vídeo/foto)</span>
                            </div>
<div class="flex items-center" style="color: var(--text-secondary);">
<i class="fas fa-check-circle currency-value mr-2"></i>
                                <span>Botões de produtos</span>
                            </div>
<div class="flex items-center" style="color: var(--text-secondary);">
<i class="fas fa-check-circle currency-value mr-2"></i>
                                <span>Order Bumps configurados</span>
                            </div>
<div class="flex items-center" style="color: var(--text-secondary);">
<i class="fas fa-check-circle currency-value mr-2"></i>
                                <span>Downsells automáticos</span>
                            </div>
<div class="flex items-center" style="color: var(--text-secondary);">
<i class="fas fa-check-circle currency-value mr-2"></i>
                                <span>Link de acesso</span>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-white border-opacity-5 text-xs text-gray-400">
                            <i class="fas fa-info-circle mr-1"></i>
<strong>Nota:</strong> O bot duplicado NÃO será iniciado automaticamente. Configure e teste antes de colocar online. </div>
                        </div>
                    </div>
                <!-- Form -->
                <form @submit.prevent="duplicateBot()" class="px-8 pb-8 space-y-5">
                    <!-- Token Field (OBRIGATÓRIO) -->
                    <div class="space-y-2">
<label for="duplicateBotToken" class="block text-sm font-semibold" style="color: var(--text-primary);"> Token do Novo Bot <span style="color: var(--brand-red-500);">*</span>
                        </label>
                        <div class="relative">
<input type="text" id="duplicateBotToken" x-model="duplicateBotToken" required placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz" class="w-full px-4 py-3.5 pl-11 bg-gray-900 border-2 border-white border-opacity-10 rounded-xl placeholder-gray-500 focus:outline-none" style="color: var(--text-primary); border-color: var(--brand-gold-500);" focus:bg-gray-800 transition-all text-sm" style="font-family: 'Courier New', monospace;">
                            <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
<i class="fas fa-key opacity-60" style="color: var(--brand-gold-500);"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-1">
<i class="fas fa-info-circle mr-1"></i> Crie um novo bot no @BotFather antes de duplicar </p>
                    </div>
                    <!-- Nome Field (OPCIONAL) -->
                    <div class="space-y-2">
<label for="duplicateBotName" class="block text-sm font-semibold" style="color: var(--text-primary);"> Nome do Bot <span class="text-gray-400 text-xs">(opcional)</span>
                        </label>
                        <div class="relative">
<input type="text" id="duplicateBotName" x-model="duplicateBotName" :placeholder="`${botToDuplicate?.name || ''} (Cópia)`" class="w-full px-4 py-3.5 pl-11 bg-gray-900 border-2 border-white border-opacity-10 rounded-xl placeholder-gray-500 focus:outline-none" style="color: var(--text-primary); border-color: var(--brand-gold-500);" focus:bg-gray-800 transition-all text-sm">
                            <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
<i class="fas fa-robot opacity-60" style="color: var(--brand-gold-500);"></i>
                            </div>
                        </div>
<p class="text-xs text-gray-400 mt-1"> Se vazio, será gerado automaticamente: "<span x-text="botToDuplicate?.name"></span> (Cópia)" </p>
                    </div>
                    <!-- Botões -->
                    <div class="grid grid-cols-2 gap-4 pt-4">
<button type="button" @click="showDuplicateBotModal = false" class="w-full inline-flex justify-center items-center py-3.5 px-4 border-2 border-white border-opacity-10 rounded-xl text-sm font-semibold bg-transparent hover:bg-white hover:bg-opacity-5 hover:style=" style="color: var(--text-secondary);"color: var(--text-primary);" hover:border-opacity-20 focus:outline-none transition-all">
<i class="fas fa-times mr-2"></i> Cancelar </button>
<button type="submit" :disabled="loading || !duplicateBotToken" :class="{ 'opacity-60 cursor-not-allowed': loading || !duplicateBotToken } w-full inline-flex justify-center items-center py-3.5 px-4 border border-transparent rounded-xl text-sm font-bold text-gray-900 bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-500 hover:to-yellow-600 focus:outline-none transition-all transform hover:-translate-y-0.5 active:translate-y-0 disabled:transform-none" style="box-shadow: 0 8px 24px rgba(255,186,8,0.25);">
                            <span x-show="!loading" class="flex items-center">
<i class="fas fa-clone mr-2"></i> Duplicar Bot </span>
                            <span x-show="loading" class="flex items-center">
<i class="fas fa-spinner fa-spin mr-2"></i> Duplicando... </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Modal: Trocar Token do Bot -->
<div x-show="showChangeTokenModal" x-cloak class="fixed z-50 inset-0 overflow-y-auto" @keydown.escape.window="showChangeTokenModal = false">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:p-0">
            <!-- Backdrop -->
<div x-show="showChangeTokenModal" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" class="fixed inset-0 bg-black bg-opacity-90 backdrop-blur-sm transition-opacity" @click="showChangeTokenModal = false"></div>
            <!-- Modal Content -->
<div x-show="showChangeTokenModal" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100" x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" class="relative inline-block align-middle rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:max-w-lg sm:w-full" style="background: var(--surface-low); box-shadow: 0 20px 60px rgba(0,0,0,0.9), 0 0 0 2px rgba(245, 158, 11, 0.2), 0 0 40px rgba(245, 158, 11, 0.1);">
                <!-- Header -->
<div class="px-8 pt-8 pb-6 border-b" style="background: linear-gradient(180deg, var(--surface-mid), var(--surface-low)); border-bottom-color: rgba(255, 255, 255, 0.1);">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <div class="relative">
<div class="absolute -inset-2 rounded-full blur-xl" style="background: var(--brand-gold-500); opacity: 0.25;"></div>
<div class="relative flex items-center justify-center h-14 w-14 rounded-2xl border-2" style="background: var(--surface-low); border-color: var(--brand-gold-500);">
<i class="fas fa-key text-3xl" style="color: var(--brand-gold-300); filter: drop-shadow(0 2px 8px rgba(252, 211, 77, 0.6));"></i>
                                </div>
                            </div>
                        </div>
                        <div class="ml-5 flex-1">
<h3 class="text-2xl font-black" style="color: var(--txt-primary);"> Trocar Token do Bot </h3>
<p class="mt-2 text-sm font-semibold leading-relaxed" style="color: var(--txt-secondary);"> Atualize o token de <strong style="color: var(--brand-gold-100); font-weight: 900;" x-text="botToChangeToken?.name"></strong> sem perder suas configurações </p>
                        </div>
<button @click="showChangeTokenModal = false" class="ml-3 transition-colors focus:outline-none hover:scale-110" style="color: var(--txt-tertiary);">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                <!-- Alert Crítico -->
                <div class="px-8 pt-6 pb-4">
<div class="rounded-xl p-5 mb-4 border-2" style="background: rgba(239, 68, 68, 0.12); border-color: var(--brand-red-500);">
                        <div class="flex gap-3">
                            <div class="flex-shrink-0">
<i class="fas fa-exclamation-circle text-xl" style="color: var(--brand-red-100); filter: drop-shadow(0 0 6px rgba(252, 165, 165, 0.5));"></i>
                            </div>
                            <div class="flex-1">
<h4 class="text-sm font-black" style="color: var(--brand-red-100);">Bot Banido ou com Problema?</h4>
<p class="mt-2 text-xs font-semibold leading-relaxed" style="color: var(--txt-secondary);"> Esta função é para recuperação de bot banido ou com problemas.<br> O bot será atualizado com o novo token <strong style="color: var(--brand-red-100); font-weight: 900;">mantendo TODAS as configurações</strong>. </p>
                            </div>
                        </div>
                    </div>
<div class="rounded-xl p-5 border-2" style="background: rgba(245, 158, 11, 0.12); border-color: var(--brand-gold-500);">
                        <div class="flex gap-3">
                            <div class="flex-shrink-0">
<i class="fas fa-shield-alt text-xl" style="color: var(--brand-gold-300); filter: drop-shadow(0 0 6px rgba(252, 211, 77, 0.5));"></i>
                            </div>
                            <div class="flex-1">
<h4 class="text-sm font-black mb-3" style="color: var(--brand-gold-100);">O que será preservado:</h4>
<ul class="text-xs font-semibold space-y-2" style="color: var(--txt-secondary);">
                                    <li class="flex items-center gap-2">
<i class="fas fa-check-circle" style="color: var(--brand-green-100);"></i> Todas as mensagens configuradas </li>
                                    <li class="flex items-center gap-2">
<i class="fas fa-check-circle" style="color: var(--brand-green-100);"></i> Order Bumps e Downsells </li>
                                    <li class="flex items-center gap-2">
<i class="fas fa-check-circle" style="color: var(--brand-green-100);"></i> Links e mídias </li>
                                    <li class="flex items-center gap-2">
<i class="fas fa-check-circle" style="color: var(--brand-green-100);"></i> Histórico de vendas e usuários </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Form -->
                <form @submit.prevent="changeToken()" class="px-8 pb-8 space-y-5">
                    <!-- Token Atual (Readonly) -->
                    <div class="space-y-2">
<label class="block text-sm font-bold" style="color: var(--txt-tertiary);"> Token Atual </label>
                        <div class="relative">
<input type="text" :value="botToChangeToken?.token ? botToChangeToken.token.substring(0, 15) + '...' : ''" readonly class="w-full px-4 py-3 pl-11 rounded-xl cursor-not-allowed text-sm" style="background: rgba(17, 24, 39, 0.5); border: 1px solid rgba(255, 255, 255, 0.1); color: var(--txt-tertiary); font-family: 'Courier New', monospace;">
                            <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
<i class="fas fa-lock" style="color: var(--txt-muted);"></i>
                            </div>
                        </div>
<p class="text-xs font-semibold flex items-center gap-1.5" style="color: var(--txt-tertiary);">
<i class="fas fa-info-circle"></i> Username: @<span x-text="botToChangeToken?.username"></span>
                        </p>
                    </div>
                    <!-- Token Novo (OBRIGATÓRIO) -->
                    <div class="space-y-2">
<label for="changeTokenInput" class="block text-sm font-black" style="color: var(--txt-primary);"> Novo Token <span style="color: var(--brand-red-100);">*</span>
                        </label>
                        <div class="relative">
<input type="text" id="changeTokenInput" x-model="changeTokenInput" required placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz" class="w-full px-4 py-3.5 pl-11 rounded-xl focus:outline-none transition-all text-sm" style="background: var(--bg-secondary); border: 2px solid rgba(255, 255, 255, 0.15); color: var(--brand-gold-100); font-family: 'Courier New', monospace; font-weight: 600;" onfocus="this.style.borderColor='var(--brand-gold-500)'; this.style.background='var(--surface-low)';" onblur="this.style.borderColor='rgba(255, 255, 255, 0.15)'; this.style.background='var(--bg-secondary)';">
                            <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
<i class="fas fa-key" style="color: var(--brand-gold-300);"></i>
                            </div>
                        </div>
<p class="text-xs font-semibold flex items-center gap-1.5 mt-2" style="color: var(--txt-tertiary);">
<i class="fas fa-info-circle"></i> Crie um novo bot no @BotFather e cole o token aqui </p>
                    </div>
                    <!-- Confirmação -->
                    <div class="rounded-xl p-5 border-2" style="background: rgba(59, 130, 246, 0.08); border-color: rgba(59, 130, 246, 0.3);">
                        <label class="flex items-start cursor-pointer">
<input type="checkbox" x-model="confirmChangeToken" class="mt-1 h-4 w-4 rounded focus:ring-2" style="background: var(--bg-secondary); border: 2px solid var(--brand-blue-300); color: var(--brand-blue-500);">
<span class="ml-3 text-xs font-semibold leading-relaxed" style="color: var(--txt-secondary);"> Confirmo que o bot está <strong style="color: var(--brand-gold-100); font-weight: 900;">PARADO</strong> e entendo que o token será substituído mantendo todas as configurações. </span>
                        </label>
                    </div>
                    <!-- Botões -->
                    <div class="grid grid-cols-2 gap-4 pt-4">
<button type="button" @click="showChangeTokenModal = false" class="w-full inline-flex justify-center items-center py-3.5 px-4 rounded-xl text-sm font-bold focus:outline-none transition-all hover:scale-105" style="background: transparent; border: 2px solid rgba(255, 255, 255, 0.15); color: var(--txt-secondary);">
<i class="fas fa-times mr-2"></i> Cancelar </button>
<button type="submit" :disabled="loading || !changeTokenInput || !confirmChangeToken || botToChangeToken?.is_running" :class="{ 'opacity-60 cursor-not-allowed': loading || !changeTokenInput || !confirmChangeToken || botToChangeToken?.is_running } w-full inline-flex justify-center items-center py-3.5 px-4 rounded-xl text-sm font-black focus:outline-none transition-all transform hover:-translate-y-1 active:translate-y-0 disabled:transform-none" style="background: linear-gradient(135deg, var(--brand-gold-500), var(--brand-gold-700)); color: #000000; box-shadow: 0 8px 24px rgba(245, 158, 11, 0.4), 0 0 20px rgba(252, 211, 77, 0.2);">
                            <span x-show="!loading" class="flex items-center">
<i class="fas fa-sync-alt mr-2"></i> Trocar Token </span>
                            <span x-show="loading" class="flex items-center">
<i class="fas fa-spinner fa-spin mr-2"></i> Validando... </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block extra_scripts %}
<script>
// TESTE SIMPLES
console.log('🔍 Testando Alpine.js...');
console.log('Alpine disponível:', typeof Alpine !== 'undefined');

function dashboardApp() {
    console.log('🚀 dashboardApp() chamada!');
    return {
        // Estado
        showAdvanced: localStorage.getItem('dashboard_mode') === 'advanced',
        dashboardData: null,
        
        // Toggle dashboard
        toggleDashboard() {
            this.showAdvanced = !this.showAdvanced;
            localStorage.setItem('dashboard_mode', this.showAdvanced ? 'advanced' : 'simple');
        },
        
        // Modais
        showAddBotModal: false,
        showDuplicateBotModal: false,
        showChangeTokenModal: false,
        newBotToken: '',
        newBotName: '',
        duplicateBotToken: '',
        duplicateBotName: '',
        changeTokenInput: '',
        confirmChangeToken: false,
        botToDuplicate: null,
        botToChangeToken: null,
        loading: false,
        isUpdating: false,
        
        // Dados
        stats: {
            total_users: {{ stats.total_users }},
            total_sales: {{ stats.total_sales }},
            total_revenue: {{ stats.total_revenue }},
            pending_sales: {{ stats.pending_sales }},
            running_bots: {{ stats.running_bots }},
            total_bots: {{ stats.total_bots }}
        },
        bots: {{ bots|tojson|safe }},
        payments: {{ recent_payments|tojson|safe }},
        filteredBots: [],
        filteredPayments: [],
        
        // Analytics
        analytics: {
            conversion_rate: 0,
            avg_ticket: 0,
            today_sales: 0,
            order_bump_stats: { shown: 0, accepted: 0, acceptance_rate: 0, total_revenue: 0 },
            downsell_stats: { sent: 0, converted: 0, conversion_rate: 0, total_revenue: 0 },
            peak_hours: []
        },
        
        // Filtros
        filters: {
            botSearch: '',
            botStatus: 'all',
            saleStatus: 'all',
            period: '7'
        },
        
        // WebSocket
        socket: null,
        
        // Chart
        salesChart: null,

        // Inicialização
        init() {
            console.log('🚀 Dashboard inicializando...');
            console.log('📊 Stats:', this.stats);
            console.log('🤖 Bots:', this.bots);
            console.log('💰 Payments:', this.payments);
            
            this.filteredBots = this.bots;
            this.filteredPayments = this.payments;
            
            // Conectar WebSocket
            this.connectWebSocket();
            
            // Carregar gráfico
            this.initChart();
            this.loadChartData();
            
            // Carregar analytics
            this.loadAnalytics();
            
            // Auto-refresh a cada 60 segundos (reduzido para evitar stack overflow)
            setInterval(() => {
                this.refreshStats();
                this.loadAnalytics();
            }, 60000);
            
            console.log('✅ Dashboard inicializado!');
        },
        
        // WebSocket
        connectWebSocket() {
            try {
                console.log('🔌 WebSocket desabilitado temporariamente');
                // this.socket = io();
                // this.socket.on('connect', () => {
                //     console.log('✅ WebSocket conectado');
                // });
                // this.socket.on('bot_status_update', (data) => {
                //     console.log('🤖 Status do bot atualizado:', data);
                //     this.refreshStats();
                // });
                // this.socket.on('new_sale', (data) => {
                //     console.log('💰 Nova venda:', data);
                //     this.playNotificationSound();
                //     this.stats.total_sales += 1;
                //     this.stats.total_revenue += data.amount;
                //     this.payments.unshift(data);
                //     this.filterSales();
                //     this.loadChartData();
                //     this.loadAnalytics();
                //     this.showNotification(`💰 Nova venda: R$ ${this.formatMoney(data.amount)}`);
                // });
            } catch (error) {
                console.error('❌ Erro WebSocket:', error);
            }
        },
        
        // Refresh stats
        async refreshStats() {
            if (this.isUpdating) return;
            this.isUpdating = true;
            try {
                const response = await fetch('/api/dashboard/stats');
                const data = await response.json();
                this.stats.total_users = data.total_users;
                this.stats.total_sales = data.total_sales;
                this.stats.total_revenue = data.total_revenue;
                this.stats.pending_sales = data.pending_sales;
                this.stats.running_bots = data.running_bots;
                this.bots = data.bots;
                this.filterBots();
                console.log('✅ Stats atualizadas');
            } catch (error) {
                console.error('❌ Erro ao atualizar stats:', error);
            } finally {
                this.isUpdating = false;
            }
        },
        
        // Chart
        initChart() {
            const ctx = document.getElementById('salesChart');
            if (!ctx) {
                console.error('❌ Elemento salesChart não encontrado');
                return;
            }
            
            // Verificar se Chart.js está disponível
            if (typeof Chart === 'undefined') {
                console.error('❌ Chart.js não carregado ainda! Tentando novamente em 500ms...');
                setTimeout(() => this.initChart(), 500);
                return;
            }
            
            try {
                console.log('📈 Inicializando Chart.js...');
                
                // Destruir chart existente se houver
                if (this.salesChart) {
                    console.log('🔄 Destruindo chart existente...');
                    this.salesChart.destroy();
                    this.salesChart = null;
                }
                
                this.salesChart = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: [],
                        datasets: [{
                            label: 'Vendas',
                            data: [],
                            borderColor: 'var(--brand-blue-500)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y'
                        }, {
                            label: 'Receita (R$)',
                            data: [],
                            borderColor: 'var(--brand-gold-500)',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y1'
                        }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                        interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                                display: true,
                                position: 'bottom',
                                labels: {
                                    color: 'var(--txt-secondary)',
                                    padding: 15,
                                    font: { size: 12, weight: 'bold' }
                                }
                        },
                        tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: 'var(--txt-primary)',
                                bodyColor: 'var(--txt-secondary)',
                                borderColor: 'var(--brand-gold-500)',
                                borderWidth: 2,
                            padding: 12,
                                displayColors: true,
                                titleFont: { size: 13, weight: 'bold' },
                                bodyFont: { size: 12 }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { color: 'var(--txt-tertiary)', callback: function(value) { return Math.floor(value); } }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                                grid: { drawOnChartArea: false },
                                ticks: { color: 'var(--txt-tertiary)', callback: function(value) { return 'R$ ' + value.toFixed(0); } }
                        },
                        x: {
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { color: 'var(--txt-tertiary)' }
                        }
                    }
                }
            });
                console.log('📈 Chart inicializado');
            } catch (error) {
                console.error('❌ Erro ao inicializar chart:', error);
            }
        },
        
        async loadChartData() {
            try {
                console.log('📡 Carregando dados do gráfico...');
                const response = await fetch('/api/dashboard/sales-chart');
                const data = await response.json();
                console.log('📊 Dados recebidos:', data);
                
                if (this.salesChart) {
                this.salesChart.data.labels = data.map(d => d.date);
                this.salesChart.data.datasets[0].data = data.map(d => d.sales);
                this.salesChart.data.datasets[1].data = data.map(d => d.revenue);
                this.salesChart.update();
                    console.log('✅ Gráfico atualizado com sucesso!');
                } else {
                    console.error('❌ salesChart não existe!');
                }
            } catch (error) {
                console.error('❌ Erro ao carregar gráfico:', error);
            }
        },
        
        async loadAnalytics() {
            try {
                const response = await fetch('/api/dashboard/analytics');
                const data = await response.json();
                this.analytics = data;
                console.log('📊 Analytics carregados:', data);
            } catch (error) {
                console.error('❌ Erro ao carregar analytics:', error);
            }
        },
        
        // Filtros
        filterBots() {
            this.filteredBots = this.bots.filter(bot => {
                const matchesSearch = bot.name.toLowerCase().includes(this.filters.botSearch.toLowerCase());
                const matchesStatus = this.filters.botStatus === 'all' || 
                    (this.filters.botStatus === 'online' && bot.is_running) ||
                    (this.filters.botStatus === 'offline' && !bot.is_running);
                return matchesSearch && matchesStatus;
            });
        },
        
        filterSales() {
            this.filteredPayments = this.payments.filter(payment => {
                return this.filters.saleStatus === 'all' || payment.status === this.filters.saleStatus;
            });
        },

        // Botões
        async startBot(botId) {
            const confirmed = await confirmAction({
                title: 'Iniciar este bot?',
                message: 'O bot começará a responder mensagens automaticamente.',
                icon: '▶️',
                confirmText: 'Sim, iniciar',
                cancelText: 'Cancelar'
            });
            if (!confirmed) return;

            try {
                const response = await fetch(`/api/bots/${botId}/start`, {method: 'POST'});
                const data = await response.json();
                if (response.ok) {
                    showSuccess('Bot iniciado com sucesso!');
                    await this.refreshStats();
                } else {
                    showFriendlyError(data.error);
                }
            } catch (error) {
                showFriendlyError(error.message);
            }
        },

        async stopBot(botId) {
            const confirmed = await confirmAction({
                title: 'Parar este bot?',
                message: 'O bot vai parar de responder mensagens.',
                icon: '⏸️',
                confirmText: 'Sim, parar',
                cancelText: 'Cancelar'
            });
            if (!confirmed) return;

            try {
                const response = await fetch(`/api/bots/${botId}/stop`, {method: 'POST'});
                const data = await response.json();
                if (response.ok) {
                    showSuccess('Bot parado com sucesso!');
                    await this.refreshStats();
                } else {
                    showFriendlyError(data.error);
                }
            } catch (error) {
                showFriendlyError(error.message);
            }
        },
        
        // Utilitários
        playNotificationSound() {
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjCS0vLPeSsFI3bI8N2RQAEA+B8AAEAfAAABAAgA');
                audio.play().catch(() => {});
            } catch (e) {}
        },

        showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 badge-online text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-bounce';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        },
        
        formatNumber(num) {
            return new Intl.NumberFormat('pt-BR').format(num);
        },
        
        formatMoney(value) {
            return new Intl.NumberFormat('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        },
        
        formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        },
        
        // ✅ Abrir modal de duplicar bot
        openDuplicateBotModal(bot) {
            this.botToDuplicate = bot;
            this.duplicateBotToken = '';
            this.duplicateBotName = '';
            this.showDuplicateBotModal = true;
        },
        
        // ✅ Duplicar bot
        async duplicateBot() {
            if (!this.duplicateBotToken.trim()) {
                alert('Digite o token do novo bot');
                return;
            }
            
            if (!confirm(`Duplicar o bot "${this.botToDuplicate.name}"?\n\nTodas as configurações serão copiadas para o novo bot.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/bots/${this.botToDuplicate.id}/duplicate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        token: this.duplicateBotToken.trim(),
                        name: this.duplicateBotName.trim()
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    this.showDuplicateBotModal = false;
                    this.showNotification('✅ Bot duplicado com sucesso!');
                    await this.refreshStats();
                } else {
                    alert('Erro: ' + (data.error || 'Erro ao duplicar bot'));
                }
            } catch (error) {
                alert('Erro ao duplicar bot: ' + error.message);
            }
        }
    };
    }

// TESTE FINAL
console.log('🔍 dashboardApp definida:', typeof dashboardApp);
</script>
</div>
<!-- Fim Modo Avançado -->
</div>
<!-- Fim Container Principal -->
{% endblock %}